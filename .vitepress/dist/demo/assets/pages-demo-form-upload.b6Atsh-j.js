import{d as e,t as l,c as t,z as a,T as s,r as u,o as n,a as o,w as r,n as i,U as p,X as d,_ as c,j as _,k as m,u as S,e as O,W as b,b as T,O as U,q as g,F as y,x as f,f as w,g as h,D as v,af as N,ag as j,G as J,Q as x}from"./index-C3cX6pOv.js";import{r as k,_ as V,a as A,c as $,b as z}from"./cl-page.uvue_vue_type_script_setup_true_lang.DZnZPYiq.js";import{_ as C}from"./cl-progress.CmReaGgi.js";import{a as F}from"./index.BsVBfTcH.js";import{D as M}from"./item.B0iCyPsh.js";import"./cl-rolling-number.BSHjGMLp.js";import"./item.uvue_vue_type_style_index_0_scoped_f51a3be8_lang.DQpFvJzq.js";class G extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},item:{type:"Unknown",optional:!0},add:{type:"Unknown",optional:!0},image:{type:"Unknown",optional:!0},icon:{type:"Unknown",optional:!0},text:{type:"Unknown",optional:!0}}}}}constructor(e,l=G.get$UTSMetadata$(),t=!1){super(),this.__props__=UTS.UTSType.initProps(e,l,t),this.className=this.__props__.className,this.item=this.__props__.item,this.add=this.__props__.add,this.image=this.__props__.image,this.icon=this.__props__.icon,this.text=this.__props__.text,delete this.__props__}}const P=$(e(Object.assign({name:"cl-upload"},{__name:"cl-upload",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:[Array,String],default:()=>[]},icon:{type:String,default:"camera-fill"},text:{type:String,default:()=>l("上传/拍摄")},sizeType:{type:[String,Array],default:()=>["original","compressed"]},sourceType:{type:Array,default:()=>["album","camera"]},height:{type:[Number,String],default:150},width:{type:[Number,String],default:150},multiple:{type:Boolean,default:!1},limit:{type:Number,default:9},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change","exceed","success","error","progress"],setup(e,l){var $=l.emit;const z=e,M=$,G=t((()=>p(z.pt))),P=a([]),B=a(0),D=t((()=>{const e=P.value.length;return z.disabled?0==e:e<(z.multiple?z.limit:1)})),I=t((()=>new UTSJSONObject({height:d(z.height),width:d(z.width)})));function q(){return P.value.filter((e=>""!=e.url&&100==e.progress)).map((e=>e.url))}function E(){const e=function(){const e=q();return z.multiple?e:e[0]}();M("update:modelValue",e),M("change",e)}function Q(e,l=null){const t=UTS.arrayFind(P.value,(l=>l.uid==e));null!=t&&(x(l,((e=null,l)=>{t[l]=e})),100==t.progress&&""!=t.url&&E())}function W(e){P.value.splice(P.value.findIndex((l=>l.uid==e)),1),E()}function X(e){if(z.disabled)return null;B.value=e;const l=-1==B.value?z.limit-P.value.length:1;if(l<=0)return M("exceed",P.value),null;v(new UTSJSONObject({count:l,sizeType:z.sizeType,sourceType:z.sourceType,success(e){Array.isArray(e.tempFiles)&&e.tempFiles.forEach((e=>{const l=function(e){const l=-1==B.value?J({uid:N(),preview:e,url:"",progress:0}):P.value[B.value];return-1==B.value?P.value.push(l):(l.progress=0,l.preview=e,l.url=""),l.uid}(e.path);F(e,{onProgressUpdate:e=>{var t=e.progress;Q(l,new UTSJSONObject({progress:t})),M("progress",t)}}).then((e=>{Q(l,new UTSJSONObject({url:e,progress:100})),M("success",e,l)})).catch(((e=null)=>{M("error",e),W(l)}))}))},fail(e){console.error(e),M("error",e.errMsg)}}))}return s(t((()=>z.modelValue)),(e=>{if(q().join(",")!=(Array.isArray(e)?e.join(","):e)){const l=Array.isArray(e)?e:[e];P.value=l.filter((e=>""!=e)).map((e=>({uid:N(),preview:e,url:e,progress:100})))}}),{immediate:!0}),(l=null,t=null)=>{const a=j,s=k(u("cl-icon"),V),p=k(u("cl-progress"),C),d=c,v=k(u("cl-text"),A);return n(),o(d,new UTSJSONObject({class:i(["cl-upload-list",[new UTSJSONObject({}),G.value.className]])}),{default:r((()=>{var l;return[(n(!0),_(y,null,m(P.value,((l,t)=>{var u;return n(),o(d,{key:l.uid,class:i(["cl-upload",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":S(O),"is-disabled":e.disabled}),null===(u=G.value.item)||void 0===u?null:u.className]]),style:b(I.value),onClick:(e=null)=>X(t)},{default:r((()=>{var t;return[T(a,{class:i(["cl-upload__image",[new UTSJSONObject({}),new UTSJSONObject({"is-uploading":l.progress<100}),null===(t=G.value.image)||void 0===t?null:t.className]]),src:l.preview,mode:"aspectFill"},null,8,["class","src"]),e.disabled?g("",!0):(n(),o(s,new UTSJSONObject({key:0,name:"close-line",color:"white",pt:new UTSJSONObject({className:"cl-upload__close"}),onClick:U(((e=null)=>W(l.uid)),["stop"])}),null,8,["onClick"])),l.progress<100?(n(),o(d,new UTSJSONObject({key:1,class:"cl-upload__progress"}),new UTSJSONObject({default:r((()=>[T(p,new UTSJSONObject({value:l.progress,"show-text":!1}),null,8,["value"])])),_:2}),1024)):g("",!0)]})),_:2},1032,["class","style","onClick"])})),128)),D.value?(n(),o(d,{key:0,class:i(["cl-upload",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":S(O),"is-disabled":e.disabled}),null===(l=G.value.add)||void 0===l?null:l.className]]),style:b(I.value),onClick:t[0]||(t[0]=(e=null)=>X(-1))},{default:r((()=>{var l,t;return[T(s,{name:e.icon,pt:{className:S(f)([[S(O),"-important-text-white","-important-text-surface-400"],null===(l=G.value.icon)||void 0===l?null:l.className])},size:50},null,8,["name","pt"]),T(v,{pt:{className:S(f)([[S(O),"-important-text-white","-important-text-surface-500"],"-important-text-xs mt-1 text-center",null===(t=G.value.text)||void 0===t?null:t.className])}},{default:r((()=>[w(h(e.text),1)])),_:1},8,["pt"])]})),_:1},8,["class","style"])):g("",!0)]})),_:1},8,["class"])}}})),[["__scopeId","data-v-7889d1a0"]]);class B extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{upload1:{type:String,optional:!1},upload2:{type:UTS.UTSType.withGenerics(Array,[String]),optional:!1},upload3:{type:UTS.UTSType.withGenerics(Array,[String]),optional:!1}}}}}constructor(e,l=B.get$UTSMetadata$(),t=!1){super(),this.__props__=UTS.UTSType.initProps(e,l,t),this.upload1=this.__props__.upload1,this.upload2=this.__props__.upload2,this.upload3=this.__props__.upload3,delete this.__props__}}const D=e({__name:"upload",setup(e){const t=J(new B({upload1:"",upload2:[],upload3:[]}));return(e=null,a=null)=>{const s=k(u("cl-upload"),P),i=c,p=k(u("cl-page"),z);return n(),o(p,null,new UTSJSONObject({default:r((()=>[T(i,new UTSJSONObject({class:"p-3"}),{default:r((()=>[T(S(M),new UTSJSONObject({label:S(l)("基础用法")}),{default:r((()=>[T(s,new UTSJSONObject({modelValue:t.upload1,"onUpdate:modelValue":a[0]||(a[0]=(e=null)=>t.upload1=e)}),null,8,["modelValue"])])),_:1},8,["label"]),T(S(M),new UTSJSONObject({label:S(l)("禁用")}),{default:r((()=>[T(s,new UTSJSONObject({modelValue:t.upload1,"onUpdate:modelValue":a[1]||(a[1]=(e=null)=>t.upload1=e),disabled:""}),null,8,["modelValue"])])),_:1},8,["label"]),T(S(M),new UTSJSONObject({label:S(l)("自定义图标、文字、大小")}),{default:r((()=>[T(s,new UTSJSONObject({modelValue:t.upload1,"onUpdate:modelValue":a[2]||(a[2]=(e=null)=>t.upload1=e),icon:"id-card-line",text:S(l)("上传证件照"),width:300,height:200}),null,8,["modelValue","text"])])),_:1},8,["label"]),T(S(M),new UTSJSONObject({label:S(l)("多选")}),{default:r((()=>[T(s,new UTSJSONObject({multiple:"",modelValue:t.upload2,"onUpdate:modelValue":a[3]||(a[3]=(e=null)=>t.upload2=e)}),null,8,["modelValue"])])),_:1},8,["label"]),T(S(M),new UTSJSONObject({label:S(l)("限制 3 个")}),{default:r((()=>[T(s,new UTSJSONObject({multiple:"",limit:3,modelValue:t.upload3,"onUpdate:modelValue":a[4]||(a[4]=(e=null)=>t.upload3=e)}),null,8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1}))}}});export{D as default};
