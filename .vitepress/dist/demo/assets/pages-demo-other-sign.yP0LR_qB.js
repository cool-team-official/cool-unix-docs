import{d as e,a4 as t,c as l,aF as n,af as a,z as s,a5 as i,T as o,o as u,a as r,w as c,n as p,U as d,aA as h,_,b as f,W as S,O as m,E as g,V as T,aB as b,aC as y,aa as v,r as U,f as w,ar as O}from"./index-CVV1TSA3.js";import{c as N}from"./file.BBnXdO2E.js";import{o as x,r as j,d as k,b as J}from"./cl-page.uvue_vue_type_script_setup_true_lang.C_4yWtlS.js";import{_ as W,a as $}from"./cl-list.D8-zSd0F.js";import{_ as C}from"./cl-switch._ds2U0_a.js";import"./cl-collapse.D9wTDJH8.js";import"./index.U6ITPUe7.js";class M extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{x:{type:Number,optional:!1},y:{type:Number,optional:!1},time:{type:Number,optional:!1}}}}}constructor(e,t=M.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.x=this.__props__.x,this.y=this.__props__.y,this.time=this.__props__.time,delete this.__props__}}class B extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{left:{type:Number,optional:!1},top:{type:Number,optional:!1}}}}}constructor(e,t=B.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.left=this.__props__.left,this.top=this.__props__.top,delete this.__props__}}class P extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0}}}}}constructor(e,t=P.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.className=this.__props__.className,delete this.__props__}}const V=e(Object.assign({name:"cl-sign"},{__name:"cl-sign",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},width:{type:Number,default:300},height:{type:Number,default:200},strokeColor:{type:String,default:"#000000"},strokeWidth:{type:Number,default:3},backgroundColor:{type:String,default:"#ffffff"},enableBrush:{type:Boolean,default:!0},minStrokeWidth:{type:Number,default:1},maxStrokeWidth:{type:Number,default:6},velocitySensitivity:{type:Number,default:.7}},emits:["change"],setup(e,v){var U=v.expose,w=v.emit;const O=e,x=w,j=t().proxy,k=l((()=>d(O.pt))),J=n(null);let W=null;const $="cl-sign__".concat(a()),C=s(!1);let B=null,P=s(3);const V=[];function R(e){const t=e.touches[0],l=e.target.getBoundingClientRect();return new M({x:t.clientX-l.left,y:t.clientY-l.top,time:Date.now()})}function D(e){return g(this,void 0,void 0,(function*(){e.preventDefault(),C.value=!0,B=R(e),P.value=O.enableBrush?O.maxStrokeWidth:O.strokeWidth,V.length=0}))}function A(e){if(e.preventDefault(),!C.value||null==B||null==W)return null;const t=R(e),l=function(e){if(null==B||!O.enableBrush)return O.strokeWidth;const t=Math.sqrt(Math.pow(e.x-B.x,2)+Math.pow(e.y-B.y,2)),l=e.time-B.time;if(l<=0)return P.value;const n=t/l;V.push(n),V.length>5&&UTS.arrayShift(V);const a=V.reduce(((e,t)=>e+t),0)/V.length,s=Math.min(a*O.velocitySensitivity,1),i=O.maxStrokeWidth-O.minStrokeWidth,o=O.maxStrokeWidth-s*i;return P.value+.3*(o-P.value)}(t);P.value=l,W.beginPath(),W.moveTo(B.x,B.y),W.lineTo(t.x,t.y),W.strokeStyle=O.strokeColor,W.lineWidth=l,W.lineCap="round",W.lineJoin="round",W.stroke(),B=t,x("change")}function q(e){e.preventDefault(),C.value=!1,B=null}function z(){if(null==W)return null;W.clearRect(0,0,O.width,O.height),y().devicePixelRatio,W.fillStyle=O.backgroundColor,W.fillRect(0,0,O.width,O.height),x("change")}function E(){h({id:$,component:j,success:e=>{W=e.getContext("2d"),W.canvas.width=O.width,W.canvas.height=O.height,W.textBaseline="middle",W.textAlign="center",W.miterLimit=10,z()}})}return i((()=>{E(),o(l((()=>[O.width,O.height])),(()=>{T((()=>{E()}))}))})),U(new UTSJSONObject({clear:z,toPng:function(){return N(J.value)}})),(t=null,l=null)=>{const n=b,a=_;return u(),r(a,new UTSJSONObject({class:p(["cl-sign",[new UTSJSONObject({}),k.value.className]])}),new UTSJSONObject({default:c((()=>[f(n,new UTSJSONObject({class:"cl-sign__canvas",ref_key:"canvasRef",ref:J,id:$,style:S({height:"".concat(e.height,"px"),width:"".concat(e.width,"px")}),onTouchstart:D,onTouchmove:m(A,["stop","prevent"]),onTouchend:q}),null,8,["style"])])),_:1}),8,["class"])}}})),R=e({__name:"sign",setup(e){const t=s(0),l=s(0),n=s(!1),a=s(!0),i=s(null);function o(){i.value.clear()}function p(){i.value.toPng().then((e=>{O({urls:[e]})}))}function d(){t.value=n.value?v().windowHeight-200:200}return x((()=>{const e=v().windowWidth;t.value=200,l.value=e})),(e=null,s=null)=>{const h=j(U("cl-sign"),V),S=j(U("cl-button"),k),m=j(U("cl-list-item"),W),g=j(U("cl-switch"),C),T=j(U("cl-list"),$),b=_,y=j(U("cl-page"),J);return u(),r(y,null,new UTSJSONObject({default:c((()=>[f(h,new UTSJSONObject({ref_key:"signRef",ref:i,height:t.value,width:l.value,"enable-brush":a.value}),null,8,["height","width","enable-brush"]),f(b,new UTSJSONObject({class:"p-3"}),{default:c((()=>[f(T,null,{default:c((()=>[f(m,new UTSJSONObject({label:"操作"}),{default:c((()=>[f(S,new UTSJSONObject({type:"info",onClick:o}),{default:c((()=>[w("清空")])),_:1}),f(S,new UTSJSONObject({onClick:p}),{default:c((()=>[w("预览")])),_:1})])),_:1}),f(m,new UTSJSONObject({label:"大屏"}),{default:c((()=>[f(g,new UTSJSONObject({modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=(e=null)=>n.value=e),onChange:d}),null,8,["modelValue"])])),_:1}),f(m,new UTSJSONObject({label:"毛笔效果"}),{default:c((()=>[f(g,new UTSJSONObject({modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=(e=null)=>a.value=e)}),null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}))}}});export{R as default};
