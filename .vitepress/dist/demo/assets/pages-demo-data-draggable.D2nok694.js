import{c as e,r as t,a as l,b as a}from"./cl-page.uvue_vue_type_script_setup_true_lang.DgMmTlhG.js";import{d as n,a8 as u,c as s,z as o,T as i,o as r,a as c,w as d,n as p,W as b,_ as v,j as S,k as m,X as O,O as f,H as _,F as g,E as h,as as T,a9 as w,P as j,r as U,b as N,u as J,t as x,e as y,f as V,g as $}from"./index-oaRQvvbJ.js";import{_ as M,a as k}from"./cl-list.3--ilU0f.js";import{_ as P}from"./cl-image.BNcpcr0w.js";import{D as I}from"./item.CYoAy5gw.js";import"./cl-collapse.CB1G0Aey.js";import"./item.uvue_vue_type_style_index_0_scoped_f51a3be8_lang.Bm1wRfHZ.js";class z extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{top:{type:Number,optional:!1},left:{type:Number,optional:!1},width:{type:Number,optional:!1},height:{type:Number,optional:!1}}}}}constructor(e,t=z.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.top=this.__props__.top,this.left=this.__props__.left,this.width=this.__props__.width,this.height=this.__props__.height,delete this.__props__}}class X extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{x:{type:Number,optional:!1},y:{type:Number,optional:!1}}}}}constructor(e,t=X.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.x=this.__props__.x,this.y=this.__props__.y,delete this.__props__}}class A extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},ghost:{type:"Unknown",optional:!0}}}}}constructor(e,t=A.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.className=this.__props__.className,this.ghost=this.__props__.ghost,delete this.__props__}}const C=e(n(Object.assign({name:"cl-draggable"},{__name:"cl-draggable",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},animation:{type:Number,default:150},columns:{type:Number,default:1}},emits:["update:modelValue","change","start","end"],setup(e,t){var l=t.emit;const a=e,n=l,U=u().proxy,N=s((()=>b(a.pt))),J=o([]),x=o(!1),y=o(-1),V=o(-1),$=o(0),M=o(0),k=o(0),P=o(0),I=o(new UTSJSONObject({})),z=o([]),A=o(!1),C=o(0),D=o(0),F=o(!1);function R(e){if(0==z.value.length)return y.value;if(a.columns>1){const e=z.value[y.value];return function(e,t){if(0==z.value.length)return y.value;let l=y.value,a=1/0;for(let n=0;n<z.value.length;n++){const u=z.value[n],s=u.left+u.width/2,o=u.top+u.height/2,i=Math.sqrt(Math.pow(e-s,2)+Math.pow(t-o,2));i<a&&(a=i,l=n)}return l}(e.left+e.width/2+P.value,e.top+e.height/2+k.value)}return function(e){let t=y.value,l=1/0;for(let a=0;a<z.value.length;a++){const n=z.value[a],u=n.top+n.height/2,s=Math.abs(e-u);s<l&&(l=s,t=a)}return t}(e)}function Y(e){if(!x.value||A.value||!F.value)return new X({x:0,y:0});const t=y.value,l=V.value;return e==t||t==l?new X({x:0,y:0}):a.columns>1?function(e,t,l){const n=a.columns,u=Math.floor(e/n),s=e%n;let o=e;t<l?e>t&&e<=l&&(o=e-1):t>l&&e>=l&&e<t&&(o=e+1);const i=Math.floor(o/n),r=o%n,c=D.value,d=C.value;return new X({x:(r-s)*c,y:(i-u)*d})}(e,t,l):function(e,t,l){if(t<l){if(e>t&&e<=l)return new X({x:0,y:-C.value})}else if(t>l&&e>=l&&e<t)return new X({x:0,y:C.value});return new X({x:0,y:0})}(e,t,l)}function q(e){const t=new UTSJSONObject({}),l=y.value==e;if(a.columns>1){const e=100/a.columns;t["flex-basis"]="".concat(e,"%"),t.width="".concat(e,"%"),t["box-sizing"]="border-box"}if(A.value)return t;if(a.animation>0&&!l&&(t["transition-property"]="transform",t["transition-duration"]="".concat(a.animation,"ms")),x.value)if(l)t.transform="translate(".concat(P.value,"px, ").concat(k.value,"px)"),t["z-index"]="100";else{const l=Y(e);0==l.x&&0==l.y||(t.transform="translate(".concat(l.x,"px, ").concat(l.y,"px)"))}return t}function B(e,t){return h(this,void 0,void 0,(function*(){if(a.disabled)return Promise.resolve(null);if(function(e){return!j(J.value[e].disabled)&&J.value[e].disabled}(t))return Promise.resolve(null);if(t<0||t>=J.value.length)return Promise.resolve(null);const l=e.touches[0];x.value=!0,y.value=t,V.value=t,M.value=l.clientX,$.value=l.clientY,P.value=0,k.value=0,I.value=J.value[t],yield function(){return h(this,void 0,void 0,(function*(){return new Promise((e=>{w().in(U).select(".cl-draggable").boundingClientRect().exec((t=>{var l;const n=t[0];D.value=(null!==(l=n.width)&&void 0!==l?l:0)/a.columns,w().in(U).selectAll(".cl-draggable__item").boundingClientRect().exec((t=>{var l,a,n;const u=t[0],s=[];for(let e=0;e<u.length;e++){const t=u[e];0==e&&(C.value=null!==(l=t.height)&&void 0!==l?l:0),s.push({top:null!==(a=t.top)&&void 0!==a?a:0,left:null!==(n=t.left)&&void 0!==n?n:0,width:D.value,height:C.value})}z.value=s,e()}))}))}))}))}(),n("start",t)}))}function E(e){if(!x.value)return null;const t=e.touches[0];if(P.value=t.clientX-M.value,k.value=t.clientY-$.value,F.value||function(){if(0==z.value.length)return!1;const e=y.value,t=z.value[e],l=t.left+t.width/2+P.value,n=t.top+t.height/2+k.value;if(a.columns>1)for(let a=0;a<z.value.length;a++){if(a==e)continue;const t=z.value[a];if(l>=t.left&&l<=t.left+t.width&&n>=t.top&&n<=t.top+t.height)return!0}else{if(e>0){const t=z.value[e-1];if(n<=t.top+t.height/2)return!0}if(e<z.value.length-1){const t=z.value[e+1];if(n>=t.top+t.height/2)return!0}}return!1}()&&(F.value=!0),F.value){const e=z.value[y.value],t=e.left+e.width/2+P.value,l=e.top+e.height/2+k.value,n=R(a.columns>1?t:l);n!=V.value&&(V.value=n)}e.preventDefault()}function H(){if(!x.value)return null;const e=y.value,t=V.value;if(e!=t&&t>=0){const l=[...J.value],a=l.splice(e,1)[0];l.splice(t,0,a),J.value=l,n("update:modelValue",J.value),n("change",J.value)}A.value=!0,x.value=!1,P.value=0,k.value=0,setTimeout((()=>{n("end",t>=0?t:e),x.value=!1,A.value=!1,y.value=-1,V.value=-1,P.value=0,k.value=0,I.value=new UTSJSONObject({}),z.value=[],C.value=0,D.value=0,F.value=!1}),10)}function W(e,t){return e.uid}return i(s((()=>a.modelValue)),(e=>{J.value=e.map((e=>{var t;return Object.assign({uid:null!==(t=e.uid)&&void 0!==t?t:T()},e)}))}),{immediate:!0}),(t=null,l=null)=>{const n=v;return r(),c(n,new UTSJSONObject({class:p(["cl-draggable",[new UTSJSONObject({"cl-draggable--grid":a.columns>1}),N.value.className]])}),{default:d((()=>[(r(!0),S(g,null,m(J.value,((l,a)=>{var u;return r(),c(n,{key:W(l),class:p(["cl-draggable__item",[new UTSJSONObject({}),new UTSJSONObject({"cl-draggable__item--disabled":e.disabled}),x.value&&y.value==a?"opacity-80 ".concat(null===(u=N.value.ghost)||void 0===u?null:u.className):""]]),style:O(q(a)),onTouchstart:(e=null)=>{B(e,a)},onTouchmove:f(E,["stop","prevent"]),onTouchend:H},new UTSJSONObject({default:d((()=>[_(t.$slots,"item",new UTSJSONObject({item:l,index:a,dragging:x.value,dragIndex:y.value,insertIndex:V.value}),void 0,!0)])),_:2}),1032,["class","style","onTouchstart"])})),128))])),_:3},8,["class"])}}})),[["__scopeId","data-v-53dfe46e"]]),D=n({__name:"draggable",setup(e){const n=o([new UTSJSONObject({label:"明月几时有，把酒问青天"}),new UTSJSONObject({label:"不知天上宫阙，今夕是何年",disabled:!0}),new UTSJSONObject({label:"我欲乘风归去，又恐琼楼玉宇"}),new UTSJSONObject({label:"高处不胜寒，起舞弄清影"}),new UTSJSONObject({label:"何似在人间"})]),u=o([new UTSJSONObject({label:"明月几时有，把酒问青天"}),new UTSJSONObject({label:"不知天上宫阙，今夕是何年"}),new UTSJSONObject({label:"我欲乘风归去，又恐琼楼玉宇"}),new UTSJSONObject({label:"高处不胜寒，起舞弄清影"}),new UTSJSONObject({label:"何似在人间"})]),s=o([new UTSJSONObject({label:"项目1"}),new UTSJSONObject({label:"项目2"}),new UTSJSONObject({label:"项目3"}),new UTSJSONObject({label:"项目4"}),new UTSJSONObject({label:"项目5"}),new UTSJSONObject({label:"项目6"}),new UTSJSONObject({label:"项目7"}),new UTSJSONObject({label:"项目8",disabled:!0}),new UTSJSONObject({label:"项目9"}),new UTSJSONObject({label:"项目10"}),new UTSJSONObject({label:"项目11"}),new UTSJSONObject({label:"项目12"})]),i=o([new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/1.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/2.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/3.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/4.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/5.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/6.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/7.jpg"})]);return(e=null,o=null)=>{const b=t(U("cl-text"),l),S=v,m=t(U("cl-draggable"),C),O=t(U("cl-list-item"),M),f=t(U("cl-list"),k),_=t(U("cl-image"),P),g=t(U("cl-page"),a);return r(),c(g,null,new UTSJSONObject({default:d((()=>[N(S,new UTSJSONObject({class:"p-3 overflow-visible"}),{default:d((()=>[N(J(I),new UTSJSONObject({label:J(x)("单列排序")}),{default:d((()=>[N(m,new UTSJSONObject({modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=(e=null)=>n.value=e)}),{item:d((e=>{var t=e.item;e.index;return[N(S,new UTSJSONObject({class:p(["flex flex-row items-center p-3 bg-surface-100 rounded-lg mb-2",new UTSJSONObject({"dark-colon--important-bg-surface-700":J(y),"opacity-50":t.disabled})])}),{default:d((()=>[N(b,null,{default:d((()=>[V($(t.label),1)])),_:2},1024)])),_:2},1032,["class"])]})),_:1},8,["modelValue"])])),_:1},8,["label"]),N(J(I),new UTSJSONObject({label:J(x)("结合列表使用")}),{default:d((()=>[N(f,new UTSJSONObject({border:""}),{default:d((()=>[N(m,new UTSJSONObject({modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=(e=null)=>u.value=e)}),{item:d((e=>{var t=e.item,l=e.index,a=e.dragging,n=e.dragIndex;return[N(O,new UTSJSONObject({icon:"chat-thread-line",label:t.label,arrow:"",pt:new UTSJSONObject({inner:new UTSJSONObject({className:a&&n==l?"-important-bg-surface-100":""})})}),null,8,["label","pt"])]})),_:1},8,["modelValue"])])),_:1})])),_:1},8,["label"]),N(J(I),new UTSJSONObject({label:J(x)("多列排序")}),{default:d((()=>[N(m,new UTSJSONObject({modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=(e=null)=>s.value=e),columns:4}),{item:d((e=>{var t=e.item;e.index;return[N(S,new UTSJSONObject({class:p(["flex flex-row items-center justify-center p-3 bg-surface-100 rounded-lg m-1",new UTSJSONObject({"dark-colon--important-bg-surface-700":J(y),"opacity-50":t.disabled})])}),{default:d((()=>[N(b,null,{default:d((()=>[V($(t.label),1)])),_:2},1024)])),_:2},1032,["class"])]})),_:1},8,["modelValue"])])),_:1},8,["label"]),N(J(I),new UTSJSONObject({label:J(x)("结合图片使用")}),{default:d((()=>[N(m,new UTSJSONObject({modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=(e=null)=>i.value=e),columns:4}),{item:d((e=>{var t=e.item;e.index;return[N(S,new UTSJSONObject({class:"p--bracket-start-2px-bracket-end-"}),{default:d((()=>[N(_,new UTSJSONObject({src:t.url,mode:"widthFix",pt:new UTSJSONObject({className:"-important-w-full"}),preview:""}),null,8,["src"])])),_:2},1024)]})),_:1},8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1}))}}});export{D as default};
