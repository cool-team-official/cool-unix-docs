import{d as e,a3 as t,h as l,r as a,X as r,a4 as s,o as n,l as i,e as u,w as o,i as c,ap as d,aq as h,F as f,Y as p,_ as v,S,m as _,c as b,u as O,p as m,f as w,g,an as T,a0 as N,a5 as y,a7 as U,t as x,a as j,n as J,N as k,x as H,A as B,aD as V}from"./index-CQm_J2yh.js";import{c as R,r as $,e as E,_ as A,l as C}from"./cl-page.uvue_vue_type_script_setup_true_lang.CluByn4i.js";import{_ as M}from"./cl-empty.CZBvZ2IL.js";UTS.UTSType;const I=R(e(Object.assign({name:"cl-index-bar"},{__name:"cl-index-bar",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:Number,default:0},list:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(e,x){var j=x.emit;const J=e,k=j,H=t().proxy,B=l((()=>p(J.pt))),V=a({height:0,width:0,left:0,top:0}),R=a([]),$=a(!1),E=a(!1),A=a(""),C=a(-1);function M(){N((()=>{setTimeout((()=>{y().in(H).select(".cl-index-bar").boundingClientRect().exec((e=>{if(U(e))return null;V.value=e[0],y().in(H).selectAll(".cl-index-bar__item").boundingClientRect().exec((e=>{if(U(e))return M(),null;R.value=e[0]}))}))}),350)}))}function I(e){var t,l;if(0==R.value.length)return 0;let a=0,r=Number.MAX_VALUE;for(let s=0;s<R.value.length;s++){const n=R.value[s],i=(null!==(t=n.top)&&void 0!==t?t:0)+(null!==(l=n.height)&&void 0!==l?l:0)/2,u=Math.abs(e-i);u<r&&(r=u,a=s)}return a<0?a=0:a>=J.list.length&&(a=J.list.length-1),a}function z(e){C.value=e,A.value=J.list[e]}function D(e){$.value=!0,E.value=!0;z(I(e.touches[0].clientY))}function P(e){if(!$.value)return null;z(I(e.touches[0].clientY))}function Y(){$.value=!1,J.modelValue!=C.value&&(k("update:modelValue",C.value),k("change",C.value)),setTimeout((()=>{E.value=!1}),500)}return r(l((()=>J.modelValue)),(e=>{C.value=e}),{immediate:!0}),s((()=>{r(l((()=>J.list)),(()=>{M()}),{immediate:!0})})),(t=null,l=null)=>{const a=T,r=v;return n(),i(f,null,[u(r,new UTSJSONObject({class:c(["cl-index-bar",[new UTSJSONObject({}),B.value.className]])}),{default:o((()=>[u(r,new UTSJSONObject({class:"cl-index-bar__list",onTouchstart:D,onTouchmove:S(P,["stop","prevent"]),onTouchend:Y}),{default:o((()=>[(n(!0),i(f,null,_(e.list,((e,t)=>(n(),b(r,new UTSJSONObject({class:"cl-index-bar__item",key:t}),new UTSJSONObject({default:o((()=>[u(r,new UTSJSONObject({class:c(["cl-index-bar__item-inner",new UTSJSONObject({"is-active":C.value==t})])}),{default:o((()=>[u(a,new UTSJSONObject({class:c(["cl-index-bar__item-text",new UTSJSONObject({"dark-colon-text-surface-50":O(m),"is-active":C.value==t||O(m)})])}),{default:o((()=>[w(g(e),1)])),_:2},1032,["class"])])),_:2},1032,["class"])])),_:2}),1024)))),128))])),_:1})])),_:1},8,["class"]),d(u(r,new UTSJSONObject({class:"cl-index-bar__alert"}),{default:o((()=>[u(r,new UTSJSONObject({class:c(["cl-index-bar__alert-icon",new UTSJSONObject({"dark-colon--important-bg-surface-800":O(m)})])}),{default:o((()=>[u(r,new UTSJSONObject({class:c(["cl-index-bar__alert-arrow",new UTSJSONObject({"dark-colon--important-bg-surface-800":O(m)})])}),null,8,["class"]),u(a,new UTSJSONObject({class:c(["cl-index-bar__alert-text",new UTSJSONObject({"dark-colon-text-surface-50":O(m),"dark-colon--important-text-white":O(m)})])}),{default:o((()=>[w(g(A.value),1)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1},512),[[h,E.value]])],64)}}})),[["__scopeId","data-v-d5380a69"]]);class z extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},item:{type:"Unknown",optional:!0},itemHover:{type:"Unknown",optional:!0},list:{type:"Unknown",optional:!0},indexBar:{type:"Unknown",optional:!0},scroller:{type:"Unknown",optional:!0},refresher:{type:"Unknown",optional:!0}}}}}constructor(e,t=z.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.className=this.__props__.className,this.item=this.__props__.item,this.itemHover=this.__props__.itemHover,this.list=this.__props__.list,this.indexBar=this.__props__.indexBar,this.scroller=this.__props__.scroller,this.refresher=this.__props__.refresher,delete this.__props__}}const D=R(e(Object.assign({name:"cl-list-view"},{__name:"cl-list-view",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},data:{type:Array,default:()=>[]},itemHeight:{type:Number,default:50},headerHeight:{type:Number,default:32},topHeight:{type:Number,default:0},bottomHeight:{type:Number,default:0},bufferSize:{type:Number,default:15},virtual:{type:Boolean,default:!0},scrollIntoView:{type:String,default:""},scrollWithAnimation:{type:Boolean,default:!1},showScrollbar:{type:Boolean,default:!1},refresherEnabled:{type:Boolean,default:!1},refresherThreshold:{type:Number,default:50},refresherBackground:{type:String,default:"transparent"},refresherDefaultText:{type:String,default:()=>x("下拉刷新")},refresherPullingText:{type:String,default:()=>x("释放立即刷新")},refresherRefreshingText:{type:String,default:()=>x("加载中")},showBackTop:{type:Boolean,default:!0}},emits:["item-tap","refresher-pulling","refresher-refresh","refresher-restore","refresher-abort","scrolltoupper","scrolltolower","scroll","scrollend","pull","top","bottom"],setup(e,d){var h=d.expose,S=d.emit;const T=e,x=S,R=t().proxy,z=l((()=>p(T.pt))),D=a(0),P=l((()=>U(T.data))),Y=l((()=>T.data.every((e=>null!=e.index))&&!P.value)),W=l((()=>{const e=[];return T.data.forEach((t=>{var l;const a=e.findIndex((e=>e.index==t.index));-1!=a?e[a].children.push(t):e.push({index:null!==(l=t.index)&&void 0!==l?l:"",children:[t]})})),e})),X=l((()=>W.value.map((e=>e.index)))),q=l((()=>{const e=[];let t=T.topHeight,l=0;return W.value.forEach(((a,r)=>{""!=a.index&&(e.push({key:"header-".concat(r),type:"header",index:l++,top:t,height:T.headerHeight,data:{label:a.index,index:a.index}}),t+=T.headerHeight),a.children.forEach(((a,s)=>{e.push({key:"item-".concat(r,"-").concat(s),type:"item",index:l++,top:t,height:T.itemHeight,data:a}),t+=T.itemHeight}))})),e})),F=l((()=>q.value.reduce(((e,t)=>e+t.height),0)+T.topHeight+T.bottomHeight)),L=a(0),G=a(0),K=a(0),Q=l((()=>{if(U(q.value))return[];if(!T.virtual)return q.value;const e=T.bufferSize*T.itemHeight,t=L.value-e,l=L.value+K.value+e,a=[];let r=0,s=q.value.length-1;for(;r<s;){const e=Math.floor((r+s)/2),l=q.value[e];l.top+l.height<=t?r=e+1:s=e}for(let n=r;n<q.value.length;n++){const e=q.value[n];if(e.top>=l)break;e.top+e.height>t&&a.push(e)}return a})),Z=l((()=>U(Q.value)?0:Q.value[0].top)),ee=l((()=>{if(U(Q.value))return 0;const e=Q.value[Q.value.length-1];return F.value-(e.top+e.height)})),te=l((()=>new UTSJSONObject({height:T.virtual?"".concat(F.value,"px"):"auto"}))),le=l((()=>new UTSJSONObject({height:T.virtual?"".concat(Z.value,"px"):"auto"}))),ae=l((()=>new UTSJSONObject({height:T.virtual?"".concat(ee.value,"px"):"auto"}))),re=a([]);const se=a(!1),ne=a("default"),ie=l((()=>{switch(ne.value){case"pulling":return T.refresherPullingText;case"refreshing":return T.refresherRefreshingText;default:return T.refresherDefaultText}}));function ue(e){x("scrolltoupper",e),x("top")}function oe(e){x("scrolltolower",e),x("bottom")}let ce=!1;function de(e){if(L.value=Math.floor(e.detail.scrollTop),ce)return null;re.value.forEach(((e,t)=>{L.value>=e&&(D.value=t)})),x("scroll",e)}function he(e){x("scrollend",e)}function fe(e){ce=!0,G.value=re.value[e],setTimeout((()=>{ce=!1}),300)}function pe(e){e.detail.dy>T.refresherThreshold&&(ne.value="pulling"),x("refresher-pulling",e)}function ve(e){ne.value="refreshing",se.value=!0,x("refresher-refresh",e),x("pull",e)}function Se(e){ne.value="default",x("refresher-restore",e)}function _e(e){ne.value="default",x("refresher-abort",e)}function be(){G.value=.01,N((()=>{G.value=0}))}return s((()=>{setTimeout((()=>{y().in(R).select(".cl-list-view__scroller").boundingClientRect().exec((e=>{var t;if(U(e))return null;K.value=null!==(t=e[0].height)&&void 0!==t?t:0}))}),100),r(l((()=>T.data)),(()=>{!function(){const e=[];let t=0;W.value.forEach((l=>{e.push(t),t+=T.headerHeight+l.children.length*T.itemHeight})),re.value=e}()}),{immediate:!0})})),h(new UTSJSONObject({data:W,stopRefresh:function(){se.value=!1,ne.value="default"}})),(t=null,l=null)=>{const a=$(j("cl-loading"),E),r=$(j("cl-text"),A),s=v,d=$(j("cl-empty"),M),h=V,p=$(j("cl-index-bar"),I),S=$(j("cl-back-top"),C);return n(),b(s,new UTSJSONObject({class:c(["cl-list-view",[new UTSJSONObject({}),z.value.className]])}),{default:o((()=>{var v,T;return[u(h,{class:c(["cl-list-view__scroller",[new UTSJSONObject({}),null===(v=z.value.scroller)||void 0===v?null:v.className]]),"scroll-top":G.value,"scroll-into-view":e.scrollIntoView,"scroll-with-animation":e.scrollWithAnimation,"show-scrollbar":e.showScrollbar,"refresher-triggered":se.value,"refresher-enabled":e.refresherEnabled,"refresher-threshold":e.refresherThreshold,"refresher-background":e.refresherBackground,"refresher-default-style":"none",direction:"vertical",onScrolltoupper:ue,onScrolltolower:oe,onScroll:de,onScrollend:he,onRefresherpulling:pe,onRefresherrefresh:ve,onRefresherrestore:Se,onRefresherabort:_e},{refresher:o((()=>{var l;return[u(s,{slot:"refresher",class:c(["cl-list-view__refresher",[new UTSJSONObject({}),new UTSJSONObject({"is-pulling":"pulling"===ne.value,"is-refreshing":"refreshing"===ne.value}),null===(l=z.value.refresher)||void 0===l?null:l.className]]),style:J({height:e.refresherThreshold+"px"})},{default:o((()=>[k(t.$slots,"refresher",new UTSJSONObject({status:ne.value,text:ie.value}),(()=>["refreshing"===ne.value?(n(),b(a,new UTSJSONObject({key:0,size:28,pt:new UTSJSONObject({className:"mr-2"})}))):H("",!0),u(r,null,{default:o((()=>[w(g(ie.value),1)])),_:1})]),!0)])),_:3},8,["class","style"])]})),default:o((()=>{var l;return[u(s,{class:c(["cl-list-view__virtual-list",[new UTSJSONObject({}),null===(l=z.value.list)||void 0===l?null:l.className]]),style:J(te.value)},{default:o((()=>[u(s,new UTSJSONObject({class:"cl-list-view__spacer-top",style:J(le.value)}),{default:o((()=>[k(t.$slots,"top",new UTSJSONObject({}),void 0,!0)])),_:3},8,["style"]),(n(!0),i(f,null,_(Q.value,((l,a)=>(n(),b(s,new UTSJSONObject({key:l.key,class:"cl-list-view__virtual-item"}),{default:o((()=>{var i,d;return["header"==l.type?(n(),b(s,new UTSJSONObject({key:0,class:c(["cl-list-view__header",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":O(m)})]]),style:J({height:e.headerHeight+"px"})}),new UTSJSONObject({default:o((()=>[k(t.$slots,"header",new UTSJSONObject({index:l.data.index}),(()=>[u(r,null,{default:o((()=>[w(g(l.data.label),1)])),_:2},1024)]),!0)])),_:2}),1032,["class","style"])):(n(),b(s,{key:1,class:c(["cl-list-view__item",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":O(m)}),null===(i=z.value.item)||void 0===i?null:i.className]]),"hover-class":null===(d=z.value.itemHover)||void 0===d?null:d.className,style:J({height:e.virtual?e.itemHeight+"px":"auto"}),onClick:(e=null)=>function(e){x("item-tap",e.data)}(l)},new UTSJSONObject({default:o((()=>[k(t.$slots,"item",new UTSJSONObject({item:l,data:l.data,value:l.data.value,index:a}),(()=>[u(s,new UTSJSONObject({class:"cl-list-view__item-inner"}),{default:o((()=>[u(r,null,{default:o((()=>[w(g(l.data.label),1)])),_:2},1024)])),_:2},1024)]),!0)])),_:2}),1032,["class","hover-class","style","onClick"]))]})),_:2},1024)))),128)),u(s,new UTSJSONObject({class:"cl-list-view__spacer-bottom",style:J(ae.value)}),{default:o((()=>[k(t.$slots,"bottom",new UTSJSONObject({}),void 0,!0)])),_:3},8,["style"])])),_:3},8,["class","style"]),P.value?(n(),b(d,new UTSJSONObject({key:0,fixed:!1}))):H("",!0)]})),_:3},8,["class","scroll-top","scroll-into-view","scroll-with-animation","show-scrollbar","refresher-triggered","refresher-enabled","refresher-threshold","refresher-background"]),Y.value?(n(),b(p,{key:0,modelValue:D.value,"onUpdate:modelValue":l[0]||(l[0]=(e=null)=>D.value=e),list:X.value,pt:{className:O(B)([null===(T=z.value.indexBar)||void 0===T?null:T.className])},onChange:fe},null,8,["modelValue","list","pt"])):H("",!0),Y.value?(n(),b(s,new UTSJSONObject({key:1,class:c(["cl-list-view__index",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":O(m)})]]),style:J({height:e.headerHeight+"px"})}),new UTSJSONObject({default:o((()=>[k(t.$slots,"index",new UTSJSONObject({index:X.value[D.value]}),(()=>[u(r,null,{default:o((()=>[w(g(X.value[D.value]),1)])),_:1})]),!0)])),_:3}),8,["class","style"])):H("",!0),e.showBackTop?(n(),b(S,new UTSJSONObject({key:2,top:L.value,onBackTop:be}),null,8,["top"])):H("",!0)]})),_:3},8,["class"])}}})),[["__scopeId","data-v-2e558224"]]);export{D as _};
