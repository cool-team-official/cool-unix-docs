import{_ as e}from"./cl-select-trigger.DYG7Z-Uq.js";import{d as a,t,b as l,r as u,h as n,U as r,a as s,o,l as c,c as p,v as d,e as i,w as v,F as S,V as f,Q as m,a4 as g,a5 as b,X as O,P as h,m as _,f as y,g as w,i as T,u as j,p as N,G as U,_ as J}from"./index-C9No-3tr.js";import{r as k,_ as x,d as Y,e as C,u as V,c as A}from"./cl-page.uvue_vue_type_script_setup_true_lang.BYryoqR_.js";import{_ as F}from"./cl-tag.DeVDV-VM.js";import{_ as M}from"./cl-picker-view.CcLCNQQx.js";import{d as B}from"./day.DRenYkEI.js";class D extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{trigger:{type:"Unknown",optional:!0},popup:{type:"Unknown",optional:!0}}}}}constructor(e,a=D.get$UTSMetadata$(),t=!1){super(),this.__props__=UTS.UTSType.initProps(e,a,t),this.trigger=this.__props__.trigger,this.popup=this.__props__.popup,delete this.__props__}}const P=A(a(Object.assign({name:"cl-select-date"},{__name:"cl-select-date",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:String,default:""},values:{type:Array,default:()=>[]},headers:{type:Array,default:()=>[t("年"),t("月"),t("日"),t("时"),t("分"),t("秒")]},title:{type:String,default:()=>t("请选择")},placeholder:{type:String,default:()=>t("请选择")},showTrigger:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},confirmText:{type:String,default:()=>t("确定")},showConfirm:{type:Boolean,default:!0},cancelText:{type:String,default:()=>t("取消")},showCancel:{type:Boolean,default:!0},labelFormat:{type:String,default:""},valueFormat:{type:String,default:""},start:{type:String,default:l.startDate},end:{type:String,default:l.endDate},type:{type:String,default:"second"},rangeable:{type:Boolean,default:!1},startPlaceholder:{type:String,default:()=>t("开始日期")},endPlaceholder:{type:String,default:()=>t("结束日期")},rangeSeparator:{type:String,default:()=>t("至")},showShortcuts:{type:Boolean,default:!0},shortcuts:{type:Array,default:()=>[]}},emits:["update:modelValue","change","update:values","range-change"],setup(a,l){var A=l.expose,D=l.emit;const P=a,$=D,I=V(),z=u(null),H=n((()=>f(P.pt))),R=n((()=>{switch(P.type){case"year":return"YYYY";case"month":return"YYYY-MM";case"date":return"YYYY-MM-DD";default:return"YYYY-MM-DD HH:mm:ss"}})),E=n((()=>m(P.labelFormat)||g(P.labelFormat)?R.value:P.labelFormat)),G=n((()=>m(P.valueFormat)||g(P.valueFormat)?R.value:P.valueFormat)),Q=u(-1),X=n((()=>g(P.shortcuts)?[{label:t("今天"),value:[B().format(G.value),B().format(G.value)]},{label:t("近7天"),value:[B().subtract(7,"day").format(G.value),B().format(G.value)]},{label:t("近30天"),value:[B().subtract(30,"day").format(G.value),B().format(G.value)]},{label:t("近90天"),value:[B().subtract(90,"day").format(G.value),B().format(G.value)]},{label:t("近一年"),value:[B().subtract(1,"year").format(G.value),B().format(G.value)]}]:P.shortcuts)),q=u(0),K=u(["",""]),L=u([]),W=n((()=>P.rangeable?0==q.value?P.start:K.value[0]:P.start)),Z=n((()=>{const e=b(B(W.value).toArray(),6),a=e[0],t=e[1],l=e[2],u=e[3],n=e[4],r=e[5],s=b(B(P.end).toArray(),6),o=s[0],c=s[1],p=s[2],d=s[3],i=s[4],v=s[5],S=[[],[],[],[],[],[]];if(g(L.value))return S;const f=b(L.value,5),m=f[0],O=f[1],h=f[2],_=f[3],y=f[4],w=[31,m%4==0&&m%100!=0||m%400==0?29:28,31,30,31,30,31,31,30,31,30,31][O>0?O-1:0],T=Math.max(60,o-a+1);for(let g=0;g<T;g++){const e=a+g;e<=o&&S[0].push({label:e.toString(),value:e});let s=a==m?t+g:g+1;s<=(o==m?c:12)&&S[1].push({label:s.toString().padStart(2,"0"),value:s});let f=a==m&&t==O?l+g:g+1;f<=(o==m&&c==O?p:w)&&S[2].push({label:f.toString().padStart(2,"0"),value:f});let b=a==m&&t==O&&l==h?u+g:g;b<(o==m&&c==O&&p==h?d:24)&&S[3].push({label:b.toString().padStart(2,"0"),value:b});let T=a==m&&t==O&&l==h&&u==_?n+g:g;T<(o==m&&c==O&&p==h&&d==_?i:60)&&S[4].push({label:T.toString().padStart(2,"0"),value:T});let j=a==m&&t==O&&l==h&&u==_&&n==y?r+g:g;j<(o==m&&c==O&&p==h&&d==_&&i==y?v:60)&&S[5].push({label:j.toString().padStart(2,"0"),value:j})}return S})),ee=n((()=>["year","month","date","hour","minute","second"].findIndex((e=>e==P.type))+1)),ae=n((()=>Z.value.slice(0,ee.value))),te=n((()=>g(L.value)?[]:L.value.map(((e,a)=>{let t=Z.value[a].findIndex((a=>a.value==e));return-1==t&&(t=Z.value[a].length-1),t<0&&(t=0),t}))));function le(){const e=[],a=[2e3,1,1,0,0,0];return["","-","-"," ",":",":"].forEach(((t,l)=>{let u=L.value[l];l>=ee.value&&(u=a[l]),e.push(t+u.toString().padStart(2,"0"))})),e.join("")}function ue(e){if(0==e.length)return e;const a=[...e],t=[2e3,1,1,0,0,0];for(let d=a.length;d<6;d++)a.push(t[d]);let l=b(a,6),u=l[0],n=l[1],r=l[2],s=l[3],o=l[4],c=l[5];const p=[31,u%4==0&&u%100!=0||u%400==0?29:28,31,30,31,30,31,31,30,31,30,31][n-1];return r<1?r=1:r>p&&(r=p),s<0?s=0:s>23&&(s=23),o<0?o=0:o>59&&(o=59),c<0?c=0:c>59&&(c=59),[u,n,r,s,o,c]}const ne=u("");function re(){P.rangeable?ne.value=K.value.map((e=>B(e).format(E.value))).join(" ".concat(P.rangeSeparator," ")):ne.value=B(le()).format(E.value)}function se(e){return U(this,void 0,void 0,(function*(){L.value=ue(e),B(le()).isAfter(B(P.end))&&(L.value=B(P.end).toArray()),B(le()).isBefore(B(P.start))&&(L.value=B(P.start).toArray()),P.rangeable&&(K.value[q.value]=B(le()).format(G.value),B(K.value[0]).isAfter(B(K.value[1]))&&""!=K.value[1]&&(K.value[1]=K.value[0]),Q.value=-1)}))}function oe(e){ne.value="",m(e)||g(e)?L.value=ue(B().toArray()):(L.value=ue(B(e).toArray()),re())}function ce(e){g(e)?K.value=["",""]:K.value=e}function pe(e){q.value=e,oe(K.value[e])}const de=u(!1);let ie=null;function ve(e=null){if(P.disabled)return null;de.value=!0,ie=e,O((()=>{P.rangeable?(q.value=0,ce(P.values),oe(K.value[0])):oe(P.modelValue)}))}function Se(){de.value=!1}function fe(){K.value=["",""]}function me(){ne.value="",P.rangeable?($("update:values",[]),$("range-change",[])):($("update:modelValue",""),$("change",""))}function ge(){if(P.rangeable){const e=b(K.value,2),a=e[0],l=e[1];if(""==a||""==l)return I.showToast({message:t("请选择完整时间范围")}),""!=a&&(q.value=1),null;if(B(a).isAfter(B(l)))return I.showToast({message:t("开始日期不能大于结束日期")}),null;$("update:values",K.value),$("range-change",K.value),null!=ie&&ie(K.value)}else{const e=B(le()).format(G.value);$("update:modelValue",e),$("change",e),null!=ie&&ie(e)}re(),Se()}return r(n((()=>P.modelValue)),(e=>{oe(e)}),{immediate:!0}),r(n((()=>P.values)),(e=>{ce(e)}),{immediate:!0}),r(n((()=>P.labelFormat)),(()=>{re()})),A(new UTSJSONObject({open:ve,close:Se,clear:me,confirm:ge,setValue:oe,setValues:ce,setRange:pe})),(t=null,l=null)=>{var u,n,r,f,m,g,b,O;const U=k(s("cl-select-trigger"),e),V=k(s("cl-tag"),F),A=J,B=k(s("cl-text"),x),D=k(s("cl-picker-view"),M),P=k(s("cl-button"),Y),$=k(s("cl-popup"),C);return o(),c(S,null,[a.showTrigger?(o(),p(U,{key:0,pt:{className:null===(u=H.value.trigger)||void 0===u?null:u.className,icon:null===(n=H.value.trigger)||void 0===n?null:n.icon},placeholder:a.placeholder,disabled:a.disabled,focus:null===(r=z.value)||void 0===r?null:r.isOpen,text:ne.value,"arrow-icon":"calendar-line",onOpen:l[0]||(l[0]=(e=null)=>ve()),onClear:me},null,8,["pt","placeholder","disabled","focus","text"])):d("",!0),i($,{ref_key:"popupRef",ref:z,modelValue:de.value,"onUpdate:modelValue":l[4]||(l[4]=(e=null)=>de.value=e),title:a.title,pt:{className:null===(f=H.value.popup)||void 0===f?null:f.className,header:null===(m=H.value.popup)||void 0===m?null:m.header,container:null===(g=H.value.popup)||void 0===g?null:g.container,mask:null===(b=H.value.popup)||void 0===b?null:b.mask,draw:null===(O=H.value.popup)||void 0===O?null:O.draw},onClosed:fe},{default:v((()=>[i(A,new UTSJSONObject({class:"cl-select-popup",onTouchmove:l[3]||(l[3]=h((()=>{}),["stop"]))}),{default:v((()=>[a.rangeable?(o(),p(A,new UTSJSONObject({key:0,class:"cl-select-popup__range"}),new UTSJSONObject({default:v((()=>[a.showShortcuts?(o(),p(A,new UTSJSONObject({key:0,class:"cl-select-popup__range-shortcuts"}),new UTSJSONObject({default:v((()=>[(o(!0),c(S,null,_(X.value,((e,a)=>(o(),p(V,new UTSJSONObject({key:a,plain:"",type:Q.value==a?"primary":"info",onClick:(t=null)=>function(e,a){Q.value=a,K.value=[...e],oe(e[q.value])}(e.value,a)}),new UTSJSONObject({default:v((()=>[y(w(e.label),1)])),_:2}),1032,["type","onClick"])))),128))])),_:1}))):d("",!0),i(A,new UTSJSONObject({class:"cl-select-popup__range-values"}),{default:v((()=>[i(A,new UTSJSONObject({class:T(["cl-select-popup__range-values-start",new UTSJSONObject({"is-dark":j(N),active:0==q.value})]),onClick:l[1]||(l[1]=(e=null)=>pe(0))}),{default:v((()=>[K.value.length>0&&""!=K.value[0]?(o(),p(B,new UTSJSONObject({key:0,pt:new UTSJSONObject({className:"text-center"})}),new UTSJSONObject({default:v((()=>[y(w(K.value[0]),1)])),_:1}))):(o(),p(B,new UTSJSONObject({key:1,pt:new UTSJSONObject({className:"text-center -important-text-surface-400"})}),new UTSJSONObject({default:v((()=>[y(w(a.startPlaceholder),1)])),_:1})))])),_:1},8,["class"]),i(B,new UTSJSONObject({pt:new UTSJSONObject({className:"mx-3"})}),{default:v((()=>[y(w(a.rangeSeparator),1)])),_:1}),i(A,new UTSJSONObject({class:T(["cl-select-popup__range-values-end",new UTSJSONObject({"is-dark":j(N),active:1==q.value})]),onClick:l[2]||(l[2]=(e=null)=>pe(1))}),{default:v((()=>[K.value.length>1&&""!=K.value[1]?(o(),p(B,new UTSJSONObject({key:0,pt:new UTSJSONObject({className:"text-center"})}),new UTSJSONObject({default:v((()=>[y(w(K.value[1]),1)])),_:1}))):(o(),p(B,new UTSJSONObject({key:1,pt:new UTSJSONObject({className:"text-center -important-text-surface-400"})}),new UTSJSONObject({default:v((()=>[y(w(a.endPlaceholder),1)])),_:1})))])),_:1},8,["class"])])),_:1})])),_:1}))):d("",!0),i(A,new UTSJSONObject({class:"cl-select-popup__picker"}),{default:v((()=>[i(D,new UTSJSONObject({headers:a.headers,value:te.value,columns:ae.value,"reset-on-change":!1,onChangeValue:se}),null,8,["headers","value","columns"])])),_:1}),i(A,new UTSJSONObject({class:"cl-select-popup__op"}),{default:v((()=>[a.showCancel?(o(),p(P,new UTSJSONObject({key:0,size:"large",text:"",border:"",type:"light",pt:new UTSJSONObject({className:"flex-1 -important-rounded-xl h--bracket-start-80rpx-bracket-end-"}),onClick:Se}),new UTSJSONObject({default:v((()=>[y(w(a.cancelText),1)])),_:1}))):d("",!0),a.showConfirm?(o(),p(P,new UTSJSONObject({key:1,size:"large",pt:new UTSJSONObject({className:"flex-1 -important-rounded-xl h--bracket-start-80rpx-bracket-end-"}),onClick:ge}),new UTSJSONObject({default:v((()=>[y(w(a.confirmText),1)])),_:1}))):d("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue","title","pt"])],64)}}})),[["__scopeId","data-v-37e113c8"]]);export{P as _};
