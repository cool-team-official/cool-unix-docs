import{r as e,_ as l,c as t,m as a}from"./cl-page.uvue_vue_type_script_setup_true_lang.BiE4Gfav.js";import{d as r,h as n,U as s,a1 as u,aB as o,a as i,o as c,c as d,w as p,i as v,V as m,_ as f,e as S,n as b,f as O,g as w,v as g,I as T,u as _,z as y,aq as U,a0 as N,r as h,G as j,X as J,a2 as x,ah as A,a4 as M,aC as k,t as E,$ as q,aD as B}from"./index-B_3GhiAr.js";import{u as P}from"./form.C1qv6o9s.js";UTS.UTSType;const $=t(r(Object.assign({name:"cl-form-item"},{__name:"cl-form-item",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},label:{type:String,default:""},prop:{type:String,default:""},rules:{type:Array,default:()=>[]},labelPosition:{type:String,default:null},labelWidth:{type:String,default:null},showAsterisk:{type:Boolean,default:null},showMessage:{type:Boolean,default:null},required:{type:Boolean,default:!1}},setup(t,a){var r=a.expose;const N=t,h=P(),j=h.formRef,J=h.getError,x=h.getValue,A=h.validateField,M=h.addField,k=h.removeField,E=h.setRule,q=n((()=>m(N.pt))),B=n((()=>J(N.prop))),$=n((()=>""!=B.value)),F=n((()=>{var e,l,t;return null!==(t=null!==(e=N.labelPosition)&&void 0!==e?e:null===(l=j.value)||void 0===l?null:l.labelPosition)&&void 0!==t?t:"left"})),R=n((()=>{var e,l,t;return null!==(t=null!==(e=N.labelWidth)&&void 0!==e?e:null===(l=j.value)||void 0===l?null:l.labelWidth)&&void 0!==t?t:"120rpx"})),V=n((()=>{var e,l,t;return!!N.required&&(null===(t=null!==(e=N.showAsterisk)&&void 0!==e?e:null===(l=j.value)||void 0===l?null:l.showAsterisk)||void 0===t||t)})),W=n((()=>{var e,l,t;return!!N.required&&(null===(t=null!==(e=N.showMessage)&&void 0!==e?e:null===(l=j.value)||void 0===l?null:l.showMessage)||void 0===t||t)}));return s(n((()=>N.required)),(e=>{e?M(N.prop,N.rules):k(N.prop)}),{immediate:!0}),u((()=>{s(n((()=>{const e=x(N.prop);return null==e?"":e})),((e=null,l=null)=>{N.required&&(U(e,l)||A(N.prop))}),{deep:!0}),s(n((()=>N.rules)),(e=>{E(N.prop,e)}),{deep:!0})})),o((()=>{k(N.prop)})),r(new UTSJSONObject({prop:N.prop})),(a=null,r=null)=>{const n=e(i("cl-text"),l),s=f;return c(),d(s,new UTSJSONObject({class:v(["cl-form-item",[new UTSJSONObject({}),new UTSJSONObject({"cl-form-item--error":$.value}),q.value.className]]),id:"cl-form-item-".concat(t.prop)}),{default:p((()=>{var e;return[S(s,{class:v(["cl-form-item__inner",[new UTSJSONObject({}),"is-".concat(F.value),null===(e=q.value.inner)||void 0===e?null:e.className]])},{default:p((()=>{var e,l;return[""!=t.label?(c(),d(s,{key:0,class:v(["cl-form-item__label",[new UTSJSONObject({}),"is-".concat(F.value),null===(e=q.value.label)||void 0===e?null:e.className]]),style:b({width:"top"!=F.value?R.value:"auto"})},new UTSJSONObject({default:p((()=>[S(n,null,{default:p((()=>[O(w(t.label),1)])),_:1}),V.value?(c(),d(n,new UTSJSONObject({key:0,color:"error",pt:new UTSJSONObject({className:"ml-1"})}),new UTSJSONObject({default:p((()=>[O(" * ")])),_:1}))):g("",!0)])),_:1}),8,["class","style"])):g("",!0),S(s,{class:v(["cl-form-item__content",[new UTSJSONObject({}),null===(l=q.value.content)||void 0===l?null:l.className]])},{default:p((()=>[T(a.$slots,"default",new UTSJSONObject({}),void 0,!0)])),_:3},8,["class"])]})),_:3},8,["class"]),$.value&&W.value?(c(),d(s,new UTSJSONObject({key:0,class:"cl-form-item__error"}),{default:p((()=>[T(a.$slots,"error",new UTSJSONObject({error:B.value}),(()=>{var e;return[S(n,{color:"error",pt:{className:_(y)(["mt-2 -important-text-sm",null===(e=q.value.error)||void 0===e?null:e.className])}},{default:p((()=>[O(w(B.value),1)])),_:1},8,["pt"])]}),!0)])),_:3})):g("",!0)]})),_:3},8,["class","id"])}}})),[["__scopeId","data-v-0a3daede"]]);class F extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0}}}}}constructor(e,l=F.get$UTSMetadata$(),t=!1){super(),this.__props__=UTS.UTSType.initProps(e,l,t),this.className=this.__props__.className,delete this.__props__}}const R=t(r(Object.assign({name:"cl-form"},{__name:"cl-form",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:Object,default:()=>new UTSJSONObject({})},rules:{type:Object,default:()=>new Map},labelPosition:{type:String,default:"top"},labelWidth:{type:String,default:"140rpx"},showAsterisk:{type:Boolean,default:!0},showMessage:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},scrollToError:{type:Boolean,default:!0}},setup(e,l){var t=l.expose;const r=e,u=N().proxy,o=a(),i=n((()=>m(r.pt))),S=h(new UTSJSONObject({})),b=h(new Map),O=h(new Set([])),w=n((()=>r.labelPosition)),g=n((()=>r.labelWidth)),_=n((()=>r.showAsterisk)),y=n((()=>r.showMessage)),U=n((()=>r.disabled)),P=h(!1);function $(e,l){if(P.value)return null;""!=e&&b.value.set(e,l)}function F(e){""!=e&&b.value.delete(e)}function R(e){var l;return""!=e&&null!==(l=b.value.get(e))&&void 0!==l?l:""}function V(){return j(this,void 0,void 0,(function*(){return new Promise((e=>{const l=[],t=new Map;function a(){var a;t.forEach(((e,t)=>{l.push({field:t,message:R(t)})})),r.scrollToError&&l.length>0&&o.scrollTo((null!==(a=UTS.mapGet(t,l[0].field))&&void 0!==a?a:0)+o.getScrollTop()),e(l)}if(0==b.value.size)return a(),null;J((()=>{let e=u;x().in(e).selectAll(".cl-form-item--error").boundingClientRect(((e=null)=>{e.map((e=>{var l,a;t.set((null!==(l=e.id)&&void 0!==l?l:"").replace("cl-form-item-",""),null!==(a=e.top)&&void 0!==a?a:0)})),a()})).exec()}))}))}))}function W(){b.value.clear()}function G(e){return""!=e?A(S.value,e,null):null}function I(e){var l;return null!==(l=UTS.mapGet(r.rules,e))&&void 0!==l?l:[]}function z(e,l){""==e||M(l)||r.rules.set(e,l)}function C(e){""!=e&&r.rules.delete(e)}function D(e=null,l){var t,a,r,n,s,u,o;if(1==l.required&&(null==e||""==e&&k(e)||Array.isArray(e)&&0==e.length))return null!==(t=l.message)&&void 0!==t?t:E("此字段为必填项");if((null==e||""==e&&k(e))&&1!=l.required)return null;if(null!=l.min)if("number"==typeof e){if(e<l.min)return null!==(a=l.message)&&void 0!==a?a:q("最小值为{min}",new UTSJSONObject({min:l.min}))}else{if((Array.isArray(e)?e.length:"".concat(e).length)<l.min)return null!==(r=l.message)&&void 0!==r?r:q("最少需要{min}个字符",new UTSJSONObject({min:l.min}))}if(null!=l.max)if("number"==typeof e){if(e>l.max)return null!==(n=l.message)&&void 0!==n?n:q("最大值为{max}",new UTSJSONObject({max:l.max}))}else{if((Array.isArray(e)?e.length:"".concat(e).length)>l.max)return null!==(s=l.message)&&void 0!==s?s:q("最多允许{max}个字符",new UTSJSONObject({max:l.max}))}if(null!=l.pattern&&!l.pattern.test("".concat(e)))return null!==(u=l.message)&&void 0!==u?u:E("格式不正确");if(null!=l.validator){const t=l.validator(e);if(1!=t)return"string"==typeof t?t:null!==(o=l.message)&&void 0!==o?o:E("验证失败")}return null}function X(e){let l=null;if(""!=e){const t=G(e),a=I(e);M(a)||UTS.arrayFind(a,(e=>{const a=D(t,e);return null!=a&&(l=a,!0)})),F(e)}return null!=l&&$(e,l),l}return s(n((()=>B(r.modelValue))),(e=>{S.value=e}),{immediate:!0,deep:!0}),t(new UTSJSONObject({labelPosition:w,labelWidth:g,showAsterisk:_,showMessage:y,disabled:U,data:S,errors:b,fields:O,addField:function(e,l){""!=e&&(O.value.add(e),z(e,l))},removeField:function(e){""!=e&&(O.value.delete(e),C(e),F(e))},getValue:G,setError:$,getError:R,getErrors:V,removeError:F,clearErrors:W,getRule:I,setRule:z,removeRule:C,validateRule:D,clearValidate:function(){P.value=!0,J((()=>{W(),P.value=!1}))},validateField:X,validate:function(e){return j(this,void 0,void 0,(function*(){O.value.forEach((e=>{X(e)}));const l=yield V();e(0==l.length,l)}))}})),(e=null,l=null)=>{const t=f;return c(),d(t,new UTSJSONObject({class:v(["cl-form",[new UTSJSONObject({}),"cl-form--label-".concat(w.value),new UTSJSONObject({"cl-form--disabled":U.value}),i.value.className]])}),new UTSJSONObject({default:p((()=>[T(e.$slots,"default",new UTSJSONObject({}),void 0,!0)])),_:3}),8,["class"])}}})),[["__scopeId","data-v-8d7b7bbe"]]);export{$ as _,R as a};
