import{d as e,a4 as t,c as l,aF as n,af as a,z as s,a5 as i,T as o,o as u,a as r,w as c,n as p,U as d,aA as h,_,b as f,W as S,O as m,E as g,aB as T,aC as b,aa as y,r as v,u as U,f as w,ar as O}from"./index-D_tQ-ve6.js";import{c as N}from"./file.CPlJqQP6.js";import{r as x,d as j,b as k}from"./cl-page.uvue_vue_type_script_setup_true_lang.CnnNiCbP.js";import{_ as J,a as W}from"./cl-list.DyI0wbP4.js";import{_ as $}from"./cl-switch.DAqbFgNy.js";import"./cl-collapse.CNrLdOnx.js";import"./index.U6ITPUe7.js";class C extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{x:{type:Number,optional:!1},y:{type:Number,optional:!1},time:{type:Number,optional:!1}}}}}constructor(e,t=C.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.x=this.__props__.x,this.y=this.__props__.y,this.time=this.__props__.time,delete this.__props__}}class M extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{left:{type:Number,optional:!1},top:{type:Number,optional:!1}}}}}constructor(e,t=M.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.left=this.__props__.left,this.top=this.__props__.top,delete this.__props__}}class B extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0}}}}}constructor(e,t=B.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.className=this.__props__.className,delete this.__props__}}const P=e(Object.assign({name:"cl-sign"},{__name:"cl-sign",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},width:{type:Number,default:300},height:{type:Number,default:200},strokeColor:{type:String,default:"#000000"},strokeWidth:{type:Number,default:3},backgroundColor:{type:String,default:"#ffffff"},enableBrush:{type:Boolean,default:!0},minStrokeWidth:{type:Number,default:1},maxStrokeWidth:{type:Number,default:6},velocitySensitivity:{type:Number,default:.7}},emits:["change"],setup(e,y){var v=y.expose,U=y.emit;const w=e,O=U,x=t().proxy,j=l((()=>d(w.pt))),k=n(null);let J=null;const W="cl-sign__".concat(a()),$=s(!1);let M=null,B=s(3);const P=[];function R(e){const t=e.touches[0],l=e.target.getBoundingClientRect();return new C({x:t.clientX-l.left,y:t.clientY-l.top,time:Date.now()})}function V(e){return g(this,void 0,void 0,(function*(){e.preventDefault(),$.value=!0,M=R(e),B.value=w.enableBrush?w.maxStrokeWidth:w.strokeWidth,P.length=0}))}function D(e){if(e.preventDefault(),!$.value||null==M||null==J)return null;const t=R(e),l=function(e){if(null==M||!w.enableBrush)return w.strokeWidth;const t=Math.sqrt(Math.pow(e.x-M.x,2)+Math.pow(e.y-M.y,2)),l=e.time-M.time;if(l<=0)return B.value;const n=t/l;P.push(n),P.length>5&&UTS.arrayShift(P);const a=P.reduce(((e,t)=>e+t),0)/P.length,s=Math.min(a*w.velocitySensitivity,1),i=w.maxStrokeWidth-w.minStrokeWidth,o=w.maxStrokeWidth-s*i;return B.value+.3*(o-B.value)}(t);B.value=l,J.beginPath(),J.moveTo(M.x,M.y),J.lineTo(t.x,t.y),J.strokeStyle=w.strokeColor,J.lineWidth=l,J.lineCap="round",J.lineJoin="round",J.stroke(),M=t,O("change")}function z(e){e.preventDefault(),$.value=!1,M=null}function A(){if(null==J)return null;J.clearRect(0,0,w.width,w.height),b().devicePixelRatio,J.fillStyle=w.backgroundColor,J.fillRect(0,0,w.width,w.height),O("change")}function q(){h({id:W,component:x,success:e=>{J=e.getContext("2d"),J.canvas.width=w.width,J.canvas.height=w.height,J.textBaseline="middle",J.textAlign="center",J.miterLimit=10,A()}})}return i((()=>{q(),o(l((()=>[w.width,w.height])),(()=>{q()}))})),v(new UTSJSONObject({clear:A,toPng:function(){return N({proxy:x,canvasId:W,canvasRef:k.value})}})),(t=null,l=null)=>{const n=T,a=_;return u(),r(a,new UTSJSONObject({class:p(["cl-sign",[new UTSJSONObject({}),j.value.className]])}),new UTSJSONObject({default:c((()=>[f(n,new UTSJSONObject({class:"cl-sign__canvas",ref_key:"canvasRef",ref:k,id:W,style:S({height:"".concat(e.height,"px"),width:"".concat(e.width,"px")}),onTouchstart:V,onTouchmove:m(D,["stop","prevent"]),onTouchend:z}),null,8,["style"])])),_:1}),8,["class"])}}})),R=e({__name:"sign",setup(e){const t=y(),l=t.windowWidth,n=t.windowHeight,a=s(!1),i=s(!0),o=s(null);function p(){o.value.clear()}function d(){o.value.toPng().then((e=>{O({urls:[e]})}))}return(e=null,t=null)=>{const s=x(v("cl-sign"),P),h=x(v("cl-button"),j),S=x(v("cl-list-item"),J),m=x(v("cl-switch"),$),g=x(v("cl-list"),W),T=_,b=x(v("cl-page"),k);return u(),r(b,null,new UTSJSONObject({default:c((()=>[f(s,new UTSJSONObject({ref_key:"signRef",ref:o,height:a.value?U(n)-200:200,width:U(l),"enable-brush":i.value}),null,8,["height","width","enable-brush"]),f(T,new UTSJSONObject({class:"p-3"}),{default:c((()=>[f(g,null,{default:c((()=>[f(S,new UTSJSONObject({label:"操作"}),{default:c((()=>[f(h,new UTSJSONObject({type:"info",onClick:p}),{default:c((()=>[w("清空")])),_:1}),f(h,new UTSJSONObject({onClick:d}),{default:c((()=>[w("预览")])),_:1})])),_:1}),f(S,new UTSJSONObject({label:"全屏"}),{default:c((()=>[f(m,new UTSJSONObject({modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=(e=null)=>a.value=e)}),null,8,["modelValue"])])),_:1}),f(S,new UTSJSONObject({label:"毛笔效果"}),{default:c((()=>[f(m,new UTSJSONObject({modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=(e=null)=>i.value=e)}),null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}))}}});export{R as default};
