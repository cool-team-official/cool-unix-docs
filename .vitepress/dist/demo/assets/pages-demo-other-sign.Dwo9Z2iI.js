import{d as e,a4 as t,c as l,aF as a,af as n,z as s,a5 as i,T as o,o as u,a as r,w as c,n as p,U as d,aA as h,_,b as f,W as S,O as m,E as g,V as b,aB as T,aC as y,aa as v,r as U,u as w,t as O,f as N,g as x,ar as j}from"./index-utI040hk.js";import{c as k}from"./file.D31RUp7W.js";import{o as J,r as W,d as $,b as C}from"./cl-page.uvue_vue_type_script_setup_true_lang.fA40QWeW.js";import{_ as M,a as B}from"./cl-list.D_4mG1WC.js";import{_ as P}from"./cl-switch.D2m-zvw7.js";import"./cl-collapse.BFQreZNL.js";import"./index.U6ITPUe7.js";class V extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{x:{type:Number,optional:!1},y:{type:Number,optional:!1},time:{type:Number,optional:!1}}}}}constructor(e,t=V.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.x=this.__props__.x,this.y=this.__props__.y,this.time=this.__props__.time,delete this.__props__}}class R extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{left:{type:Number,optional:!1},top:{type:Number,optional:!1}}}}}constructor(e,t=R.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.left=this.__props__.left,this.top=this.__props__.top,delete this.__props__}}class D extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0}}}}}constructor(e,t=D.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.className=this.__props__.className,delete this.__props__}}const A=e(Object.assign({name:"cl-sign"},{__name:"cl-sign",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},width:{type:Number,default:300},height:{type:Number,default:200},strokeColor:{type:String,default:"#000000"},strokeWidth:{type:Number,default:3},backgroundColor:{type:String,default:"#ffffff"},enableBrush:{type:Boolean,default:!0},minStrokeWidth:{type:Number,default:1},maxStrokeWidth:{type:Number,default:6},velocitySensitivity:{type:Number,default:.7}},emits:["change"],setup(e,v){var U=v.expose,w=v.emit;const O=e,N=w,x=t().proxy,j=l((()=>d(O.pt))),J=a(null);let W=null;const $="cl-sign__".concat(n()),C=s(!1);let M=null,B=s(3);const P=[];function R(e){const t=e.touches[0],l=e.target.getBoundingClientRect();return new V({x:t.clientX-l.left,y:t.clientY-l.top,time:Date.now()})}function D(e){return g(this,void 0,void 0,(function*(){e.preventDefault(),C.value=!0,M=R(e),B.value=O.enableBrush?O.maxStrokeWidth:O.strokeWidth,P.length=0}))}function A(e){if(e.preventDefault(),!C.value||null==M||null==W)return null;const t=R(e),l=function(e){if(null==M||!O.enableBrush)return O.strokeWidth;const t=Math.sqrt(Math.pow(e.x-M.x,2)+Math.pow(e.y-M.y,2)),l=e.time-M.time;if(l<=0)return B.value;const a=t/l;P.push(a),P.length>5&&UTS.arrayShift(P);const n=P.reduce(((e,t)=>e+t),0)/P.length,s=Math.min(n*O.velocitySensitivity,1),i=O.maxStrokeWidth-O.minStrokeWidth,o=O.maxStrokeWidth-s*i;return B.value+.3*(o-B.value)}(t);B.value=l,W.beginPath(),W.moveTo(M.x,M.y),W.lineTo(t.x,t.y),W.strokeStyle=O.strokeColor,W.lineWidth=l,W.lineCap="round",W.lineJoin="round",W.stroke(),M=t,N("change")}function q(e){e.preventDefault(),C.value=!1,M=null}function z(){if(null==W)return null;W.clearRect(0,0,O.width,O.height),y().devicePixelRatio,W.fillStyle=O.backgroundColor,W.fillRect(0,0,O.width,O.height),N("change")}function E(){h({id:$,component:x,success:e=>{W=e.getContext("2d"),W.canvas.width=O.width,W.canvas.height=O.height,W.textBaseline="middle",W.textAlign="center",W.miterLimit=10,z()}})}return i((()=>{E(),o(l((()=>[O.width,O.height])),(()=>{b((()=>{E()}))}))})),U(new UTSJSONObject({clear:z,toPng:function(){return k(J.value)}})),(t=null,l=null)=>{const a=T,n=_;return u(),r(n,new UTSJSONObject({class:p(["cl-sign",[new UTSJSONObject({}),j.value.className]])}),new UTSJSONObject({default:c((()=>[f(a,new UTSJSONObject({class:"cl-sign__canvas",ref_key:"canvasRef",ref:J,id:$,style:S({height:"".concat(e.height,"px"),width:"".concat(e.width,"px")}),onTouchstart:D,onTouchmove:m(A,["stop","prevent"]),onTouchend:q}),null,8,["style"])])),_:1}),8,["class"])}}})),q=e({__name:"sign",setup(e){const t=s(0),l=s(0),a=s(!1),n=s(!0),i=s(null);function o(){i.value.clear()}function p(){i.value.toPng().then((e=>{j({urls:[e]})}))}function d(){t.value=a.value?v().windowHeight-200:200}return J((()=>{const e=v().windowWidth;t.value=200,l.value=e})),(e=null,s=null)=>{const h=W(U("cl-sign"),A),S=W(U("cl-button"),$),m=W(U("cl-list-item"),M),g=W(U("cl-switch"),P),b=W(U("cl-list"),B),T=_,y=W(U("cl-page"),C);return u(),r(y,null,new UTSJSONObject({default:c((()=>[f(h,new UTSJSONObject({ref_key:"signRef",ref:i,height:t.value,width:l.value,"enable-brush":n.value}),null,8,["height","width","enable-brush"]),f(T,new UTSJSONObject({class:"p-3"}),{default:c((()=>[f(b,null,{default:c((()=>[f(m,new UTSJSONObject({label:w(O)("操作")}),{default:c((()=>[f(S,new UTSJSONObject({type:"info",onClick:o}),{default:c((()=>[N(x(w(O)("清空")),1)])),_:1}),f(S,new UTSJSONObject({onClick:p}),{default:c((()=>[N(x(w(O)("预览")),1)])),_:1})])),_:1},8,["label"]),f(m,new UTSJSONObject({label:w(O)("设置高度")}),{default:c((()=>[f(g,new UTSJSONObject({modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=(e=null)=>a.value=e),onChange:d}),null,8,["modelValue"])])),_:1},8,["label"]),f(m,new UTSJSONObject({label:w(O)("毛笔效果")}),{default:c((()=>[f(g,new UTSJSONObject({modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=(e=null)=>n.value=e)}),null,8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1})])),_:1}))}}});export{q as default};
