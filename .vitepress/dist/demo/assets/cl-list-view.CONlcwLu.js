import{K as e,d as t,a0 as l,h as a,r,U as s,a1 as n,o as i,l as u,e as o,w as c,i as d,ak as h,al as f,F as p,V as v,_ as S,P as _,m as b,c as O,u as m,p as w,f as g,g as T,ai as N,X as y,a2 as U,a4 as x,t as j,a as J,n as k,I as H,v as B,z as V,av as R}from"./index-B_3GhiAr.js";import{c as $,r as E,g as A,_ as C,l as I}from"./cl-page.uvue_vue_type_script_setup_true_lang.BiE4Gfav.js";import{_ as M}from"./cl-empty.Ai_RyYKn.js";function z(t){return t.map((t=>e(Object.assign(Object.assign({},t),{value:t}))))}function P(t){return t.map((t=>e(t)))}UTS.UTSType;const D=$(t(Object.assign({name:"cl-index-bar"},{__name:"cl-index-bar",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:Number,default:0},list:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(e,t){var j=t.emit;const J=e,k=j,H=l().proxy,B=a((()=>v(J.pt))),V=r({height:0,width:0,left:0,top:0}),R=r([]),$=r(!1),E=r(!1),A=r(""),C=r(-1);function I(){y((()=>{setTimeout((()=>{U().in(H).select(".cl-index-bar").boundingClientRect().exec((e=>{if(x(e))return null;V.value=e[0],U().in(H).selectAll(".cl-index-bar__item").boundingClientRect().exec((e=>{if(x(e))return I(),null;R.value=e[0]}))}))}),350)}))}function M(e){var t,l;if(0==R.value.length)return 0;let a=0,r=Number.MAX_VALUE;for(let s=0;s<R.value.length;s++){const n=R.value[s],i=(null!==(t=n.top)&&void 0!==t?t:0)+(null!==(l=n.height)&&void 0!==l?l:0)/2,u=Math.abs(e-i);u<r&&(r=u,a=s)}return a<0?a=0:a>=J.list.length&&(a=J.list.length-1),a}function z(e){C.value=e,A.value=J.list[e]}function P(e){$.value=!0,E.value=!0;z(M(e.touches[0].clientY))}function D(e){if(!$.value)return null;z(M(e.touches[0].clientY))}function W(){$.value=!1,J.modelValue!=C.value&&(k("update:modelValue",C.value),k("change",C.value)),setTimeout((()=>{E.value=!1}),500)}return s(a((()=>J.modelValue)),(e=>{C.value=e}),{immediate:!0}),n((()=>{s(a((()=>J.list)),(()=>{I()}),{immediate:!0})})),(t=null,l=null)=>{const a=N,r=S;return i(),u(p,null,[o(r,new UTSJSONObject({class:d(["cl-index-bar",[new UTSJSONObject({}),B.value.className]])}),{default:c((()=>[o(r,new UTSJSONObject({class:"cl-index-bar__list",onTouchstart:P,onTouchmove:_(D,["stop","prevent"]),onTouchend:W}),{default:c((()=>[(i(!0),u(p,null,b(e.list,((e,t)=>(i(),O(r,new UTSJSONObject({class:"cl-index-bar__item",key:t}),new UTSJSONObject({default:c((()=>[o(r,new UTSJSONObject({class:d(["cl-index-bar__item-inner",new UTSJSONObject({"is-active":C.value==t})])}),{default:c((()=>[o(a,new UTSJSONObject({class:d(["cl-index-bar__item-text",new UTSJSONObject({"dark-colon-text-surface-50":m(w),"is-active":C.value==t||m(w)})])}),{default:c((()=>[g(T(e),1)])),_:2},1032,["class"])])),_:2},1032,["class"])])),_:2}),1024)))),128))])),_:1})])),_:1},8,["class"]),h(o(r,new UTSJSONObject({class:"cl-index-bar__alert"}),{default:c((()=>[o(r,new UTSJSONObject({class:d(["cl-index-bar__alert-icon",new UTSJSONObject({"dark-colon--important-bg-surface-800":m(w)})])}),{default:c((()=>[o(r,new UTSJSONObject({class:d(["cl-index-bar__alert-arrow",new UTSJSONObject({"dark-colon--important-bg-surface-800":m(w)})])}),null,8,["class"]),o(a,new UTSJSONObject({class:d(["cl-index-bar__alert-text",new UTSJSONObject({"dark-colon-text-surface-50":m(w),"dark-colon--important-text-white":m(w)})])}),{default:c((()=>[g(T(A.value),1)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1},512),[[f,E.value]])],64)}}})),[["__scopeId","data-v-d5380a69"]]);class W extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},item:{type:"Unknown",optional:!0},itemHover:{type:"Unknown",optional:!0},list:{type:"Unknown",optional:!0},indexBar:{type:"Unknown",optional:!0},scroller:{type:"Unknown",optional:!0},refresher:{type:"Unknown",optional:!0}}}}}constructor(e,t=W.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.className=this.__props__.className,this.item=this.__props__.item,this.itemHover=this.__props__.itemHover,this.list=this.__props__.list,this.indexBar=this.__props__.indexBar,this.scroller=this.__props__.scroller,this.refresher=this.__props__.refresher,delete this.__props__}}const X=$(t(Object.assign({name:"cl-list-view"},{__name:"cl-list-view",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},data:{type:Array,default:()=>[]},itemHeight:{type:Number,default:50},headerHeight:{type:Number,default:32},topHeight:{type:Number,default:0},bottomHeight:{type:Number,default:0},bufferSize:{type:Number,default:15},virtual:{type:Boolean,default:!0},scrollIntoView:{type:String,default:""},scrollWithAnimation:{type:Boolean,default:!1},showScrollbar:{type:Boolean,default:!1},refresherEnabled:{type:Boolean,default:!1},refresherThreshold:{type:Number,default:50},refresherBackground:{type:String,default:"transparent"},refresherDefaultText:{type:String,default:()=>j("下拉刷新")},refresherPullingText:{type:String,default:()=>j("释放立即刷新")},refresherRefreshingText:{type:String,default:()=>j("加载中")},showBackTop:{type:Boolean,default:!0}},emits:["item-tap","refresher-pulling","refresher-refresh","refresher-restore","refresher-abort","scrolltoupper","scrolltolower","scroll","scrollend","pull","top","bottom"],setup(e,t){var h=t.expose,f=t.emit;const _=e,N=f,j=l().proxy,$=a((()=>v(_.pt))),z=r(0),P=a((()=>x(_.data))),W=a((()=>_.data.every((e=>null!=e.index))&&!P.value)),X=a((()=>{const e=[];return _.data.forEach((t=>{var l;const a=e.findIndex((e=>e.index==t.index));-1!=a?e[a].children.push(t):e.push({index:null!==(l=t.index)&&void 0!==l?l:"",children:[t]})})),e})),Y=a((()=>X.value.map((e=>e.index)))),F=a((()=>{const e=[];let t=_.topHeight,l=0;return X.value.forEach(((a,r)=>{""!=a.index&&(e.push({key:"header-".concat(r),type:"header",index:l++,top:t,height:_.headerHeight,data:{label:a.index,index:a.index}}),t+=_.headerHeight),a.children.forEach(((a,s)=>{e.push({key:"item-".concat(r,"-").concat(s),type:"item",index:l++,top:t,height:_.itemHeight,data:a}),t+=_.itemHeight}))})),e})),K=a((()=>F.value.reduce(((e,t)=>e+t.height),0)+_.topHeight+_.bottomHeight)),L=r(0),q=r(0),G=r(0),Q=a((()=>{if(x(F.value))return[];if(!_.virtual)return F.value;const e=_.bufferSize*_.itemHeight,t=L.value-e,l=L.value+G.value+e,a=[];let r=0,s=F.value.length-1;for(;r<s;){const e=Math.floor((r+s)/2),l=F.value[e];l.top+l.height<=t?r=e+1:s=e}for(let n=r;n<F.value.length;n++){const e=F.value[n];if(e.top>=l)break;e.top+e.height>t&&a.push(e)}return a})),Z=a((()=>x(Q.value)?0:Q.value[0].top)),ee=a((()=>{if(x(Q.value))return 0;const e=Q.value[Q.value.length-1];return K.value-(e.top+e.height)})),te=a((()=>new UTSJSONObject({height:_.virtual?"".concat(K.value,"px"):"auto"}))),le=a((()=>new UTSJSONObject({height:_.virtual?"".concat(Z.value,"px"):"auto"}))),ae=a((()=>new UTSJSONObject({height:_.virtual?"".concat(ee.value,"px"):"auto"}))),re=r([]);const se=r(!1),ne=r("default"),ie=a((()=>{switch(ne.value){case"pulling":return _.refresherPullingText;case"refreshing":return _.refresherRefreshingText;default:return _.refresherDefaultText}}));function ue(e){N("scrolltoupper",e),N("top")}function oe(e){N("scrolltolower",e),N("bottom")}let ce=!1;function de(e){if(L.value=Math.floor(e.detail.scrollTop),ce)return null;re.value.forEach(((e,t)=>{L.value>=e&&(z.value=t)})),N("scroll",e)}function he(e){N("scrollend",e)}function fe(e){ce=!0,q.value=re.value[e],setTimeout((()=>{ce=!1}),300)}function pe(e){e.detail.dy>_.refresherThreshold&&(ne.value="pulling"),N("refresher-pulling",e)}function ve(e){ne.value="refreshing",se.value=!0,N("refresher-refresh",e),N("pull",e)}function Se(e){ne.value="default",N("refresher-restore",e)}function _e(e){ne.value="default",N("refresher-abort",e)}function be(){q.value=.01,y((()=>{q.value=0}))}return n((()=>{setTimeout((()=>{U().in(j).select(".cl-list-view__scroller").boundingClientRect().exec((e=>{var t;if(x(e))return null;G.value=null!==(t=e[0].height)&&void 0!==t?t:0}))}),100),s(a((()=>_.data)),(()=>{!function(){const e=[];let t=0;X.value.forEach((l=>{e.push(t),t+=_.headerHeight+l.children.length*_.itemHeight})),re.value=e}()}),{immediate:!0})})),h(new UTSJSONObject({data:X,stopRefresh:function(){se.value=!1,ne.value="default"}})),(t=null,l=null)=>{const a=E(J("cl-loading"),A),r=E(J("cl-text"),C),s=S,n=E(J("cl-empty"),M),h=R,f=E(J("cl-index-bar"),D),v=E(J("cl-back-top"),I);return i(),O(s,new UTSJSONObject({class:d(["cl-list-view",[new UTSJSONObject({}),$.value.className]])}),{default:c((()=>{var S,_;return[o(h,{class:d(["cl-list-view__scroller",[new UTSJSONObject({}),null===(S=$.value.scroller)||void 0===S?null:S.className]]),"scroll-top":q.value,"scroll-into-view":e.scrollIntoView,"scroll-with-animation":e.scrollWithAnimation,"show-scrollbar":e.showScrollbar,"refresher-triggered":se.value,"refresher-enabled":e.refresherEnabled,"refresher-threshold":e.refresherThreshold,"refresher-background":e.refresherBackground,"refresher-default-style":"none",direction:"vertical",onScrolltoupper:ue,onScrolltolower:oe,onScroll:de,onScrollend:he,onRefresherpulling:pe,onRefresherrefresh:ve,onRefresherrestore:Se,onRefresherabort:_e},{refresher:c((()=>{var l;return[o(s,{slot:"refresher",class:d(["cl-list-view__refresher",[new UTSJSONObject({}),new UTSJSONObject({"is-pulling":"pulling"===ne.value,"is-refreshing":"refreshing"===ne.value}),null===(l=$.value.refresher)||void 0===l?null:l.className]]),style:k({height:e.refresherThreshold+"px"})},{default:c((()=>[H(t.$slots,"refresher",new UTSJSONObject({status:ne.value,text:ie.value}),(()=>["refreshing"===ne.value?(i(),O(a,new UTSJSONObject({key:0,size:28,pt:new UTSJSONObject({className:"mr-2"})}))):B("",!0),o(r,null,{default:c((()=>[g(T(ie.value),1)])),_:1})]),!0)])),_:3},8,["class","style"])]})),default:c((()=>{var l;return[o(s,{class:d(["cl-list-view__virtual-list",[new UTSJSONObject({}),null===(l=$.value.list)||void 0===l?null:l.className]]),style:k(te.value)},{default:c((()=>[o(s,new UTSJSONObject({class:"cl-list-view__spacer-top",style:k(le.value)}),{default:c((()=>[H(t.$slots,"top",new UTSJSONObject({}),void 0,!0)])),_:3},8,["style"]),(i(!0),u(p,null,b(Q.value,((l,a)=>(i(),O(s,new UTSJSONObject({key:l.key,class:"cl-list-view__virtual-item"}),{default:c((()=>{var n,u;return["header"==l.type?(i(),O(s,new UTSJSONObject({key:0,class:d(["cl-list-view__header",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":m(w)})]]),style:k({height:e.headerHeight+"px"})}),new UTSJSONObject({default:c((()=>[H(t.$slots,"header",new UTSJSONObject({index:l.data.index}),(()=>[o(r,null,{default:c((()=>[g(T(l.data.label),1)])),_:2},1024)]),!0)])),_:2}),1032,["class","style"])):(i(),O(s,{key:1,class:d(["cl-list-view__item",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":m(w)}),null===(n=$.value.item)||void 0===n?null:n.className]]),"hover-class":null===(u=$.value.itemHover)||void 0===u?null:u.className,style:k({height:e.virtual?e.itemHeight+"px":"auto"}),onClick:(e=null)=>function(e){N("item-tap",e.data)}(l)},new UTSJSONObject({default:c((()=>[H(t.$slots,"item",new UTSJSONObject({item:l,data:l.data,value:l.data.value,index:a}),(()=>[o(s,new UTSJSONObject({class:"cl-list-view__item-inner"}),{default:c((()=>[o(r,null,{default:c((()=>[g(T(l.data.label),1)])),_:2},1024)])),_:2},1024)]),!0)])),_:2}),1032,["class","hover-class","style","onClick"]))]})),_:2},1024)))),128)),o(s,new UTSJSONObject({class:"cl-list-view__spacer-bottom",style:k(ae.value)}),{default:c((()=>[H(t.$slots,"bottom",new UTSJSONObject({}),void 0,!0)])),_:3},8,["style"])])),_:3},8,["class","style"]),P.value?(i(),O(n,new UTSJSONObject({key:0,fixed:!1}))):B("",!0)]})),_:3},8,["class","scroll-top","scroll-into-view","scroll-with-animation","show-scrollbar","refresher-triggered","refresher-enabled","refresher-threshold","refresher-background"]),W.value?(i(),O(f,{key:0,modelValue:z.value,"onUpdate:modelValue":l[0]||(l[0]=(e=null)=>z.value=e),list:Y.value,pt:{className:m(V)([null===(_=$.value.indexBar)||void 0===_?null:_.className])},onChange:fe},null,8,["modelValue","list","pt"])):B("",!0),W.value?(i(),O(s,new UTSJSONObject({key:1,class:d(["cl-list-view__index",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":m(w)})]]),style:k({height:e.headerHeight+"px"})}),new UTSJSONObject({default:c((()=>[H(t.$slots,"index",new UTSJSONObject({index:Y.value[z.value]}),(()=>[o(r,null,{default:c((()=>[g(T(Y.value[z.value]),1)])),_:1})]),!0)])),_:3}),8,["class","style"])):B("",!0),e.showBackTop?(i(),O(v,new UTSJSONObject({key:2,top:L.value,onBackTop:be}),null,8,["top"])):B("",!0)]})),_:3},8,["class"])}}})),[["__scopeId","data-v-7f26a413"]]);export{X as _,z as a,P as u};
