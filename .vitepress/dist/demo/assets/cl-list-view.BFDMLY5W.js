import{J as e,d as t,a8 as a,c as l,z as n,T as s,U as i,o as c,j as u,b as r,w as o,n as d,an as p,ao as _,F as S,W as h,_ as v,O,k as b,a as f,u as m,e as T,f as y,g as U,m as w,Z as x,a9 as g,a0 as N,t as j,X as J,a2 as k,q as H,aq as $,r as M,x as V,H as B,av as A}from"./index-oaRQvvbJ.js";import{c as C,r as E,a as I}from"./cl-page.uvue_vue_type_script_setup_true_lang.DgMmTlhG.js";function z(t){return t.map((t=>e(Object.assign(Object.assign({},t),{value:t}))))}function P(t){return t.map((t=>e(t)))}UTS.UTSType;const R=C(t(Object.assign({name:"cl-index-bar"},{__name:"cl-index-bar",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:Number,default:0},list:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(e,t){var j=t.emit;const J=e,k=j,H=a().proxy,$=l((()=>h(J.pt))),M=n({height:0,width:0,left:0,top:0}),V=n([]),B=n(!1),A=n(!1),C=n(""),E=n(-1);function I(){x((()=>{setTimeout((()=>{g().in(H).select(".cl-index-bar").boundingClientRect().exec((e=>{if(N(e))return null;M.value=e[0],g().in(H).selectAll(".cl-index-bar__item").boundingClientRect().exec((e=>{if(N(e))return I(),null;V.value=e[0]}))}))}),350)}))}function z(e){var t,a;if(0==V.value.length)return 0;let l=0,n=Number.MAX_VALUE;for(let s=0;s<V.value.length;s++){const i=V.value[s],c=(null!==(t=i.top)&&void 0!==t?t:0)+(null!==(a=i.height)&&void 0!==a?a:0)/2,u=Math.abs(e-c);u<n&&(n=u,l=s)}return l<0?l=0:l>=J.list.length&&(l=J.list.length-1),l}function P(e){E.value=e,C.value=J.list[e]}function R(e){B.value=!0,A.value=!0;P(z(e.touches[0].clientY))}function q(e){if(!B.value)return null;P(z(e.touches[0].clientY))}function F(){B.value=!1,J.modelValue!=E.value&&(k("update:modelValue",E.value),k("change",E.value)),setTimeout((()=>{A.value=!1}),500)}return s(l((()=>J.modelValue)),(e=>{E.value=e}),{immediate:!0}),i((()=>{s(l((()=>J.list)),(()=>{I()}),{immediate:!0})})),(t=null,a=null)=>{const l=w,n=v;return c(),u(S,null,[r(n,new UTSJSONObject({class:d(["cl-index-bar",[new UTSJSONObject({}),$.value.className]])}),{default:o((()=>[r(n,new UTSJSONObject({class:"cl-index-bar__list",onTouchstart:R,onTouchmove:O(q,["stop","prevent"]),onTouchend:F}),{default:o((()=>[(c(!0),u(S,null,b(e.list,((e,t)=>(c(),f(n,new UTSJSONObject({class:"cl-index-bar__item",key:t}),new UTSJSONObject({default:o((()=>[r(n,new UTSJSONObject({class:d(["cl-index-bar__item-inner",new UTSJSONObject({"is-active":E.value==t})])}),{default:o((()=>[r(l,new UTSJSONObject({class:d(["cl-index-bar__item-text",new UTSJSONObject({"dark-colon-text-surface-50":m(T),"is-active":E.value==t||m(T)})])}),{default:o((()=>[y(U(e),1)])),_:2},1032,["class"])])),_:2},1032,["class"])])),_:2}),1024)))),128))])),_:1})])),_:1},8,["class"]),p(r(n,new UTSJSONObject({class:"cl-index-bar__alert"}),{default:o((()=>[r(n,new UTSJSONObject({class:d(["cl-index-bar__alert-icon",new UTSJSONObject({"dark-colon--important-bg-surface-800":m(T)})])}),{default:o((()=>[r(n,new UTSJSONObject({class:d(["cl-index-bar__alert-arrow",new UTSJSONObject({"dark-colon--important-bg-surface-800":m(T)})])}),null,8,["class"]),r(l,new UTSJSONObject({class:d(["cl-index-bar__alert-text",new UTSJSONObject({"dark-colon-text-surface-50":m(T),"dark-colon--important-text-white":m(T)})])}),{default:o((()=>[y(U(C.value),1)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1},512),[[_,A.value]])],64)}}})),[["__scopeId","data-v-d5380a69"]]);UTS.UTSType;const q=C(t({__name:"cl-empty",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},text:{type:String,default:()=>j("暂无数据")},icon:{type:String,default:"comm"},iconSize:{type:[Number,String],default:120},showIcon:{type:Boolean,default:!0},fixed:{type:Boolean,default:!0}},setup(e){const t=e,a=l((()=>h(t.pt)));return(t=null,l=null)=>{const n=$,s=w,i=v;return c(),f(i,new UTSJSONObject({class:d(["cl-empty",[new UTSJSONObject({}),new UTSJSONObject({"cl-empty--fixed":e.fixed}),a.value.className]])}),new UTSJSONObject({default:o((()=>[e.showIcon?(c(),f(n,new UTSJSONObject({key:0,class:"cl-empty__icon",src:"/static/empty/".concat(e.icon,".png"),style:J({height:m(k)(e.iconSize)}),mode:"aspectFit"}),null,8,["src","style"])):H("",!0),e.text?(c(),f(s,new UTSJSONObject({key:1,class:d(["cl-empty__text",new UTSJSONObject({"dark-colon-text-surface-50":m(T),"dark-colon--important-text-surface-100":m(T)})])}),new UTSJSONObject({default:o((()=>[y(U(e.text),1)])),_:1}),8,["class"])):H("",!0)])),_:1}),8,["class"])}}}),[["__scopeId","data-v-3d7c4d9f"]]);class F extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{key:{type:String,optional:!1},type:{type:"Unknown",optional:!1},index:{type:Number,optional:!1},top:{type:Number,optional:!1},height:{type:Number,optional:!1},data:{type:"Unknown",optional:!1}}}}}constructor(e,t=F.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.key=this.__props__.key,this.type=this.__props__.type,this.index=this.__props__.index,this.top=this.__props__.top,this.height=this.__props__.height,this.data=this.__props__.data,delete this.__props__}}class X extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{index:{type:String,optional:!1},children:{type:UTS.UTSType.withGenerics(Array,["Unknown"]),optional:!1}}}}}constructor(e,t=X.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.index=this.__props__.index,this.children=this.__props__.children,delete this.__props__}}class Y extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},item:{type:"Unknown",optional:!0},indexBar:{type:"Unknown",optional:!0}}}}}constructor(e,t=Y.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.className=this.__props__.className,this.item=this.__props__.item,this.indexBar=this.__props__.indexBar,delete this.__props__}}const G=C(t(Object.assign({name:"cl-list-view"},{__name:"cl-list-view",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},data:{type:Array,default:()=>[]},itemHeight:{type:Number,default:50},headerHeight:{type:Number,default:32},topHeight:{type:Number,default:0},bottomHeight:{type:Number,default:0},bufferSize:{type:Number,default:15},virtual:{type:Boolean,default:!0}},emits:["item-tap"],setup(e,t){var p=t.expose,_=t.emit;const O=e,w=_,x=a().proxy,j=l((()=>h(O.pt))),k=n(0),$=l((()=>N(O.data))),C=l((()=>O.data.every((e=>null!=e.index))&&!$.value)),z=l((()=>{const e=[];return O.data.forEach((t=>{var a;const l=e.findIndex((e=>e.index==t.index));-1!=l?e[l].children.push(t):e.push(new X({index:null!==(a=t.index)&&void 0!==a?a:"",children:[t]}))})),e})),P=l((()=>z.value.map((e=>e.index)))),Y=l((()=>{const e=[];let t=O.topHeight,a=0;return z.value.forEach(((l,n)=>{""!=l.index&&(e.push(new F({key:"header-".concat(n),type:"header",index:a++,top:t,height:O.headerHeight,data:{label:l.index,index:l.index}})),t+=O.headerHeight),l.children.forEach(((l,s)=>{e.push(new F({key:"item-".concat(n,"-").concat(s),type:"item",index:a++,top:t,height:O.itemHeight,data:l})),t+=O.itemHeight}))})),e})),G=l((()=>Y.value.reduce(((e,t)=>e+t.height),0)+O.topHeight+O.bottomHeight)),L=n(0),W=n(0),Z=n(0),D=l((()=>{if(N(Y.value))return[];if(!O.virtual)return Y.value;const e=O.bufferSize*O.itemHeight,t=L.value-e,a=L.value+Z.value+e,l=[];let n=0,s=Y.value.length-1;for(;n<s;){const e=Math.floor((n+s)/2),a=Y.value[e];a.top+a.height<=t?n=e+1:s=e}for(let i=n;i<Y.value.length;i++){const e=Y.value[i];if(e.top>=a)break;e.top+e.height>t&&l.push(e)}return l})),K=l((()=>N(D.value)?0:O.virtual?D.value[0].top:0)),Q=l((()=>{if(N(D.value))return 0;if(!O.virtual)return 0;const e=D.value[D.value.length-1];return G.value-(e.top+e.height)})),ee=n([]);let te=!1;function ae(e){if(L.value=Math.floor(e.detail.scrollTop),te)return null;ee.value.forEach(((e,t)=>{L.value>=e&&(k.value=t)}))}function le(e){te=!0,W.value=ee.value[e],setTimeout((()=>{te=!1}),300)}return i((()=>{setTimeout((()=>{g().in(x).select(".cl-list-view__scroller").boundingClientRect().exec((e=>{var t;if(N(e))return null;Z.value=null!==(t=e[0].height)&&void 0!==t?t:0}))}),100),s(l((()=>O.data)),(()=>{!function(){const e=[];let t=0;z.value.forEach((a=>{e.push(t),t+=O.headerHeight+a.children.length*O.itemHeight})),ee.value=e}()}),{immediate:!0})})),p(new UTSJSONObject({data:z})),(t=null,a=null)=>{const l=E(M("cl-index-bar"),R),n=v,s=E(M("cl-text"),I),i=E(M("cl-empty"),q),p=A;return c(),f(n,new UTSJSONObject({class:"cl-list-view"}),{default:o((()=>{var _;return[C.value?(c(),f(l,{key:0,modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=(e=null)=>k.value=e),list:P.value,pt:{className:m(V)([null===(_=j.value.indexBar)||void 0===_?null:_.className])},onChange:le},null,8,["modelValue","list","pt"])):H("",!0),r(p,new UTSJSONObject({class:"cl-list-view__scroller","scroll-top":W.value,"show-scrollbar":!1,direction:"vertical",onScroll:ae}),{default:o((()=>[r(n,new UTSJSONObject({class:"cl-list-view__virtual-list",style:J({height:e.virtual?G.value+"px":"auto"})}),{default:o((()=>[r(n,new UTSJSONObject({class:"cl-list-view__spacer-top",style:J({height:K.value+"px"})}),{default:o((()=>[B(t.$slots,"top",new UTSJSONObject({}),void 0,!0)])),_:3},8,["style"]),(c(!0),u(S,null,b(D.value,(a=>(c(),f(n,new UTSJSONObject({key:a.key,class:"cl-list-view__virtual-item"}),{default:o((()=>{var l;return["header"==a.type?(c(),f(n,new UTSJSONObject({key:0,class:d(["cl-list-view__header",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":m(T)})]]),style:J({height:e.headerHeight+"px"})}),new UTSJSONObject({default:o((()=>[B(t.$slots,"header",new UTSJSONObject({index:a.data.index}),(()=>[r(s,null,{default:o((()=>[y(U(a.data.label),1)])),_:2},1024)]),!0)])),_:2}),1032,["class","style"])):(c(),f(n,{key:1,class:d(["cl-list-view__item",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":m(T)}),null===(l=j.value.item)||void 0===l?null:l.className]]),style:J({height:e.virtual?e.itemHeight+"px":"auto"}),onClick:(e=null)=>function(e){w("item-tap",e.data)}(a)},new UTSJSONObject({default:o((()=>[B(t.$slots,"item",new UTSJSONObject({item:a,data:a.data,value:a.data.value}),(()=>[r(n,new UTSJSONObject({class:"cl-list-view__item-inner"}),{default:o((()=>[r(s,null,{default:o((()=>[y(U(a.data.label),1)])),_:2},1024)])),_:2},1024)]),!0)])),_:2}),1032,["class","style","onClick"]))]})),_:2},1024)))),128)),r(n,new UTSJSONObject({class:"cl-list-view__spacer-bottom",style:J({height:Q.value+"px"})}),{default:o((()=>[B(t.$slots,"bottom",new UTSJSONObject({}),void 0,!0)])),_:3},8,["style"])])),_:3},8,["style"]),$.value?(c(),f(i,new UTSJSONObject({key:0,fixed:!1}))):H("",!0)])),_:3},8,["scroll-top"]),C.value?(c(),f(n,new UTSJSONObject({key:1,class:d(["cl-list-view__index",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":m(T)})]]),style:J({height:e.headerHeight+"px"})}),new UTSJSONObject({default:o((()=>[B(t.$slots,"index",new UTSJSONObject({index:P.value[k.value]}),(()=>[r(s,null,{default:o((()=>[y(U(P.value[k.value]),1)])),_:1})]),!0)])),_:3}),8,["class","style"])):H("",!0)]})),_:3})}}})),[["__scopeId","data-v-e6fbd8ae"]]);export{G as _,z as a,P as u};
