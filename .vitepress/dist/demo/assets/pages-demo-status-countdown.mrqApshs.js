import{r as e,a as t,c as a,u as l,b as n}from"./cl-page.uvue_vue_type_script_setup_true_lang.DZnZPYiq.js";import{d as s,c as o,z as u,T as i,ay as r,az as p,r as c,o as d,a as _,w as S,n as m,U as b,V as O,_ as f,j as T,k as h,H as U,b as N,f as w,g as y,F as j,an as v,a3 as J,a8 as g,u as x,t as $,x as M,e as k}from"./index-C3cX6pOv.js";import{d as D}from"./day.C6z4Qky5.js";import{D as z}from"./item.B0iCyPsh.js";import"./item.uvue_vue_type_style_index_0_scoped_f51a3be8_lang.DQpFvJzq.js";class P extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{value:{type:String,optional:!1},isSplitor:{type:Boolean,optional:!1}}}}}constructor(e,t=P.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.value=this.__props__.value,this.isSplitor=this.__props__.isSplitor,delete this.__props__}}class B extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},text:{type:"Unknown",optional:!0},splitor:{type:"Unknown",optional:!0}}}}}constructor(e,t=B.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.className=this.__props__.className,this.text=this.__props__.text,this.splitor=this.__props__.splitor,delete this.__props__}}class Z extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{day:{type:Number,optional:!0},hour:{type:Number,optional:!0},minute:{type:Number,optional:!0},second:{type:Number,optional:!0},datetime:{type:"Unknown",optional:!0}}}}}constructor(e,t=Z.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.day=this.__props__.day,this.hour=this.__props__.hour,this.minute=this.__props__.minute,this.second=this.__props__.second,this.datetime=this.__props__.datetime,delete this.__props__}}const F=a(s(Object.assign({name:"cl-countdown"},{__name:"cl-countdown",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},format:{type:String,default:"{h}:{m}:{s}"},hideZero:{type:Boolean,default:!1},day:{type:Number,default:0},hour:{type:Number,default:0},minute:{type:Number,default:0},second:{type:Number,default:0},datetime:{type:[Date,String],default:null}},emits:["stop","done","change"],setup(a,l){var n=l.expose,s=l.emit;const x=a,$=s,M=o((()=>b(x.pt)));let k=0;const z=u(0),B=u(!1),Z=u([]);function F(){clearTimeout(k),k=0,B.value=!1}function H(){F(),$("stop")}function I(){F(),$("done")}function R(){if(z.value<=0||B.value)return null;B.value=!0,function e(){if(function(){const e=Math.floor(z.value),t=Math.floor(e/86400),a=Math.floor(e%86400/3600),l=Math.floor(e%3600/60),n=e%60,s=new UTSJSONObject({d:t.toString(),h:a.toString().padStart(2,"0"),m:l.toString().padStart(2,"0"),s:n.toString().padStart(2,"0")});let o=!0,u=-1;Z.value=x.format.split(/[{,}]/).map(((e,t)=>{const a=v(s,e)?J(s,e):e,l=/^\D+$/.test(a);return x.hideZero&&o&&!l&&("00"==a||"0"==a||g(a)?(u=t,o=!0):o=!1),new P({value:a,isSplitor:l})})).filter(((e,t)=>!g(e.value)&&(-1==u||u<t))).filter(((e,t)=>0!=t||!e.isSplitor)),$("change",Z.value)}(),z.value<=0)return I(),null;z.value--,k=setTimeout((()=>e()),1e3)}()}function V(e=null){O((()=>{var t,a,l,n,s;z.value=function(e){var t=e.day,a=e.hour,l=e.minute,n=e.second,s=e.datetime;if(null!=s){const e=D(s).diff(D());return Math.max(0,Math.floor(e/1e3))}return Math.max(0,86400*(null!=t?t:0)+3600*(null!=a?a:0)+60*(null!=l?l:0)+(null!=n?n:0))}({day:null!==(t=null==e?null:e.day)&&void 0!==t?t:x.day,hour:null!==(a=null==e?null:e.hour)&&void 0!==a?a:x.hour,minute:null!==(l=null==e?null:e.minute)&&void 0!==l?l:x.minute,second:null!==(n=null==e?null:e.second)&&void 0!==n?n:x.second,datetime:null!==(s=null==e?null:e.datetime)&&void 0!==s?s:x.datetime}),R()}))}return i(o((()=>[x.day,x.hour,x.minute,x.second])),(()=>{V()})),i(o((()=>x.datetime)),(()=>{V()})),r((()=>H())),p((()=>V())),n(new UTSJSONObject({start:V,stop:H,done:I,isRunning:B})),(a=null,l=null)=>{const n=e(c("cl-text"),t),s=f;return d(),_(s,new UTSJSONObject({class:m(["cl-countdown",[new UTSJSONObject({}),M.value.className]])}),{default:S((()=>[(d(!0),T(j,null,h(Z.value,((e,t)=>{var l,o;return d(),_(s,{class:m(["cl-countdown__item",[new UTSJSONObject({}),"".concat(e.isSplitor?null===(l=M.value.splitor)||void 0===l?null:l.className:null===(o=M.value.text)||void 0===o?null:o.className)]]),key:t},new UTSJSONObject({default:S((()=>[U(a.$slots,"item",new UTSJSONObject({item:e}),(()=>[N(n,null,{default:S((()=>[w(y(e.value),1)])),_:2},1024)]),!0)])),_:2}),1032,["class"])})),128))])),_:3},8,["class"])}}})),[["__scopeId","data-v-c949e90d"]]),H=s({__name:"countdown",setup(t){const a=l(),s=u(D().add(1,"minute").toDate());function o(){a.showToast({message:"倒计时完成"})}return(t=null,a=null)=>{const l=e(c("cl-countdown"),F),u=f,i=e(c("cl-page"),n);return d(),_(i,null,new UTSJSONObject({default:S((()=>[N(u,new UTSJSONObject({class:"p-3"}),{default:S((()=>[N(x(z),new UTSJSONObject({label:x($)("基础用法")}),{default:S((()=>[N(l,new UTSJSONObject({datetime:s.value}),null,8,["datetime"])])),_:1},8,["label"]),N(x(z),new UTSJSONObject({label:x($)("隐藏为 00 的值")}),{default:S((()=>[N(l,new UTSJSONObject({minute:60,"hide-zero":""}))])),_:1},8,["label"]),N(x(z),new UTSJSONObject({label:x($)("指定天数")}),{default:S((()=>[N(l,new UTSJSONObject({day:2,format:"{d}天{h}:{m}:{s}"}))])),_:1},8,["label"]),N(x(z),new UTSJSONObject({label:x($)("自定义模板")}),{default:S((()=>[N(l,new UTSJSONObject({day:1,format:"{d}天{h}时{m}分{s}秒"}))])),_:1},8,["label"]),N(x(z),new UTSJSONObject({label:x($)("指定小时")}),{default:S((()=>[N(l,new UTSJSONObject({hour:2}))])),_:1},8,["label"]),N(x(z),new UTSJSONObject({label:x($)("指定分钟")}),{default:S((()=>[N(l,new UTSJSONObject({minute:2}))])),_:1},8,["label"]),N(x(z),new UTSJSONObject({label:x($)("指定秒")}),{default:S((()=>[N(l,new UTSJSONObject({second:10}))])),_:1},8,["label"]),N(x(z),new UTSJSONObject({label:x($)("完成后提示")}),{default:S((()=>[N(l,new UTSJSONObject({second:5,onDone:o}))])),_:1},8,["label"]),N(x(z),new UTSJSONObject({label:x($)("自定义样式")}),{default:S((()=>[N(l,new UTSJSONObject({hour:10,pt:new UTSJSONObject({text:new UTSJSONObject({className:x(M)(["px-2 py-1 rounded-md",[x(k),"bg-surface-700","bg-surface-100"]])}),splitor:new UTSJSONObject({className:"px-2"})})}),null,8,["pt"])])),_:1},8,["label"])])),_:1})])),_:1}))}}});export{H as default};
