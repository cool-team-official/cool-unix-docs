import{_ as e}from"./cl-topbar.Be5vfgaj.js";import{d as t,r as a,H as l,h as n,$ as s,t as o,a as c,o as r,l as i,I as u,e as p,w as d,f as S,g as m,c as O,u as b,i as f,p as _,v as w,F as T,G as U,J as h,_ as N,K as g,L as j,z as x,M as v,s as J,N as k,k as y,O as C,q as V}from"./index-CVBPP8er.js";import{r as $,d as z,e as I,f as M,u as P,_ as B,a as A,b as F,c as W}from"./cl-page.uvue_vue_type_script_setup_true_lang.SFzc29x8.js";import{_ as q}from"./cl-image.D8jjFIVc.js";import{_ as D}from"./cl-checkbox.D41ikjEo.js";import{u as E}from"./refs.DXb5AnbP.js";import{_ as G}from"./cl-input.-yIJCfxu.js";import{_ as H}from"./cl-svg.uvue_vue_type_script_setup_true_lang.Bn5X8t1f.js";import{_ as K}from"./cl-avatar.uvue_vue_type_script_setup_true_lang.C_9JGV9l.js";import{u as L}from"./index.D8Xow_9t.js";import"./form.CyvXoDOu.js";class R extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{visible:{type:Boolean,optional:!1},loading:{type:Boolean,optional:!1},sending:{type:Boolean,optional:!1},img:{type:String,optional:!1}}}}}constructor(e,t=R.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.visible=this.__props__.visible,this.loading=this.__props__.loading,this.sending=this.__props__.sending,this.img=this.__props__.img,delete this.__props__}}const Q=t({__name:"sms-btn",props:{phone:String},emits:["success"],setup(e,t){var j=t.expose,x=t.emit;const v=e,J=x,k=a(null),y=P(),C=l(new R({visible:!1,loading:!1,sending:!1,img:""})),V=a(0),B=n((()=>V.value>0||""==v.phone)),A=n((()=>V.value>0?s("{n}s后重新获取",new UTSJSONObject({n:V.value})):o("获取验证码"))),F=a(""),W=a("");function q(){F.value="",W.value=""}function D(){V.value=60;let e=0;function t(){V.value--,V.value<1&&clearInterval(e)}e=setInterval((()=>{t()}),1e3),t()}function E(){return U(this,void 0,void 0,(function*(){q(),C.loading=!0;class e extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{captchaId:{type:String,optional:!1},data:{type:String,optional:!1}}}}}constructor(t,a=e.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(t,a,l),this.captchaId=this.__props__.captchaId,this.data=this.__props__.data,delete this.__props__}}yield h.user.login.captcha(new UTSJSONObject({color:_.value?"#ffffff":"#2c3142",phone:v.phone})).then(((e=null)=>{const t=g(e);W.value=t.captchaId,C.img=t.data})).catch(((e=null)=>{y.showToast({message:e.message})})),setTimeout((()=>{C.loading=!1}),200)}))}function K(){return U(this,void 0,void 0,(function*(){""!=F.value?(C.sending=!0,yield h.user.login.smsCode(new UTSJSONObject({phone:v.phone,code:F.value,captchaId:W.value})).then((()=>{y.showToast({message:o("短信已发送，请查收")}),D(),C.visible=!1,C.img="",q(),J("success")})).catch(((e=null)=>{y.showToast({message:e.message}),E()})),C.sending=!1):y.showToast({message:o("请填写验证码")})}))}function L(){""!=v.phone&&(/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(v.phone)?(C.visible=!0,E()):y.showToast({message:o("请填写正确的手机号格式")}))}return j(new UTSJSONObject({open:L,send:K,getCaptcha:E,startCountdown:D})),(e=null,t=null)=>{const a=$(c("cl-button"),z),l=$(c("cl-input"),G),n=$(c("cl-loading"),I),s=$(c("cl-svg"),H),U=N,h=$(c("cl-popup"),M);return r(),i(T,null,[u(e.$slots,"default",new UTSJSONObject({disabled:B.value,countdown:V.value,btnText:A.value}),(()=>[p(a,new UTSJSONObject({text:"",disabled:B.value,onClick:L}),{default:d((()=>[S(m(A.value),1)])),_:1},8,["disabled"])])),p(h,new UTSJSONObject({modelValue:C.visible,"onUpdate:modelValue":t[1]||(t[1]=(e=null)=>C.visible=e),ref_key:"popupRef",ref:k,direction:"center",title:b(o)("获取短信验证码"),size:500}),{default:d((()=>[C.visible?(r(),O(U,new UTSJSONObject({key:0,class:"p-3 pt-2 pb-4 w-full"}),new UTSJSONObject({default:d((()=>[p(U,new UTSJSONObject({class:"flex flex-row items-center"}),{default:d((()=>[p(l,new UTSJSONObject({modelValue:F.value,"onUpdate:modelValue":t[0]||(t[0]=(e=null)=>F.value=e),placeholder:b(o)("验证码"),maxlength:4,autofocus:"",clearable:!1,pt:new UTSJSONObject({className:"flex-1 mr-2 -important-h--bracket-start-70rpx-bracket-end-"}),onConfirm:K}),null,8,["modelValue","placeholder"]),p(U,new UTSJSONObject({class:f(["bg-surface-100 rounded-lg h--bracket-start-70rpx-bracket-end- w--bracket-start-200rpx-bracket-end- flex flex-row justify-center items-center",new UTSJSONObject({"dark-colon--important-bg-surface-800":b(_)})]),onClick:E}),{default:d((()=>[C.loading?(r(),O(n,new UTSJSONObject({key:0,size:28}))):(r(),O(s,new UTSJSONObject({key:1,class:"h-full w-full pointer-events-none",src:C.img}),null,8,["src"]))])),_:1},8,["class"])])),_:1}),p(a,new UTSJSONObject({type:"primary",disabled:""==F.value,loading:C.sending,pt:new UTSJSONObject({className:"-important-h--bracket-start-70rpx-bracket-end- mt-3"}),onClick:K}),{default:d((()=>[S(m(b(o)("发送短信")),1)])),_:1},8,["disabled","loading"])])),_:1}))):w("",!0)])),_:1},8,["modelValue","title"])],64)}}}),X=t({__name:"phone",props:{form:{type:Object,default:()=>new UTSJSONObject({})}},emits:["success"],setup(e,t){var l=t.emit;const s=e,u=l,O=P(),f=E(),w=j("isAgree"),g=a(!1),v=a(!1),J=n((()=>""==s.form.phone||""==s.form.smsCode));function k(){return U(this,void 0,void 0,(function*(){if(!w())return Promise.resolve(null);const e=s.form,t=e.phone,a=e.smsCode;v.value=!0,yield h.user.login.phone(new UTSJSONObject({phone:t,smsCode:a})).then(((e=null)=>{u("success",e)})).catch(((e=null)=>{O.showToast({message:e.message})})),v.value=!1}))}return(t=null,a=null)=>{const l=$(c("cl-text"),B),n=N,s=$(c("cl-input"),G),u=$(c("cl-button"),z);return r(),i(T,null,[p(n,new UTSJSONObject({class:"flex flex-col mb-5"}),{default:d((()=>[p(l,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-lg font-bold"})}),{default:d((()=>[S(m(b(o)("手机登录")),1)])),_:1}),p(l,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-sm mt-2"}),color:"info"}),{default:d((()=>[S(m(b(o)("未注册的手机号登录成功后将自动注册")),1)])),_:1})])),_:1}),p(n,new UTSJSONObject({class:"flex flex-col"}),{default:d((()=>[p(n,new UTSJSONObject({class:"mb-3 flex flex-row"}),{default:d((()=>[p(s,new UTSJSONObject({modelValue:e.form.phone,"onUpdate:modelValue":a[0]||(a[0]=(t=null)=>e.form.phone=t),"prefix-icon":"device-fill",placeholder:b(o)("请输入手机号"),border:!1,pt:new UTSJSONObject({className:b(x)(["-important-h--bracket-start-90rpx-bracket-end- flex-1 -important-rounded-xl -important-px-4",[b(_),"-important-bg-surface-70","-important-bg-white"]]),prefixIcon:new UTSJSONObject({className:"mr-1"})})}),null,8,["modelValue","placeholder","pt"])])),_:1}),p(n,new UTSJSONObject({class:"relative flex flex-row items-center mb-5"}),{default:d((()=>[p(s,new UTSJSONObject({modelValue:e.form.smsCode,"onUpdate:modelValue":a[1]||(a[1]=(t=null)=>e.form.smsCode=t),clearable:!1,type:"number","prefix-icon":"shield-check-fill",placeholder:b(o)("请输入验证码"),maxlength:4,border:!1,pt:new UTSJSONObject({className:b(x)(["-important-h--bracket-start-90rpx-bracket-end- flex-1 -important-rounded-xl -important-px-4",[b(_),"-important-bg-surface-70","-important-bg-white"]]),prefixIcon:new UTSJSONObject({className:"mr-1"})})}),null,8,["modelValue","placeholder","pt"]),p(n,new UTSJSONObject({class:"absolute right-0"}),{default:d((()=>[p(b(Q),new UTSJSONObject({ref:b(f).set("smsBtn"),phone:e.form.phone,onSuccess:a[2]||(a[2]=(e=null)=>g.value=!0)}),null,8,["phone"])])),_:1})])),_:1}),p(u,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-h--bracket-start-90rpx-bracket-end- -important-rounded-xl"}),loading:v.value,disabled:J.value,onClick:k}),{default:d((()=>[S(m(b(o)("登录")),1)])),_:1},8,["loading","disabled"])])),_:1})],64)}}});class Y extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{avatarUrl:{type:String,optional:!1},nickName:{type:String,optional:!1}}}}}constructor(e,t=Y.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.avatarUrl=this.__props__.avatarUrl,this.nickName=this.__props__.nickName,delete this.__props__}}const Z=t({__name:"wx",emits:["success"],setup(e,t){var n=t.expose;t.emit;const s=J().user,i=P(),u=a(!1),f=a(!1),_=l(new Y({avatarUrl:"",nickName:""}));function w(){u.value=!1}function T(){return U(this,void 0,void 0,(function*(){return""==_.avatarUrl?(i.showToast({message:o("请上传头像")}),Promise.resolve(null)):""==_.nickName?(i.showToast({message:o("请输入昵称")}),Promise.resolve(null)):(f.value=!0,yield L(_.avatarUrl).then((e=>{s.update({nickName:_.nickName,avatarUrl:e}),w()})).catch(((e=null)=>{i.showToast({message:e.message})})),void(f.value=!1))}))}function h(e){}function g(){u.value=!1}return n(new UTSJSONObject({login:function(){return U(this,void 0,void 0,(function*(){return i.showToast({message:o("开发中，敬请期待")}),Promise.resolve(null)}))},editOpen:function(){u.value=!0},editClose:w})),(e=null,t=null)=>{const a=$(c("cl-text"),B),l=$(c("cl-avatar"),K),n=v,s=N,i=$(c("cl-input"),G),U=$(c("cl-button"),z),j=$(c("cl-popup"),M);return r(),O(j,new UTSJSONObject({modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=(e=null)=>u.value=e),direction:"center",title:b(o)("提示"),size:"80%",onClose:g}),new UTSJSONObject({default:d((()=>[p(s,new UTSJSONObject({class:"p-4 pt-0"}),{default:d((()=>[p(a,new UTSJSONObject({color:"info",pt:new UTSJSONObject({className:"-important-text-sm"})}),{default:d((()=>[S(m(b(o)("为提供更好的服务，我们邀请您填写昵称、头像等公开信息")),1)])),_:1}),p(s,new UTSJSONObject({class:"flex flex-row justify-between items-center bg-surface-100 rounded-xl p-2 px-3 mt-3 h--bracket-start-95rpx-bracket-end-"}),{default:d((()=>[p(a,null,{default:d((()=>[S(m(b(o)("头像")),1)])),_:1}),p(s,new UTSJSONObject({class:"relative"}),{default:d((()=>[p(l,new UTSJSONObject({size:60,src:_.avatarUrl}),null,8,["src"]),p(n,new UTSJSONObject({class:"absolute top-0 right-0 h-10 w-10 z-10 opacity-0 p-0 m-0","open-type":"chooseAvatar",onChooseavatar:h}))])),_:1})])),_:1}),p(s,new UTSJSONObject({class:"flex flex-row justify-between items-center bg-surface-100 rounded-xl p-2 px-3 mt-3 h--bracket-start-95rpx-bracket-end-"}),{default:d((()=>[p(a,null,{default:d((()=>[S(m(b(o)("昵称")),1)])),_:1}),p(i,new UTSJSONObject({modelValue:_.nickName,"onUpdate:modelValue":t[0]||(t[0]=(e=null)=>_.nickName=e),type:"nickname",border:!1,placeholder:b(o)("点击输入昵称"),maxlength:16,pt:new UTSJSONObject({className:"-important-bg-transparent -important-px-0 flex-1",inner:new UTSJSONObject({className:"text-right"})})}),null,8,["modelValue","placeholder"])])),_:1}),p(s,new UTSJSONObject({class:"flex flex-row mt-4"}),{default:d((()=>[p(U,new UTSJSONObject({size:"large",text:"",border:"",type:"light",pt:new UTSJSONObject({className:"flex-1 -important-rounded-xl h--bracket-start-80rpx-bracket-end-"}),onClick:w}),{default:d((()=>[S(m(b(o)("取消")),1)])),_:1}),p(U,new UTSJSONObject({size:"large",pt:new UTSJSONObject({className:"flex-1 -important-rounded-xl h--bracket-start-80rpx-bracket-end-"}),loading:f.value,onClick:T}),{default:d((()=>[S(m(b(o)("确认")),1)])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1}),8,["modelValue","title"])}}}),ee=W(t({__name:"login",setup(t){const n=J().user,s=P(),i=E(),u=l({phone:"18000000000",smsCode:"6666"}),w=a(!1);function T(e=null){n.setToken(g(e)),V.home()}return k("isAgree",(function(){return!!w.value||(s.showToast({message:o("请先阅读并同意《用户协议》和《隐私政策》")}),!1)})),(t=null,a=null)=>{const l=$(c("cl-topbar"),e),n=$(c("cl-image"),q),s=N,U=$(c("cl-text"),B),h=$(c("cl-checkbox"),D),g=$(c("cl-icon"),A),j=$(c("cl-page"),F);return r(),O(j,null,new UTSJSONObject({default:d((()=>[p(l,new UTSJSONObject({"safe-area-top":"","background-color":"transparent"})),p(s,new UTSJSONObject({class:"px-10"}),{default:d((()=>[p(s,new UTSJSONObject({class:"flex flex-col items-center justify-center py-20"}),{default:d((()=>[p(s,new UTSJSONObject({class:"p-3 bg-primary-500 rounded-2xl"}),{default:d((()=>[p(n,new UTSJSONObject({src:"/static/logo.png",mode:"widthFix",width:80,height:80}))])),_:1}),p(U,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xl font-bold mt-3"})}),{default:d((()=>[S(m(b(y).name),1)])),_:1})])),_:1}),p(b(X),new UTSJSONObject({form:u,onSuccess:T}),null,8,["form"]),p(b(Z),new UTSJSONObject({ref:b(i).set("loginWx"),onSuccess:T}),null,512),p(s,new UTSJSONObject({class:"mt-6 flex flex-row flex-wrap items-center justify-center"}),{default:d((()=>[p(h,new UTSJSONObject({modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=(e=null)=>w.value=e),pt:new UTSJSONObject({icon:new UTSJSONObject({size:28})}),"active-icon":"checkbox-circle-fill","inactive-icon":"checkbox-blank-circle-line"}),null,8,["modelValue"]),p(U,new UTSJSONObject({color:"info",pt:new UTSJSONObject({className:"-important-text-xs"})}),{default:d((()=>[S(m(b(o)("已阅读并同意")),1)])),_:1}),p(U,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xs"}),onClick:a[1]||(a[1]=C(((e=null)=>{b(o)("用户协议")}),["stop"]))}),{default:d((()=>[S(" 《"+m(b(o)("用户协议"))+"》 ",1)])),_:1}),p(U,new UTSJSONObject({color:"info",pt:new UTSJSONObject({className:"-important-text-xs"})}),{default:d((()=>[S("、")])),_:1}),p(U,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xs"}),onClick:a[2]||(a[2]=C(((e=null)=>{b(o)("隐私政策")}),["stop"]))}),{default:d((()=>[S(" 《"+m(b(o)("隐私政策"))+"》 ",1)])),_:1})])),_:1}),p(s,new UTSJSONObject({class:"flex flex-row justify-center mt-10 px-10"}),{default:d((()=>[p(s,new UTSJSONObject({class:f(["login-item",new UTSJSONObject({"is-dark":b(_)})]),onClick:a[3]||(a[3]=(e=null)=>b(i).callMethod("loginWx","login"))}),{default:d((()=>[p(g,new UTSJSONObject({name:"wechat-fill",size:38,color:"#00b223"}))])),_:1},8,["class"]),p(s,new UTSJSONObject({class:f(["login-item",new UTSJSONObject({"is-dark":b(_)})])}),{default:d((()=>[p(g,new UTSJSONObject({name:"apple-fill",size:38}))])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}))}}}),[["__scopeId","data-v-39ba0cd8"]]);export{ee as default};
