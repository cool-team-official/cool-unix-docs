import{_ as e}from"./cl-topbar.Ebe4Z2bj.js";import{r as t,H as a,I as n,J as s,k as l,K as o,L as c,t as r,d as i,M as u,h as p,$ as d,a as m,o as S,l as O,N as f,e as b,w as h,f as w,g,c as _,u as T,i as U,p as N,x as j,F as x,_ as v,O as J,P as k,A as y,q as C,Q as V,s as P,R as I,S as $}from"./index-CNagV5B9.js";import{o as M,r as z,d as A,e as L,f as W,u as B,_ as q,a as R,b as X,c as F}from"./cl-page.uvue_vue_type_script_setup_true_lang.Dujw6vu5.js";import{_ as E}from"./cl-image.ChbEKLdo.js";import{_ as G}from"./cl-checkbox.pABvMU60.js";import{u as H}from"./refs.Cnn9TCyf.js";import{_ as K}from"./cl-input.tsrNEnDP.js";import{_ as Q}from"./cl-svg.uvue_vue_type_script_setup_true_lang.BIKoSspO.js";import{_ as D}from"./cl-avatar.uvue_vue_type_script_setup_true_lang.Bb9WA0By.js";import{g as Y,u as Z}from"./index.nroVxdxG.js";import"./form.psaMSS8r.js";class ee{constructor(){this.code=t(""),this.mpConfig={appId:""}}getCode(){return a(this,void 0,void 0,(function*(){return new Promise((e=>{e("")}))}))}isWxBrowser(){return null!=window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}getMpConfig(){this.isWxBrowser()&&n({url:"/app/user/common/wxMpConfig",method:"POST",data:{url:"".concat(location.origin).concat(location.pathname)}}).then((e=>{null!=e&&(s.config({debug:l.wx.debug,jsApiList:e.jsApiList||["chooseWXPay"],appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,openTagList:e.openTagList}),o(this.mpConfig,e))}))}mpAuth(){const e=this.mpConfig.appId,t=encodeURIComponent("".concat(location.origin).concat(location.pathname,"#/pages/user/login")),a="https://open.weixin.qq.com/connect/oauth2/authorize?appid=".concat(e,"&redirect_uri=").concat(t,"&response_type=").concat("code","&scope=").concat("snsapi_userinfo","&state=").concat("STATE","#wechat_redirect");location.href=a}mpLogin(){return new Promise((e=>{const t=Y("code"),a=c.get("mpCode"),n=window.location.href.replace(/(\?[^#]*)#/,"#");window.history.replaceState({},"",n),t!=a?(c.set("mpCode",t,3e5),e(t)):e(null)}))}mpPay(e){return new Promise(((t,a)=>{if(!this.isWxBrowser())return a({message:r("请在微信浏览器中打开")});s.chooseWXPay(Object.assign(Object.assign({},e),{timestamp:e.timeStamp,success(){t()},complete(e){if("chooseWXPay:cancel"===e.errMsg)a({message:r("已取消支付")});else a({message:r("支付失败")})}}))}))}}class te extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{visible:{type:Boolean,optional:!1},loading:{type:Boolean,optional:!1},sending:{type:Boolean,optional:!1},img:{type:String,optional:!1}}}}}constructor(e,t=te.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.visible=this.__props__.visible,this.loading=this.__props__.loading,this.sending=this.__props__.sending,this.img=this.__props__.img,delete this.__props__}}const ae=i({__name:"sms-btn",props:{phone:String},emits:["success"],setup(e,s){var l=s.expose,o=s.emit;const c=e,i=o,k=t(null),y=B(),C=u(new te({visible:!1,loading:!1,sending:!1,img:""})),V=t(0),P=p((()=>V.value>0||""==c.phone)),I=p((()=>V.value>0?d("{n}s后重新获取",new UTSJSONObject({n:V.value})):r("获取验证码"))),$=t(""),M=t("");function q(){$.value="",M.value=""}function R(){V.value=60;let e=0;function t(){V.value--,V.value<1&&clearInterval(e)}e=setInterval((()=>{t()}),1e3),t()}function X(){return a(this,void 0,void 0,(function*(){q(),C.loading=!0;class e extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{captchaId:{type:String,optional:!1},data:{type:String,optional:!1}}}}}constructor(t,a=e.get$UTSMetadata$(),n=!1){super(),this.__props__=UTS.UTSType.initProps(t,a,n),this.captchaId=this.__props__.captchaId,this.data=this.__props__.data,delete this.__props__}}yield n({url:"/app/user/login/captcha",method:"POST",data:new UTSJSONObject({color:N.value?"#ffffff":"#2c3142",phone:c.phone,width:200,height:70})}).then(((e=null)=>{if(null!=e){const t=J(e);M.value=t.captchaId,C.img=t.data}})).catch(((e=null)=>{y.showToast({message:e.message})})),setTimeout((()=>{C.loading=!1}),200)}))}function F(){return a(this,void 0,void 0,(function*(){""!=$.value?(C.sending=!0,yield n({url:"/app/user/login/smsCode",method:"POST",data:new UTSJSONObject({phone:c.phone,code:$.value,captchaId:M.value})}).then((()=>{y.showToast({message:r("短信已发送，请查收")}),R(),C.visible=!1,C.img="",q(),i("success")})).catch(((e=null)=>{y.showToast({message:e.message}),X()})),C.sending=!1):y.showToast({message:r("请填写验证码")})}))}function E(){""!=c.phone&&(/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(c.phone)?(C.visible=!0,X()):y.showToast({message:r("请填写正确的手机号格式")}))}return l(new UTSJSONObject({open:E,send:F,getCaptcha:X,startCountdown:R})),(e=null,t=null)=>{const a=z(m("cl-button"),A),n=z(m("cl-input"),K),s=z(m("cl-loading"),L),l=z(m("cl-svg"),Q),o=v,c=z(m("cl-popup"),W);return S(),O(x,null,[f(e.$slots,"default",new UTSJSONObject({disabled:P.value,countdown:V.value,btnText:I.value}),(()=>[b(a,new UTSJSONObject({text:"",disabled:P.value,onClick:E}),{default:h((()=>[w(g(I.value),1)])),_:1},8,["disabled"])])),b(c,new UTSJSONObject({modelValue:C.visible,"onUpdate:modelValue":t[1]||(t[1]=(e=null)=>C.visible=e),ref_key:"popupRef",ref:k,direction:"center",title:T(r)("获取短信验证码"),size:500}),{default:h((()=>[C.visible?(S(),_(o,new UTSJSONObject({key:0,class:"p-3 pt-2 pb-4 w-full"}),new UTSJSONObject({default:h((()=>[b(o,new UTSJSONObject({class:"flex flex-row items-center"}),{default:h((()=>[b(n,new UTSJSONObject({modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=(e=null)=>$.value=e),placeholder:T(r)("验证码"),maxlength:4,autofocus:"",clearable:!1,pt:new UTSJSONObject({className:"flex-1 mr-2 -important-h--bracket-start-70rpx-bracket-end-"}),onConfirm:F}),null,8,["modelValue","placeholder"]),b(o,new UTSJSONObject({class:U(["bg-surface-100 rounded-lg h--bracket-start-70rpx-bracket-end- w--bracket-start-200rpx-bracket-end- flex flex-row justify-center items-center",new UTSJSONObject({"dark-colon--important-bg-surface-800":T(N)})]),onClick:X}),{default:h((()=>[C.loading?(S(),_(s,new UTSJSONObject({key:0,size:28}))):(S(),_(l,new UTSJSONObject({key:1,class:"h-full w-full pointer-events-none",color:"none",src:C.img}),null,8,["src"]))])),_:1},8,["class"])])),_:1}),b(a,new UTSJSONObject({type:"primary",disabled:""==$.value,loading:C.sending,pt:new UTSJSONObject({className:"-important-h--bracket-start-70rpx-bracket-end- mt-3"}),onClick:F}),{default:h((()=>[w(g(T(r)("发送短信")),1)])),_:1},8,["disabled","loading"])])),_:1}))):j("",!0)])),_:1},8,["modelValue","title"])],64)}}}),ne=i({__name:"phone",props:{form:{type:Object,default:()=>new UTSJSONObject({})}},emits:["success"],setup(e,s){var l=s.emit;const o=e,c=l,i=B(),u=H(),d=k("isAgree"),f=t(!1),_=t(!1),U=p((()=>""==o.form.phone||""==o.form.smsCode));function j(){return a(this,void 0,void 0,(function*(){if(!d())return Promise.resolve(null);const e=o.form,t=e.phone,a=e.smsCode;_.value=!0,yield n({url:"/app/user/login/phone",method:"POST",data:new UTSJSONObject({phone:t,smsCode:a})}).then(((e=null)=>{c("success",e)})).catch(((e=null)=>{i.showToast({message:e.message})})),_.value=!1}))}return(t=null,a=null)=>{const n=z(m("cl-text"),q),s=v,l=z(m("cl-input"),K),o=z(m("cl-button"),A);return S(),O(x,null,[b(s,new UTSJSONObject({class:"flex flex-col mb-5"}),{default:h((()=>[b(n,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-lg font-bold"})}),{default:h((()=>[w(g(T(r)("手机登录")),1)])),_:1}),b(n,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-sm mt-2"}),color:"info"}),{default:h((()=>[w(g(T(r)("未注册的手机号登录成功后将自动注册")),1)])),_:1})])),_:1}),b(s,new UTSJSONObject({class:"flex flex-col"}),{default:h((()=>[b(s,new UTSJSONObject({class:"mb-3 flex flex-row"}),{default:h((()=>[b(l,new UTSJSONObject({modelValue:e.form.phone,"onUpdate:modelValue":a[0]||(a[0]=(t=null)=>e.form.phone=t),"prefix-icon":"device-fill",placeholder:T(r)("请输入手机号"),border:!1,pt:new UTSJSONObject({className:T(y)(["-important-h--bracket-start-90rpx-bracket-end- flex-1 -important-rounded-xl -important-px-4",[T(N),"-important-bg-surface-70","-important-bg-white"]]),prefixIcon:new UTSJSONObject({className:"mr-1"})})}),null,8,["modelValue","placeholder","pt"])])),_:1}),b(s,new UTSJSONObject({class:"relative flex flex-row items-center mb-5"}),{default:h((()=>[b(l,new UTSJSONObject({modelValue:e.form.smsCode,"onUpdate:modelValue":a[1]||(a[1]=(t=null)=>e.form.smsCode=t),clearable:!1,type:"number","prefix-icon":"shield-check-fill",placeholder:T(r)("请输入验证码"),maxlength:4,border:!1,pt:new UTSJSONObject({className:T(y)(["-important-h--bracket-start-90rpx-bracket-end- flex-1 -important-rounded-xl -important-px-4",[T(N),"-important-bg-surface-70","-important-bg-white"]]),prefixIcon:new UTSJSONObject({className:"mr-1"})})}),null,8,["modelValue","placeholder","pt"]),b(s,new UTSJSONObject({class:"absolute right-0"}),{default:h((()=>[b(T(ae),new UTSJSONObject({ref:T(u).set("smsBtn"),phone:e.form.phone,onSuccess:a[2]||(a[2]=(e=null)=>f.value=!0)}),null,8,["phone"])])),_:1})])),_:1}),b(o,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-h--bracket-start-90rpx-bracket-end- -important-rounded-xl"}),loading:_.value,disabled:U.value,onClick:j}),{default:h((()=>[w(g(T(r)("登录")),1)])),_:1},8,["loading","disabled"])])),_:1})],64)}}});class se extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{avatarUrl:{type:String,optional:!1},nickName:{type:String,optional:!1}}}}}constructor(e,t=se.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.avatarUrl=this.__props__.avatarUrl,this.nickName=this.__props__.nickName,delete this.__props__}}const le=i({__name:"wx",emits:["success"],setup(e,n){var s=n.expose;n.emit;const l=P().user,o=B();(()=>{const e=new ee;M((()=>{e.getCode(),e.getMpConfig()}))})();const c=t(!1),i=t(!1),p=u(new se({avatarUrl:"",nickName:""}));function d(){c.value=!1}function O(){return a(this,void 0,void 0,(function*(){return""==p.avatarUrl?(o.showToast({message:r("请上传头像")}),Promise.resolve(null)):""==p.nickName?(o.showToast({message:r("请输入昵称")}),Promise.resolve(null)):(i.value=!0,yield Z(p.avatarUrl).then((e=>{l.update(new UTSJSONObject({nickName:p.nickName,avatarUrl:e})),d(),C.nextLogin()})).catch(((e=null)=>{o.showToast({message:e.message})})),void(i.value=!1))}))}function f(e){}function U(){c.value=!1}return s(new UTSJSONObject({login:function(){return a(this,void 0,void 0,(function*(){}))},editOpen:function(){c.value=!0},editClose:d})),(e=null,t=null)=>{const a=z(m("cl-text"),q),n=z(m("cl-avatar"),D),s=V,l=v,o=z(m("cl-input"),K),u=z(m("cl-button"),A),N=z(m("cl-popup"),W);return S(),_(N,new UTSJSONObject({modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=(e=null)=>c.value=e),direction:"center",title:T(r)("提示"),size:"80%",onClose:U}),new UTSJSONObject({default:h((()=>[b(l,new UTSJSONObject({class:"p-4 pt-0"}),{default:h((()=>[b(a,new UTSJSONObject({color:"info",pt:new UTSJSONObject({className:"-important-text-sm"})}),{default:h((()=>[w(g(T(r)("为提供更好的服务，我们邀请您填写昵称、头像等公开信息")),1)])),_:1}),b(l,new UTSJSONObject({class:"flex flex-row justify-between items-center bg-surface-100 rounded-xl p-2 px-3 mt-3 h--bracket-start-95rpx-bracket-end-"}),{default:h((()=>[b(a,null,{default:h((()=>[w(g(T(r)("头像")),1)])),_:1}),b(l,new UTSJSONObject({class:"relative"}),{default:h((()=>[b(n,new UTSJSONObject({size:60,src:p.avatarUrl}),null,8,["src"]),b(s,new UTSJSONObject({class:"absolute top-0 right-0 h-10 w-10 z-10 opacity-0 p-0 m-0","open-type":"chooseAvatar",onChooseavatar:f}))])),_:1})])),_:1}),b(l,new UTSJSONObject({class:"flex flex-row justify-between items-center bg-surface-100 rounded-xl p-2 px-3 mt-3 h--bracket-start-95rpx-bracket-end-"}),{default:h((()=>[b(a,null,{default:h((()=>[w(g(T(r)("昵称")),1)])),_:1}),b(o,new UTSJSONObject({modelValue:p.nickName,"onUpdate:modelValue":t[0]||(t[0]=(e=null)=>p.nickName=e),type:"nickname",border:!1,placeholder:T(r)("点击输入昵称"),maxlength:16,pt:new UTSJSONObject({className:"-important-bg-transparent -important-px-0 flex-1",inner:new UTSJSONObject({className:"text-right"})})}),null,8,["modelValue","placeholder"])])),_:1}),b(l,new UTSJSONObject({class:"flex flex-row mt-4"}),{default:h((()=>[b(u,new UTSJSONObject({size:"large",text:"",border:"",type:"light",pt:new UTSJSONObject({className:"flex-1 -important-rounded-xl h--bracket-start-80rpx-bracket-end-"}),onClick:d}),{default:h((()=>[w(g(T(r)("取消")),1)])),_:1}),b(u,new UTSJSONObject({size:"large",pt:new UTSJSONObject({className:"flex-1 -important-rounded-xl h--bracket-start-80rpx-bracket-end-"}),loading:i.value,onClick:O}),{default:h((()=>[w(g(T(r)("确认")),1)])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1}),8,["modelValue","title"])}}}),oe=F(i({__name:"login",setup(n){const s=P().user,o=B(),c=H(),i=u({phone:"18000000000",smsCode:"6666"}),p=t(!1);function d(e=null){return a(this,void 0,void 0,(function*(){s.setToken(J(e)),C.nextLogin()}))}return I("isAgree",(function(){return!!p.value||(o.showToast({message:r("请先阅读并同意《用户协议》和《隐私政策》")}),!1)})),(t=null,a=null)=>{const n=z(m("cl-topbar"),e),s=z(m("cl-image"),E),o=v,u=z(m("cl-text"),q),O=z(m("cl-checkbox"),G),f=z(m("cl-icon"),R),j=z(m("cl-page"),X);return S(),_(j,null,new UTSJSONObject({default:h((()=>[b(n,new UTSJSONObject({"safe-area-top":"","background-color":"transparent"})),b(o,new UTSJSONObject({class:"px-10"}),{default:h((()=>[b(o,new UTSJSONObject({class:"flex flex-col items-center justify-center py-20"}),{default:h((()=>[b(o,new UTSJSONObject({class:"p-3 bg-primary-500 rounded-2xl"}),{default:h((()=>[b(s,new UTSJSONObject({src:"/static/logo.png",mode:"widthFix",width:80,height:80}))])),_:1}),b(u,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xl font-bold mt-3"})}),{default:h((()=>[w(g(T(l).name),1)])),_:1})])),_:1}),b(T(ne),new UTSJSONObject({form:i,onSuccess:d}),null,8,["form"]),b(T(le),new UTSJSONObject({ref:T(c).set("loginWx")}),null,512),b(o,new UTSJSONObject({class:"mt-6 flex flex-row flex-wrap items-center justify-center"}),{default:h((()=>[b(O,new UTSJSONObject({modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=(e=null)=>p.value=e),pt:new UTSJSONObject({icon:new UTSJSONObject({size:28})}),"active-icon":"checkbox-circle-fill","inactive-icon":"checkbox-blank-circle-line"}),null,8,["modelValue"]),b(u,new UTSJSONObject({color:"info",pt:new UTSJSONObject({className:"-important-text-xs"})}),{default:h((()=>[w(g(T(r)("已阅读并同意")),1)])),_:1}),b(u,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xs"}),onClick:a[1]||(a[1]=$(((e=null)=>{T(r)("用户协议")}),["stop"]))}),{default:h((()=>[w(" 《"+g(T(r)("用户协议"))+"》 ",1)])),_:1}),b(u,new UTSJSONObject({color:"info",pt:new UTSJSONObject({className:"-important-text-xs"})}),{default:h((()=>[w("、")])),_:1}),b(u,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xs"}),onClick:a[2]||(a[2]=$(((e=null)=>{T(r)("隐私政策")}),["stop"]))}),{default:h((()=>[w(" 《"+g(T(r)("隐私政策"))+"》 ",1)])),_:1})])),_:1}),b(o,new UTSJSONObject({class:"flex flex-row justify-center mt-10 px-10"}),{default:h((()=>[b(o,new UTSJSONObject({class:U(["login-item",new UTSJSONObject({"is-dark":T(N)})]),onClick:a[3]||(a[3]=(e=null)=>T(c).callMethod("loginWx","login"))}),{default:h((()=>[b(f,new UTSJSONObject({name:"wechat-fill",size:38,color:"#00b223"}))])),_:1},8,["class"]),b(o,new UTSJSONObject({class:U(["login-item",new UTSJSONObject({"is-dark":T(N)})])}),{default:h((()=>[b(f,new UTSJSONObject({name:"apple-fill",size:38}))])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}))}}}),[["__scopeId","data-v-a6de929a"]]);export{oe as default};
