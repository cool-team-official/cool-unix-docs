import{_ as e}from"./cl-topbar.XfVjkHyi.js";import{d as t,z as a,G as l,c as n,$ as s,t as o,r,o as c,j as i,H as u,b as p,w as d,f as m,g as S,a as b,u as O,x as f,e as w,q as h,F as T,E as _,I as U,_ as N,J as j,K as g,L as x,M as v,p as J,N as k,h as y,O as C,n as V,l as $}from"./index-oaRQvvbJ.js";import{u as I,r as z,d as M,e as P,a as B,_ as A,b as F}from"./cl-page.uvue_vue_type_script_setup_true_lang.DgMmTlhG.js";import{_ as W}from"./cl-image.BNcpcr0w.js";import{_ as q}from"./cl-checkbox._hr7zSAO.js";import{u as E}from"./refs.CLtPX4Jy.js";import{_ as G}from"./cl-input.DvHgU7am.js";import{_ as H}from"./cl-avatar.uvue_vue_type_script_setup_true_lang.Czhxaed0.js";import{u as K}from"./index.Owwi8LSz.js";import"./form.BBM3ANUE.js";import"./parent.C1cpsRM9.js";class L extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{visible:{type:Boolean,optional:!1},loading:{type:Boolean,optional:!1},sending:{type:Boolean,optional:!1},img:{type:String,optional:!1}}}}}constructor(e,t=L.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.visible=this.__props__.visible,this.loading=this.__props__.loading,this.sending=this.__props__.sending,this.img=this.__props__.img,delete this.__props__}}const R=t({__name:"sms-btn",props:{phone:String},emits:["success"],setup(e,t){var g=t.expose,x=t.emit;const v=e,J=x,k=a(null),y=I(),C=l(new L({visible:!1,loading:!1,sending:!1,img:""})),V=a(0),$=n((()=>V.value>0||""==v.phone)),B=n((()=>V.value>0?s("{n}s后重新获取",new UTSJSONObject({n:V.value})):o("获取验证码"))),A=a(""),F=a("");function q(){A.value="",F.value=""}function E(){V.value=60;let e=0;function t(){V.value--,V.value<1&&clearInterval(e)}e=setInterval((()=>{t()}),1e3),t()}function H(){return _(this,void 0,void 0,(function*(){q(),C.loading=!0;class e extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{captchaId:{type:String,optional:!1},data:{type:String,optional:!1}}}}}constructor(t,a=e.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(t,a,l),this.captchaId=this.__props__.captchaId,this.data=this.__props__.data,delete this.__props__}}yield U.user.login.captcha(new UTSJSONObject({color:w.value?"#ffffff":"#2c3142",phone:v.phone})).then(((e=null)=>{const t=j(e);F.value=t.captchaId,C.img=t.data})).catch(((e=null)=>{y.showToast({message:e.message})})),C.loading=!1}))}function K(){return _(this,void 0,void 0,(function*(){""!=A.value?(C.sending=!0,yield U.user.login.smsCode(new UTSJSONObject({phone:v.phone,code:A.value,captchaId:F.value})).then((()=>{y.showToast({message:o("短信已发送，请查收")}),E(),C.visible=!1,C.img="",q(),J("success")})).catch(((e=null)=>{y.showToast({message:e.message}),H()})),C.sending=!1):y.showToast({message:o("请填写验证码")})}))}function R(){""!=v.phone&&(/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(v.phone)?(C.visible=!0,H()):y.showToast({message:o("请填写正确的手机号格式")}))}return g(new UTSJSONObject({open:R,send:K,getCaptcha:H,startCountdown:E})),(e=null,t=null)=>{const a=z(r("cl-button"),M),l=z(r("cl-input"),G),n=z(r("cl-image"),W),s=N,_=z(r("cl-popup"),P);return c(),i(T,null,[u(e.$slots,"default",new UTSJSONObject({disabled:$.value,countdown:V.value,btnText:B.value}),(()=>[p(a,new UTSJSONObject({text:"",disabled:$.value,onClick:R}),{default:d((()=>[m(S(B.value),1)])),_:1},8,["disabled"])])),p(_,new UTSJSONObject({modelValue:C.visible,"onUpdate:modelValue":t[1]||(t[1]=(e=null)=>C.visible=e),ref_key:"popupRef",ref:k,direction:"center",title:O(o)("获取短信验证码")}),{default:d((()=>[C.visible?(c(),b(s,new UTSJSONObject({key:0,class:"p-3 pt-2 pb-4 w--bracket-start-460rpx-bracket-end-"}),new UTSJSONObject({default:d((()=>[p(s,new UTSJSONObject({class:"flex flex-row items-center"}),{default:d((()=>[p(l,new UTSJSONObject({modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=(e=null)=>A.value=e),placeholder:O(o)("验证码"),maxlength:4,autofocus:"",clearable:!1,pt:new UTSJSONObject({className:"flex-1 mr-2 -important-h--bracket-start-70rpx-bracket-end-"}),onConfirm:K}),null,8,["modelValue","placeholder"]),p(n,new UTSJSONObject({src:C.img,height:70,width:200,pt:new UTSJSONObject({className:"-important-rounded-lg",error:new UTSJSONObject({className:O(f)([[O(w),"-important-bg-surface-800","-important-bg-surface-200"]]),name:"refresh-line"})}),onClick:H}),null,8,["src","pt"])])),_:1}),p(a,new UTSJSONObject({type:"primary",disabled:""==A.value,loading:C.sending,pt:new UTSJSONObject({className:"-important-h--bracket-start-70rpx-bracket-end- mt-3"}),onClick:K}),{default:d((()=>[m(S(O(o)("发送短信")),1)])),_:1},8,["disabled","loading"])])),_:1}))):h("",!0)])),_:1},8,["modelValue","title"])],64)}}}),D=t({__name:"phone",props:{form:{type:Object,default:()=>new UTSJSONObject({})}},emits:["success"],setup(e,t){var l=t.emit;const s=e,u=l,b=I(),h=E(),j=g("isAgree"),x=a(!1),v=a(!1),J=n((()=>""==s.form.phone||""==s.form.smsCode));function k(){return _(this,void 0,void 0,(function*(){if(!j())return Promise.resolve(null);const e=s.form,t=e.phone,a=e.smsCode;v.value=!0,yield U.user.login.phone(new UTSJSONObject({phone:t,smsCode:a})).then(((e=null)=>{u("success",e)})).catch(((e=null)=>{b.showToast({message:e.message})})),v.value=!1}))}return(t=null,a=null)=>{const l=z(r("cl-text"),B),n=N,s=z(r("cl-input"),G),u=z(r("cl-button"),M);return c(),i(T,null,[p(n,new UTSJSONObject({class:"flex flex-col mb-5"}),{default:d((()=>[p(l,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-lg font-bold"})}),{default:d((()=>[m(S(O(o)("手机登录")),1)])),_:1}),p(l,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-sm mt-2"}),color:"info"}),{default:d((()=>[m(S(O(o)("未注册的手机号登录成功后将自动注册")),1)])),_:1})])),_:1}),p(n,new UTSJSONObject({class:"flex flex-col"}),{default:d((()=>[p(n,new UTSJSONObject({class:"mb-3 flex flex-row"}),{default:d((()=>[p(s,new UTSJSONObject({modelValue:e.form.phone,"onUpdate:modelValue":a[0]||(a[0]=(t=null)=>e.form.phone=t),"prefix-icon":"device-fill",placeholder:O(o)("请输入手机号"),border:!1,pt:new UTSJSONObject({className:O(f)(["-important-h--bracket-start-90rpx-bracket-end- flex-1 -important-rounded-xl -important-px-4",[O(w),"-important-bg-surface-70","-important-bg-white"]]),prefixIcon:new UTSJSONObject({className:"mr-1"})})}),null,8,["modelValue","placeholder","pt"])])),_:1}),p(n,new UTSJSONObject({class:"relative flex flex-row items-center mb-5"}),{default:d((()=>[p(s,new UTSJSONObject({modelValue:e.form.smsCode,"onUpdate:modelValue":a[1]||(a[1]=(t=null)=>e.form.smsCode=t),clearable:!1,type:"number","prefix-icon":"shield-check-fill",placeholder:O(o)("请输入验证码"),maxlength:4,border:!1,pt:new UTSJSONObject({className:O(f)(["-important-h--bracket-start-90rpx-bracket-end- flex-1 -important-rounded-xl -important-px-4",[O(w),"-important-bg-surface-70","-important-bg-white"]]),prefixIcon:new UTSJSONObject({className:"mr-1"})})}),null,8,["modelValue","placeholder","pt"]),p(n,new UTSJSONObject({class:"absolute right-0"}),{default:d((()=>[p(O(R),new UTSJSONObject({ref:O(h).set("smsBtn"),phone:e.form.phone,onSuccess:a[2]||(a[2]=(e=null)=>x.value=!0)}),null,8,["phone"])])),_:1})])),_:1}),p(u,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-h--bracket-start-90rpx-bracket-end- -important-rounded-xl"}),loading:v.value,disabled:J.value,onClick:k}),{default:d((()=>[m(S(O(o)("登录")),1)])),_:1},8,["loading","disabled"])])),_:1})],64)}}});class Q extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{avatarUrl:{type:String,optional:!1},nickName:{type:String,optional:!1}}}}}constructor(e,t=Q.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.avatarUrl=this.__props__.avatarUrl,this.nickName=this.__props__.nickName,delete this.__props__}}const X=t({__name:"wx",emits:["success"],setup(e,t){var n=t.expose;t.emit;const s=J().user,i=I(),u=a(!1),f=a(!1),w=l(new Q({avatarUrl:"",nickName:""}));function h(){u.value=!1}function T(){return _(this,void 0,void 0,(function*(){return""==w.avatarUrl?(i.showToast({message:o("请上传头像")}),Promise.resolve(null)):""==w.nickName?(i.showToast({message:o("请输入昵称")}),Promise.resolve(null)):(f.value=!0,yield K(w.avatarUrl).then((e=>{s.update({nickName:w.nickName,avatarUrl:e}),h()})).catch(((e=null)=>{i.showToast({message:e.message})})),void(f.value=!1))}))}function U(e){}function j(){u.value=!1}return n(new UTSJSONObject({login:function(){return _(this,void 0,void 0,(function*(){return i.showToast({message:o("开发中，敬请期待")}),Promise.resolve(null)}))},editOpen:function(){u.value=!0},editClose:h})),(e=null,t=null)=>{const a=z(r("cl-text"),B),l=z(r("cl-avatar"),H),n=v,s=N,i=z(r("cl-input"),G),_=z(r("cl-button"),M),g=z(r("cl-popup"),P);return c(),b(g,new UTSJSONObject({modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=(e=null)=>u.value=e),direction:"center",title:O(o)("提示"),size:"80%",onClose:j}),new UTSJSONObject({default:d((()=>[x("div",new UTSJSONObject({class:"p-4 pt-0"}),[p(a,new UTSJSONObject({color:"info",pt:new UTSJSONObject({className:"-important-text-sm"})}),{default:d((()=>[m(S(O(o)("为提供更好的服务，我们邀请您填写昵称、头像等公开信息")),1)])),_:1}),p(s,new UTSJSONObject({class:"flex flex-row justify-between items-center bg-surface-100 rounded-xl p-2 px-3 mt-3 h--bracket-start-95rpx-bracket-end-"}),{default:d((()=>[p(a,null,{default:d((()=>[m(S(O(o)("头像")),1)])),_:1}),p(s,new UTSJSONObject({class:"relative"}),{default:d((()=>[p(l,new UTSJSONObject({size:60,src:w.avatarUrl}),null,8,["src"]),p(n,new UTSJSONObject({class:"absolute top-0 right-0 h-10 w-10 z-10 opacity-0 p-0 m-0","open-type":"chooseAvatar",onChooseavatar:U}))])),_:1})])),_:1}),p(s,new UTSJSONObject({class:"flex flex-row justify-between items-center bg-surface-100 rounded-xl p-2 px-3 mt-3 h--bracket-start-95rpx-bracket-end-"}),{default:d((()=>[p(a,null,{default:d((()=>[m(S(O(o)("昵称")),1)])),_:1}),p(i,new UTSJSONObject({modelValue:w.nickName,"onUpdate:modelValue":t[0]||(t[0]=(e=null)=>w.nickName=e),type:"nickname",border:!1,placeholder:O(o)("点击输入昵称"),maxlength:16,pt:new UTSJSONObject({className:"-important-bg-transparent -important-px-0 flex-1",inner:new UTSJSONObject({className:"text-right"})})}),null,8,["modelValue","placeholder"])])),_:1}),p(s,new UTSJSONObject({class:"flex flex-row mt-4"}),{default:d((()=>[p(_,new UTSJSONObject({size:"large",text:"",border:"",type:"light",pt:new UTSJSONObject({className:"flex-1 -important-rounded-xl h--bracket-start-80rpx-bracket-end-"}),onClick:h}),{default:d((()=>[m(S(O(o)("取消")),1)])),_:1}),p(_,new UTSJSONObject({size:"large",pt:new UTSJSONObject({className:"flex-1 -important-rounded-xl h--bracket-start-80rpx-bracket-end-"}),loading:f.value,onClick:T}),{default:d((()=>[m(S(O(o)("确认")),1)])),_:1},8,["loading"])])),_:1})])])),_:1}),8,["modelValue","title"])}}}),Y=t({__name:"login",setup(t){const n=J().user,s=I(),i=E(),u=l({phone:"18000000000",smsCode:"6666"}),f=a(!1);function h(e=null){n.setToken(j(e)),$.home()}return k("isAgree",(function(){return!!f.value||(s.showToast({message:o("请先阅读并同意《用户协议》和《隐私政策》")}),!1)})),(t=null,a=null)=>{const l=z(r("cl-topbar"),e),n=z(r("cl-image"),W),s=N,T=z(r("cl-text"),B),_=z(r("cl-checkbox"),q),U=z(r("cl-icon"),A),j=z(r("cl-page"),F);return c(),b(j,null,new UTSJSONObject({default:d((()=>[p(l,new UTSJSONObject({"safe-area-top":"","background-color":"transparent"})),p(s,new UTSJSONObject({class:"px-10"}),{default:d((()=>[p(s,new UTSJSONObject({class:"flex flex-col items-center justify-center py-20"}),{default:d((()=>[p(s,new UTSJSONObject({class:"p-3 bg-primary-500 rounded-2xl"}),{default:d((()=>[p(n,new UTSJSONObject({src:"/static/logo.png",mode:"widthFix",width:80,height:80}))])),_:1}),p(T,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xl font-bold mt-3"})}),{default:d((()=>[m(S(O(y).name),1)])),_:1})])),_:1}),p(O(D),new UTSJSONObject({form:u,onSuccess:h}),null,8,["form"]),p(O(X),new UTSJSONObject({ref:O(i).set("loginWx"),onSuccess:h}),null,512),p(s,new UTSJSONObject({class:"mt-6 flex flex-row flex-wrap items-center justify-center"}),{default:d((()=>[p(_,new UTSJSONObject({modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=(e=null)=>f.value=e),pt:new UTSJSONObject({icon:new UTSJSONObject({size:28})}),"active-icon":"checkbox-circle-fill","inactive-icon":"checkbox-blank-circle-line"}),null,8,["modelValue"]),p(T,new UTSJSONObject({color:"info",pt:new UTSJSONObject({className:"-important-text-xs"})}),{default:d((()=>[m(S(O(o)("已阅读并同意")),1)])),_:1}),p(T,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xs"}),onClick:a[1]||(a[1]=C(((e=null)=>{O(o)("用户协议")}),["stop"]))}),{default:d((()=>[m(" 《"+S(O(o)("用户协议"))+"》 ",1)])),_:1}),p(T,new UTSJSONObject({color:"info",pt:new UTSJSONObject({className:"-important-text-xs"})}),{default:d((()=>[m("、")])),_:1}),p(T,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xs"}),onClick:a[2]||(a[2]=C(((e=null)=>{O(o)("隐私政策")}),["stop"]))}),{default:d((()=>[m(" 《"+S(O(o)("隐私政策"))+"》 ",1)])),_:1})])),_:1}),p(s,new UTSJSONObject({class:"flex flex-row justify-center mt-10 px-10"}),{default:d((()=>[p(s,new UTSJSONObject({class:V(["mx-5flex items-center justify-center h-10 w-10 rounded-full bg-white border border-solid border-surface-100",new UTSJSONObject({"dark-colon-bg-surface-700":O(w),"dark-colon-border-surface-600":O(w)})]),onClick:a[3]||(a[3]=(e=null)=>O(i).callMethod("loginWx","login"))}),{default:d((()=>[p(U,new UTSJSONObject({name:"wechat-fill",size:38,color:"#00b223"}))])),_:1},8,["class"]),p(s,new UTSJSONObject({class:V(["mx-5 flex items-center justify-center h-10 w-10 rounded-full bg-white border border-solid border-surface-100",new UTSJSONObject({"dark-colon-bg-surface-700":O(w),"dark-colon-border-surface-600":O(w)})])}),{default:d((()=>[p(U,new UTSJSONObject({name:"apple-fill",size:38}))])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}))}}});export{Y as default};
