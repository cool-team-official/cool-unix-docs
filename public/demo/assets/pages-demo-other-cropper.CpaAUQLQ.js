import{d as t,a4 as e,af as i,z as a,c as s,G as n,r as o,o as h,a as r,w as l,n as c,O as p,p as d,U as _,V as u,D as g,E as w,aA as m,_ as S,b as T,W as b,g as O,h as U,F as f,f as y,j as x,ao as N,aC as j,ag as v,aB as J,aa as X,ar as Y,u as k,t as M}from"./index-CVV1TSA3.js";import{r as $,a as I,_ as C,c as B,d as H,b as W}from"./cl-page.uvue_vue_type_script_setup_true_lang.C_4yWtlS.js";import{_ as z}from"./cl-switch._ds2U0_a.js";import{_ as L,a as P}from"./cl-list.D8-zSd0F.js";import{c as D}from"./file.BBnXdO2E.js";import{D as F}from"./item.BP78fctf.js";import"./index.U6ITPUe7.js";import"./cl-collapse.D9wTDJH8.js";import"./item.uvue_vue_type_style_index_0_scoped_f51a3be8_lang.D4ketlxw.js";class R extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{top:{type:"Unknown",optional:!1},right:{type:"Unknown",optional:!1},bottom:{type:"Unknown",optional:!1},left:{type:"Unknown",optional:!1}}}}}constructor(t,e=R.get$UTSMetadata$(),i=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,i),this.top=this.__props__.top,this.right=this.__props__.right,this.bottom=this.__props__.bottom,this.left=this.__props__.left,delete this.__props__}}class V extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{width:{type:Number,optional:!1},height:{type:Number,optional:!1},isLoaded:{type:Boolean,optional:!1}}}}}constructor(t,e=V.get$UTSMetadata$(),i=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,i),this.width=this.__props__.width,this.height=this.__props__.height,this.isLoaded=this.__props__.isLoaded,delete this.__props__}}class A extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{translateX:{type:Number,optional:!1},translateY:{type:Number,optional:!1}}}}}constructor(t,e=A.get$UTSMetadata$(),i=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,i),this.translateX=this.__props__.translateX,this.translateY=this.__props__.translateY,delete this.__props__}}class q extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{width:{type:Number,optional:!1},height:{type:Number,optional:!1}}}}}constructor(t,e=q.get$UTSMetadata$(),i=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,i),this.width=this.__props__.width,this.height=this.__props__.height,delete this.__props__}}class E extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{x:{type:Number,optional:!1},y:{type:Number,optional:!1},width:{type:Number,optional:!1},height:{type:Number,optional:!1}}}}}constructor(t,e=E.get$UTSMetadata$(),i=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,i),this.x=this.__props__.x,this.y=this.__props__.y,this.width=this.__props__.width,this.height=this.__props__.height,delete this.__props__}}class G extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{startX:{type:Number,optional:!1},startY:{type:Number,optional:!1},startDistance:{type:Number,optional:!1},startImageWidth:{type:Number,optional:!1},startImageHeight:{type:Number,optional:!1},startTranslateX:{type:Number,optional:!1},startTranslateY:{type:Number,optional:!1},startCropBoxWidth:{type:Number,optional:!1},startCropBoxHeight:{type:Number,optional:!1},isTouching:{type:Boolean,optional:!1},mode:{type:String,optional:!1},direction:{type:String,optional:!1}}}}}constructor(t,e=G.get$UTSMetadata$(),i=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,i),this.startX=this.__props__.startX,this.startY=this.__props__.startY,this.startDistance=this.__props__.startDistance,this.startImageWidth=this.__props__.startImageWidth,this.startImageHeight=this.__props__.startImageHeight,this.startTranslateX=this.__props__.startTranslateX,this.startTranslateY=this.__props__.startTranslateY,this.startCropBoxWidth=this.__props__.startCropBoxWidth,this.startCropBoxHeight=this.__props__.startCropBoxHeight,this.isTouching=this.__props__.isTouching,this.mode=this.__props__.mode,this.direction=this.__props__.direction,delete this.__props__}}class K extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},image:{type:"Unknown",optional:!0},op:{type:"Unknown",optional:!0},mask:{type:"Unknown",optional:!0},cropBox:{type:"Unknown",optional:!0},button:{type:"Unknown",optional:!0}}}}}constructor(t,e=K.get$UTSMetadata$(),i=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,i),this.className=this.__props__.className,this.image=this.__props__.image,this.op=this.__props__.op,this.mask=this.__props__.mask,this.cropBox=this.__props__.cropBox,this.button=this.__props__.button,delete this.__props__}}const Q=B(t(Object.assign({name:"cl-cropper"},{__name:"cl-cropper",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},cropWidth:{type:Number,default:300},cropHeight:{type:Number,default:300},maxScale:{type:Number,default:3},resizable:{type:Boolean,default:!1}},emits:["crop","load","error"],setup(t,Y){var k=Y.expose,M=Y.emit;const B=t,H=M,W=e().proxy,z=N(),L="cl-cropper__".concat(i()),P=a(null);function F(t){return Math.round(t)}const K=s((()=>_(B.pt))),Q=n(new q({height:0,width:0})),Z=n(new V({width:0,height:0,isLoaded:!1})),tt=n(new A({translateX:0,translateY:0})),et=n(new q({width:0,height:0})),it=n(new E({x:0,y:0,width:B.cropWidth,height:B.cropHeight})),at=n(new G({startX:0,startY:0,startDistance:0,startImageWidth:0,startImageHeight:0,startTranslateX:0,startTranslateY:0,startCropBoxWidth:0,startCropBoxHeight:0,isTouching:!1,mode:"",direction:""})),st=a(!1),nt=a(!1),ot=a(!1),ht=a(!1),rt=a(0),lt=s((()=>{const t=ot.value?"scaleX(-1)":"scaleX(1)",e=ht.value?"scaleY(-1)":"scaleY(1)",i=new UTSJSONObject({transform:"translate(".concat(F(tt.translateX),"px, ").concat(F(tt.translateY),"px) ").concat(t," ").concat(e," rotate(").concat(rt.value,"deg)"),height:F(et.height)+"px",width:F(et.width)+"px"});return at.isTouching||(i.transitionDuration="0.3s"),i})),ct=s((()=>new UTSJSONObject({left:"".concat(F(it.x),"px"),top:"".concat(F(it.y),"px"),width:"".concat(F(it.width),"px"),height:"".concat(F(it.height),"px")}))),pt=s((()=>new R({top:new UTSJSONObject({height:"".concat(F(it.y),"px"),width:"".concat(F(it.width),"px"),left:"".concat(F(it.x),"px")}),right:new UTSJSONObject({width:"".concat(F(Q.width-it.x-it.width),"px"),height:"100%",top:0,left:"".concat(F(it.x+it.width),"px")}),bottom:new UTSJSONObject({height:"".concat(F(Q.height-it.y-it.height),"px"),width:"".concat(F(it.width),"px"),bottom:0,left:"".concat(F(it.x),"px")}),left:new UTSJSONObject({width:"".concat(F(it.x),"px"),height:"100%",left:0})}))),dt=s((()=>{let t=z.getSafeAreaHeight("bottom");return 0==t&&(t=10),new UTSJSONObject({bottom:t+"px"})}));function _t(){const t=(rt.value%360+360)%360;return new q(90==t||270==t?{width:et.height,height:et.width}:{width:et.width,height:et.height})}function ut(){const t=X(),e=t.windowHeight,i=t.windowWidth;if(Q.height=e,Q.width=i,it.width=B.cropWidth,it.height=B.cropHeight,it.x=F((Q.width-it.width)/2),it.y=F((Q.height-it.height)/2),Z.isLoaded){const t=function(){if(!Z.isLoaded||0==Z.width||0==Z.height)return new q({width:0,height:0});const t=(rt.value%360+360)%360;let e=Z.width,i=Z.height;90!=t&&270!=t||(e=Z.height,i=Z.width);const a=e/i;let s,n;a>Q.width/Q.height?(s=Q.width,n=Q.width/a):(n=Q.height,s=Q.height*a);const o=it.width/s,h=it.height/n,r=1.01*Math.max(o,h);return new q({width:F(s*r),height:F(n*r)})}();(et.width<t.width||et.height<t.height)&&(et.width=F(t.width),et.height=F(t.height))}}function gt(){if(!Z.isLoaded)return null;const t=_t(),e=Q.width/2+tt.translateX,i=Q.height/2+tt.translateY,a=e-t.width/2,s=e+t.width/2,n=i-t.height/2,o=i+t.height/2,h=it.x,r=it.x+it.width,l=it.y,c=it.y+it.height;let p=tt.translateX,d=tt.translateY;a>h?p-=a-h:s<r&&(p+=r-s),n>l?d-=n-l:o<c&&(d+=c-o),tt.translateX=F(p),tt.translateY=F(d)}function wt(){at.isTouching=!1,at.mode="",at.direction="",st.value=!1,function(){if(!Z.isLoaded)return null;const t=et.width,e=et.height,i=it.width/at.startCropBoxWidth,a=it.height/at.startCropBoxHeight;let s=1/Math.max(i,a),n=t*s,o=e*s;const h=((t,e)=>{const i=(rt.value%360+360)%360;return new q(90==i||270==i?{width:e,height:t}:{width:t,height:e})})(n,o),r=it.width/h.width,l=it.height/h.height,c=Math.max(r,l);c>1&&(s*=c,n=t*s,o=e*s);const p=Q.width*B.maxScale/n,d=Q.height*B.maxScale/o,_=Math.min(p,d,1);n*=_,o*=_,et.width=F(n),et.height=F(o),it.x=F((Q.width-it.width)/2),it.y=F((Q.height-it.height)/2),tt.translateX=0,tt.translateY=0,gt()}(),setTimeout((()=>{nt.value=!1}),200)}function mt(t){if(!Z.isLoaded)return null;if(at.isTouching=!0,at.mode="image",1==t.touches.length)at.startX=t.touches[0].clientX,at.startY=t.touches[0].clientY,at.startTranslateX=tt.translateX,at.startTranslateY=tt.translateY;else if(2==t.touches.length){const e=t.touches[0],i=t.touches[1];at.startDistance=Math.sqrt(Math.pow(i.clientX-e.clientX,2)+Math.pow(i.clientY-e.clientY,2)),at.startImageWidth=et.width,at.startImageHeight=et.height,at.startX=(e.clientX+i.clientX)/2,at.startY=(e.clientY+i.clientY)/2,at.startTranslateX=tt.translateX,at.startTranslateY=tt.translateY}}function St(t){if(!at.isTouching)return null;if("resizing"==at.mode)return function(t){if(!at.isTouching||"resizing"!=at.mode)return null;if(1==t.touches.length){const e=t.touches[0].clientX-at.startX,i=t.touches[0].clientY-at.startY,a=50;let s=0,n=0,o=it.x,h=it.y,r=it.width,l=it.height;switch(at.direction){case"tl":s=it.x+it.width,n=it.y+it.height,r=s-(it.x+e),l=n-(it.y+i),o=s-r,h=n-l;break;case"tr":s=it.x,n=it.y+it.height,r=it.width+e,l=n-(it.y+i),o=s,h=n-l;break;case"bl":s=it.x+it.width,n=it.y,r=s-(it.x+e),l=it.height+i,o=s-r,h=n;break;case"br":s=it.x,n=it.y,r=it.width+e,l=it.height+i,o=s,h=n}r<a&&(r=a,"tl"!=at.direction&&"bl"!=at.direction||(o=s-r)),l<a&&(l=a,"tl"!=at.direction&&"tr"!=at.direction||(h=n-l)),o=F(Math.max(0,Math.min(o,Q.width-r))),h=F(Math.max(0,Math.min(h,Q.height-l))),0!=o||"tl"!=at.direction&&"bl"!=at.direction||(r=s),0!=h||"tl"!=at.direction&&"tr"!=at.direction||(l=n),o+r>=Q.width&&("tr"==at.direction||"br"==at.direction)&&(r=Q.width-o),h+l>=Q.height&&("bl"==at.direction||"br"==at.direction)&&(l=Q.height-h),it.x=F(o),it.y=F(h),it.width=F(r),it.height=F(l),at.startX=t.touches[0].clientX,at.startY=t.touches[0].clientY}}(t),null;if(1==t.touches.length){const e=t.touches[0].clientX-at.startX,i=t.touches[0].clientY-at.startY;tt.translateX=F(at.startTranslateX+e),tt.translateY=F(at.startTranslateY+i)}else if(2==t.touches.length){const e=t.touches[0],i=t.touches[1],a=Math.sqrt(Math.pow(i.clientX-e.clientX,2)+Math.pow(i.clientY-e.clientY,2))/at.startDistance,s=at.startImageWidth*a,n=at.startImageHeight*a,o=function(){if(!Z.isLoaded)return new q({width:0,height:0});const t=Z.width/Z.height,e=(rt.value%360+360)%360;let i,a,s,n;return 90==e||270==e?(i=it.height,a=it.width):(i=it.width,a=it.height),i/t>a?(s=i,n=i/t):(n=a,s=a*t),new q({width:F(s),height:F(n)})}(),h=Q.width*B.maxScale,r=Q.height*B.maxScale,l=o.width/s,c=o.height/n,p=h/s,d=r/n,_=Math.max(l,c),u=Math.min(p,d),g=Math.max(_,Math.min(u,1)),w=s*g,m=n*g,S=(e.clientX+i.clientX)/2,T=(e.clientY+i.clientY)/2,b=w-at.startImageWidth,O=m-at.startImageHeight,U=(S-Q.width/2)*b/(2*at.startImageWidth),f=(T-Q.height/2)*O/(2*at.startImageHeight);et.width=F(w),et.height=F(m),tt.translateX=F(at.startTranslateX-U),tt.translateY=F(at.startTranslateY-f)}}function Tt(){if("resizing"==at.mode)return wt(),null;at.isTouching=!1,at.mode="",gt()}function bt(){ut(),ot.value=!1,ht.value=!1,rt.value=0,tt.translateX=0,tt.translateY=0,Z.isLoaded?(!function(){if(!Z.isLoaded||0==Z.width||0==Z.height)return null;const t=Z.width/Z.height;let e,i;t>Q.width/Q.height?(e=Q.width,i=Q.width/t):(i=Q.height,e=Q.height*t);const a=it.width/e,s=it.height/i,n=Math.max(a,s);et.width=F(e*n),et.height=F(i*n)}(),gt()):(et.width=F(0),et.height=F(0),tt.translateX=F(0),tt.translateY=F(0))}const Ot=a(!1),Ut=a("");function ft(t){Ot.value=!0,u((()=>{Ut.value=t}))}function yt(){Ot.value=!1}function xt(){g(new UTSJSONObject({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:t=>{t.tempFilePaths.length>0&&ft(t.tempFilePaths[0])}}))}function Nt(t){Z.width=t.detail.width,Z.height=t.detail.height,Z.isLoaded=!0,bt(),H("load",t)}function jt(){if(rt.value-=90,Z.isLoaded){const t=_t(),e=it.width/t.width,i=it.height/t.height,a=Math.max(e,i);a>1&&(et.width=F(et.width*a),et.height=F(et.height*a)),gt()}}function vt(){return w(this,void 0,void 0,(function*(){return new Promise((t=>{m({id:L,component:W,success:e=>{var i;const a=e.getContext("2d");a.clearRect(0,0,it.width,it.height);const s=null!==(i=j().devicePixelRatio)&&void 0!==i?i:1;let n;a.canvas.width=it.width*s,a.canvas.height=it.height*s,n=new Image,n.src=Ut.value,n.onload=()=>{let e,i;switch(Math.abs(rt.value)%360){case 270:e=(et.width-it.height)/2-tt.translateY,i=(et.height+it.width)/2+tt.translateX;break;case 180:e=(et.width+it.width)/2+tt.translateX,i=(et.height+it.height)/2+tt.translateY;break;case 90:e=(et.width+it.height)/2+tt.translateY,i=(et.height-it.width)/2-tt.translateX;break;default:e=(et.width-it.width)/2-tt.translateX,i=(et.height-it.height)/2-tt.translateY}e<0&&(e=0),i<0&&(i=0),a.rotate(rt.value*Math.PI/180),a.drawImage(n,-e*s,-i*s,et.width*s,et.height*s),setTimeout((()=>{D(P.value).then((e=>{H("crop",e),t(e)}))}),10)}}})}))}))}return k(new UTSJSONObject({open:ft,close:yt,chooseImage:xt,toPng:vt})),(e=null,i=null)=>{const a=v,s=S,n=$(o("cl-text"),I),_=$(o("cl-icon"),C),u=J;return Ot.value?(h(),r(s,new UTSJSONObject({key:0,class:c(["cl-cropper",[new UTSJSONObject({}),K.value.className]]),onTouchstart:mt,onTouchmove:p(St,["stop","prevent"]),onTouchend:Tt,onTouchcancel:Tt}),{default:l((()=>{var e,o,r;return[T(s,new UTSJSONObject({class:"cl-cropper__image"}),{default:l((()=>{var t;return[T(a,{class:c(["cl-cropper__image-inner",[new UTSJSONObject({}),null===(t=K.value.image)||void 0===t?null:t.className]]),src:Ut.value,style:b(lt.value),onLoad:Nt},null,8,["class","src","style"])]})),_:1}),T(s,{class:c(["cl-cropper__mask",[new UTSJSONObject({}),null===(e=K.value.mask)||void 0===e?null:e.className]])},{default:l((()=>[(h(),O(f,null,U(["top","right","bottom","left"],((t,e)=>T(s,new UTSJSONObject({key:e,class:c("cl-cropper__mask-item cl-cropper__mask-item--".concat(t)),style:b(pt.value[t])}),null,8,["class","style"]))),64))])),_:1},8,["class"]),T(s,{class:c(["cl-cropper__crop-box",[new UTSJSONObject({}),null===(o=K.value.cropBox)||void 0===o?null:o.className]]),style:b(ct.value)},{default:l((()=>[T(s,new UTSJSONObject({class:c(["cl-cropper__crop-area",new UTSJSONObject({"is-resizing":st.value})])}),{default:l((()=>[T(s,new UTSJSONObject({class:c(["cl-cropper__guide-lines",new UTSJSONObject({"is-show":nt.value})])}),{default:l((()=>[T(s,new UTSJSONObject({class:"cl-cropper__guide-line cl-cropper__guide-line--h1"})),T(s,new UTSJSONObject({class:"cl-cropper__guide-line cl-cropper__guide-line--h2"})),T(s,new UTSJSONObject({class:"cl-cropper__guide-line cl-cropper__guide-line--v1"})),T(s,new UTSJSONObject({class:"cl-cropper__guide-line cl-cropper__guide-line--v2"})),T(s,new UTSJSONObject({class:"cl-cropper__guide-text"}),{default:l((()=>[T(n,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xl"}),color:"white"}),{default:l((()=>[y(x(it.width),1)])),_:1}),T(_,new UTSJSONObject({name:"close-line",color:"white"})),T(n,new UTSJSONObject({pt:new UTSJSONObject({className:"-important-text-xl"}),color:"white"}),{default:l((()=>[y(x(it.height),1)])),_:1})])),_:1})])),_:1},8,["class"])])),_:1},8,["class"]),t.resizable?(h(),O(f,new UTSJSONObject({key:0}),U(["tl","tr","bl","br"],(t=>T(s,new UTSJSONObject({key:t,class:c(["cl-cropper__drag-point",[new UTSJSONObject({}),"cl-cropper__drag-point--".concat(t)]]),onTouchstart:p(((e=null)=>{return i=e,a=t,at.isTouching=!0,at.mode="resizing",at.direction=a,st.value=!0,nt.value=!0,void(1==i.touches.length&&(at.startX=i.touches[0].clientX,at.startY=i.touches[0].clientY,at.startCropBoxWidth=it.width,at.startCropBoxHeight=it.height));var i,a}),["stop"])}),{default:l((()=>[T(s,new UTSJSONObject({class:"cl-cropper__corner-indicator"}))])),_:2},1032,["class","onTouchstart"]))),64)):d("",!0)])),_:1},8,["class","style"]),T(s,{class:c(["cl-cropper__op",[new UTSJSONObject({}),null===(r=K.value.op)||void 0===r?null:r.className]]),style:b(dt.value),onTouchmove:i[0]||(i[0]=p((()=>{}),["stop"]))},{default:l((()=>[T(s,new UTSJSONObject({class:"cl-cropper__op-item"}),{default:l((()=>[T(_,new UTSJSONObject({name:"close-line",color:"white",size:50,onClick:yt}))])),_:1}),T(s,new UTSJSONObject({class:"cl-cropper__op-item"}),{default:l((()=>[T(_,new UTSJSONObject({name:"anticlockwise-line",color:"white",size:40,onClick:jt}))])),_:1}),T(s,new UTSJSONObject({class:"cl-cropper__op-item"}),{default:l((()=>[T(_,new UTSJSONObject({name:"reset-right-line",color:"white",size:40,onClick:bt}))])),_:1}),T(s,new UTSJSONObject({class:"cl-cropper__op-item"}),{default:l((()=>[T(_,new UTSJSONObject({name:"image-line",color:"white",size:40,onClick:xt}))])),_:1}),T(s,new UTSJSONObject({class:"cl-cropper__op-item"}),{default:l((()=>[T(_,new UTSJSONObject({name:"check-line",color:"white",size:50,onClick:vt}))])),_:1})])),_:1},8,["class","style"]),T(s,new UTSJSONObject({class:"cl-cropper__canvas"}),{default:l((()=>[T(u,new UTSJSONObject({ref_key:"canvasRef",ref:P,id:L,style:b({height:"".concat(it.height,"px"),width:"".concat(it.width,"px")})}),null,8,["style"])])),_:1})]})),_:1},8,["class"])):d("",!0)}}})),[["__scopeId","data-v-7245d90f"]]),Z=t({__name:"cropper",setup(t){const e=a(null),i=a(!0);function s(){g(new UTSJSONObject({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:t=>{t.tempFilePaths.length>0&&e.value.open(t.tempFilePaths[0])}}))}function n(t){Y({urls:[t]})}function r(t){console.log("onImageLoad",t)}return(t=null,a=null)=>{const c=$(o("cl-button"),H),p=$(o("cl-switch"),z),d=$(o("cl-list-item"),L),_=$(o("cl-list"),P),u=S,g=$(o("cl-page"),W),w=$(o("cl-cropper"),Q);return h(),O(f,null,[T(g,null,{default:l((()=>[T(u,new UTSJSONObject({class:"p-3"}),{default:l((()=>[T(k(F),new UTSJSONObject({label:k(M)("自定义")}),{default:l((()=>[T(c,new UTSJSONObject({onClick:s}),{default:l((()=>[y(x(k(M)("选择图片")),1)])),_:1}),T(_,new UTSJSONObject({border:"",pt:new UTSJSONObject({className:"mt-5"})}),{default:l((()=>[T(d,new UTSJSONObject({label:k(M)("可调节裁剪框大小")}),{default:l((()=>[T(p,new UTSJSONObject({modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=(t=null)=>i.value=t)}),null,8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1},8,["label"])])),_:1})])),_:1}),T(w,new UTSJSONObject({ref_key:"cropperRef",ref:e,resizable:i.value,onCrop:n,onLoad:r}),null,8,["resizable"])],64)}}});export{Z as default};
