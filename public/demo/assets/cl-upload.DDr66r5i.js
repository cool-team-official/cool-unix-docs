import{d as e,t,h as a,r as s,X as l,a as r,o as n,c as u,w as i,i as o,Y as c,Z as p,_ as d,l as m,m as _,u as S,p as v,n as g,e as y,S as f,x as O,F as h,A as w,f as N,g as T,G as U,aA as b,at as j,M as x,U as J}from"./index-CQm_J2yh.js";import{r as k,a as A,_ as C,c as F}from"./cl-page.uvue_vue_type_script_setup_true_lang.CluByn4i.js";import{_ as z}from"./cl-progress.Bnb_CC8y.js";import{u as B}from"./form.DjIMDBgs.js";import{a as M}from"./index.DpEWcmge.js";class V extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},item:{type:"Unknown",optional:!0},add:{type:"Unknown",optional:!0},image:{type:"Unknown",optional:!0},icon:{type:"Unknown",optional:!0},text:{type:"Unknown",optional:!0}}}}}constructor(e,t=V.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.className=this.__props__.className,this.item=this.__props__.item,this.add=this.__props__.add,this.image=this.__props__.image,this.icon=this.__props__.icon,this.text=this.__props__.text,delete this.__props__}}const $=F(e(Object.assign({name:"cl-upload"},{__name:"cl-upload",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:[Array,String],default:()=>[]},icon:{type:String,default:"camera-fill"},text:{type:String,default:()=>t("上传 / 拍摄")},sizeType:{type:[String,Array],default:()=>["original","compressed"]},sourceType:{type:Array,default:()=>["album","camera"]},height:{type:[Number,String],default:150},width:{type:[Number,String],default:150},multiple:{type:Boolean,default:!1},limit:{type:Number,default:9},disabled:{type:Boolean,default:!1},test:{type:Boolean,default:!1}},emits:["update:modelValue","change","exceed","success","error","progress"],setup(e,t){var F=t.emit;const V=e,$=F,P=B().disabled,I=a((()=>P.value||V.disabled)),E=a((()=>c(V.pt))),G=s([]),X=s(0),Y=a((()=>{const e=G.value.length;return I.value?0==e:e<(V.multiple?V.limit:1)})),Z=a((()=>new UTSJSONObject({height:p(V.height),width:p(V.width)})));function q(){return G.value.filter((e=>""!=e.url&&100==e.progress)).map((e=>e.url))}function D(){const e=function(){const e=q();return V.multiple?e:e[0]}();$("update:modelValue",e),$("change",e)}function H(e,t=null){const a=UTS.arrayFind(G.value,(t=>t.uid==e));null!=a&&(J(t,((e=null,t)=>{a[t]=e})),100==a.progress&&""!=a.url&&D())}function K(e){G.value.splice(G.value.findIndex((t=>t.uid==e)),1),D()}function L(e){if(I.value)return null;X.value=e;const t=-1==X.value?V.limit-G.value.length:1;if(t<=0)return $("exceed",G.value),null;U(new UTSJSONObject({count:t,sizeType:V.sizeType,sourceType:V.sourceType,success(e){Array.isArray(e.tempFiles)&&e.tempFiles.forEach((e=>{const t=function(e){const t=-1==X.value?x({uid:b(),preview:e,url:"",progress:0}):G.value[X.value];return-1==X.value?G.value.push(t):(t.progress=0,t.preview=e,t.url=""),t.uid}(e.path);if(V.test)return H(t,new UTSJSONObject({url:e.path,progress:100})),$("success",e.path,t),null;M(e,{onProgressUpdate:e=>{var a=e.progress;H(t,new UTSJSONObject({progress:a})),$("progress",a)}}).then((e=>{H(t,new UTSJSONObject({url:e,progress:100})),$("success",e,t)})).catch(((e=null)=>{$("error",e),K(t)}))}))},fail(e){console.error(e),$("error",e.errMsg)}}))}return l(a((()=>V.modelValue)),(e=>{if(q().join(",")!=(Array.isArray(e)?e.join(","):e)){const t=Array.isArray(e)?e:[e];G.value=t.filter((e=>""!=e)).map((e=>({uid:b(),preview:e,url:e,progress:100})))}}),{immediate:!0}),(t=null,a=null)=>{const s=j,l=k(r("cl-icon"),A),c=k(r("cl-progress"),z),p=d,U=k(r("cl-text"),C);return n(),u(p,new UTSJSONObject({class:o(["cl-upload-list",[new UTSJSONObject({}),E.value.className]])}),{default:i((()=>{var t;return[(n(!0),m(h,null,_(G.value,((e,t)=>{var a;return n(),u(p,{key:e.uid,class:o(["cl-upload",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":S(v),"is-disabled":I.value}),null===(a=E.value.item)||void 0===a?null:a.className]]),style:g(Z.value),onClick:(e=null)=>L(t)},{default:i((()=>{var t;return[y(s,{class:o(["cl-upload__image",[new UTSJSONObject({}),new UTSJSONObject({"is-uploading":e.progress<100}),null===(t=E.value.image)||void 0===t?null:t.className]]),src:e.preview,mode:"aspectFill"},null,8,["class","src"]),I.value?O("",!0):(n(),u(l,new UTSJSONObject({key:0,name:"close-line",color:"white",pt:new UTSJSONObject({className:"cl-upload__close"}),onClick:f(((t=null)=>K(e.uid)),["stop"])}),null,8,["onClick"])),e.progress<100?(n(),u(p,new UTSJSONObject({key:1,class:"cl-upload__progress"}),new UTSJSONObject({default:i((()=>[y(c,new UTSJSONObject({value:e.progress,"show-text":!1}),null,8,["value"])])),_:2}),1024)):O("",!0)]})),_:2},1032,["class","style","onClick"])})),128)),Y.value?(n(),u(p,{key:0,class:o(["cl-upload is-add",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":S(v),"is-disabled":I.value}),null===(t=E.value.add)||void 0===t?null:t.className]]),style:g(Z.value),onClick:a[0]||(a[0]=(e=null)=>L(-1))},{default:i((()=>{var t,a;return[y(l,{name:e.icon,pt:{className:S(w)([[S(v),"-important-text-white","-important-text-surface-400"],null===(t=E.value.icon)||void 0===t?null:t.className])},size:50},null,8,["name","pt"]),y(U,{pt:{className:S(w)([[S(v),"-important-text-white","-important-text-surface-500"],"-important-text-xs mt-1 text-center",null===(a=E.value.text)||void 0===a?null:a.className])}},{default:i((()=>[N(T(e.text),1)])),_:1},8,["pt"])]})),_:1},8,["class","style"])):O("",!0)]})),_:1},8,["class"])}}})),[["__scopeId","data-v-be9be922"]]);export{$ as _};
