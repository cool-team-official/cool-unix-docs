import{G as e,az as t,k as a,J as n,K as s,aA as o,aB as r,s as l}from"./index-ByJ7THPZ.js";function c(e){let t=e.lastIndexOf("/");return t=t>-1?t:e.lastIndexOf("\\"),t<0?e:e.substring(t+1)}function i(t){return e(this,void 0,void 0,(function*(){return u({path:t,size:0,name:"",type:"image/png"})}))}function u(i,u=null){return e(this,void 0,void 0,(function*(){const d=l().user,p=yield function(){return e(this,void 0,void 0,(function*(){const e=yield n.base.comm.uploadMode({});return s(e)}))}(),f=p.mode,m=p.type,g="local"==f,b="cloud"==f,y=i.path;let h=i.name;""!=h&&null!=h||(h=c(y));let v=function(e){let t=e.lastIndexOf(".");return t<0?"":e.substring(t+1)}(h);""==v&&(v="png");let k="".concat((x=h,c(x.substring(0,x.lastIndexOf(".")))),"_").concat(t(),".").concat(v);var x;return b&&(k="app/".concat(Date.now(),"/").concat(k)),new Promise(((e,t)=>{function l(a){var n=a.url,s=a.preview,l=a.data;const c=o({url:n,filePath:y,name:"file",header:{Authorization:g?d.token:null},formData:Object.assign(Object.assign({},l),{key:k}),success(a){if(g){const n=r(a.data),s=n.code,o=n.data,l=n.message;1e3==s?e(o):t(l)}else e(function(...e){return e.map((e=>e.replace(/(^\/+|\/+$)/g,""))).join("/")}(null!=s?s:n,k))},fail(e){console.error(e),t(e)}});null!=(null==u?void 0:u.onTask)&&u.onTask({abort:()=>{c.abort()}}),null!=(null==u?void 0:u.onProgressUpdate)&&c.onProgressUpdate((e=>{const t=e.progress,a=e.totalBytesSent,n=e.totalBytesExpectedToSend;u.onProgressUpdate({progress:t,totalBytesSent:a,totalBytesExpectedToSend:n})}))}if(g)l({url:a.baseUrl+"/app/base/comm/upload",data:{}});else{const e={};"aws"==m&&(e.key=k),n.base.comm.upload(e).then((e=>{const t=s(e);switch(m){case"cos":l({url:t.url,data:t.credentials});break;case"oss":l({url:t.host,data:{OSSAccessKeyId:t.OSSAccessKeyId,policy:t.policy,signature:t.signature}});break;case"qiniu":l({url:t.uploadUrl,preview:t.publicDomain,data:{token:t.token}});break;case"aws":l({url:t.url,data:t.fields})}})).catch(t)}}))}))}export{u as a,i as u};
