import{H as e,aA as t,k as a,I as n,O as o,aB as s,aC as r,s as l}from"./index-CQm_J2yh.js";function c(e){let t=e.lastIndexOf("/");return t=t>-1?t:e.lastIndexOf("\\"),t<0?e:e.substring(t+1)}function u(e){const t=new URLSearchParams(window.location.search).get(e);return null!==t?decodeURIComponent(t):null}function i(t){return e(this,void 0,void 0,(function*(){return d({path:t,size:0,name:"",type:"image/png"})}))}function d(u,i=null){return e(this,void 0,void 0,(function*(){const d=l().user,p=yield function(){return e(this,void 0,void 0,(function*(){const e=yield n({url:"/app/base/comm/uploadMode"});return o(e)}))}(),f=p.mode,m=p.type,g="local"==f,b="cloud"==f,h=u.path;let y=u.name;""!=y&&null!=y||(y=c(h));let v=function(e){let t=e.lastIndexOf(".");return t<0?"":e.substring(t+1)}(y);""==v&&(v="png");let k="".concat((w=y,c(w.substring(0,w.lastIndexOf(".")))),"_").concat(t(),".").concat(v);var w;return b&&(k="app/".concat(Date.now(),"/").concat(k)),new Promise(((e,t)=>{function l(a){var n=a.url,o=a.preview,l=a.data;const c=s({url:n,filePath:h,name:"file",header:{Authorization:g?d.token:null},formData:Object.assign(Object.assign({},l),{key:k}),success(a){if(g){const n=r(a.data),o=n.code,s=n.data,l=n.message;1e3==o?e(s):t(l)}else e(function(...e){return e.map((e=>e.replace(/(^\/+|\/+$)/g,""))).join("/")}(null!=o?o:n,k))},fail(e){console.error(e),t(e)}});null!=(null==i?void 0:i.onTask)&&i.onTask({abort:()=>{c.abort()}}),null!=(null==i?void 0:i.onProgressUpdate)&&c.onProgressUpdate((e=>{const t=e.progress,a=e.totalBytesSent,n=e.totalBytesExpectedToSend;i.onProgressUpdate({progress:t,totalBytesSent:a,totalBytesExpectedToSend:n})}))}if(g)l({url:a.baseUrl+"/app/base/comm/upload",data:{}});else{const e={};"aws"==m&&(e.key=k),n({url:"/app/base/comm/upload",method:"POST",data:e}).then((e=>{const t=o(e);switch(m){case"cos":l({url:t.url,data:t.credentials});break;case"oss":l({url:t.host,data:{OSSAccessKeyId:t.OSSAccessKeyId,policy:t.policy,signature:t.signature}});break;case"qiniu":l({url:t.uploadUrl,preview:t.publicDomain,data:{token:t.token}});break;case"aws":l({url:t.url,data:t.fields})}})).catch(t)}}))}))}export{d as a,u as g,i as u};
