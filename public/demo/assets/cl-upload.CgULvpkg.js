import{d as e,t,h as a,r as s,U as l,a as r,o as n,c as u,w as i,i as o,V as c,W as p,_ as d,l as m,m as _,u as v,p as S,n as g,e as y,P as f,v as O,F as h,z as w,f as N,g as T,E as U,av as b,an as j,H as x,R as J}from"./index-C9No-3tr.js";import{r as k,a as A,_ as z,c as C}from"./cl-page.uvue_vue_type_script_setup_true_lang.BYryoqR_.js";import{_ as F}from"./cl-progress.C4ky6fHz.js";import{u as V}from"./form.D4AfNkl8.js";import{a as $}from"./index.9yrHHMvJ.js";class B extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},item:{type:"Unknown",optional:!0},add:{type:"Unknown",optional:!0},image:{type:"Unknown",optional:!0},icon:{type:"Unknown",optional:!0},text:{type:"Unknown",optional:!0}}}}}constructor(e,t=B.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.className=this.__props__.className,this.item=this.__props__.item,this.add=this.__props__.add,this.image=this.__props__.image,this.icon=this.__props__.icon,this.text=this.__props__.text,delete this.__props__}}const M=C(e(Object.assign({name:"cl-upload"},{__name:"cl-upload",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:[Array,String],default:()=>[]},icon:{type:String,default:"camera-fill"},text:{type:String,default:()=>t("上传 / 拍摄")},sizeType:{type:[String,Array],default:()=>["original","compressed"]},sourceType:{type:Array,default:()=>["album","camera"]},height:{type:[Number,String],default:150},width:{type:[Number,String],default:150},multiple:{type:Boolean,default:!1},limit:{type:Number,default:9},disabled:{type:Boolean,default:!1},test:{type:Boolean,default:!1}},emits:["update:modelValue","change","exceed","success","error","progress"],setup(e,t){var C=t.emit;const B=e,M=C,P=V().disabled,E=a((()=>P.value||B.disabled)),I=a((()=>c(B.pt))),H=s([]),R=s(0),W=a((()=>{const e=H.value.length;return E.value?0==e:e<(B.multiple?B.limit:1)})),q=a((()=>new UTSJSONObject({height:p(B.height),width:p(B.width)})));function D(){return H.value.filter((e=>""!=e.url&&100==e.progress)).map((e=>e.url))}function G(){const e=function(){const e=D();return B.multiple?e:e[0]}();M("update:modelValue",e),M("change",e)}function K(e,t=null){const a=UTS.arrayFind(H.value,(t=>t.uid==e));null!=a&&(J(t,((e=null,t)=>{a[t]=e})),100==a.progress&&""!=a.url&&G())}function L(e){H.value.splice(H.value.findIndex((t=>t.uid==e)),1),G()}function Q(e){if(E.value)return null;R.value=e;const t=-1==R.value?B.limit-H.value.length:1;if(t<=0)return M("exceed",H.value),null;U(new UTSJSONObject({count:t,sizeType:B.sizeType,sourceType:B.sourceType,success(e){Array.isArray(e.tempFiles)&&e.tempFiles.forEach((e=>{const t=function(e){const t=-1==R.value?x({uid:b(),preview:e,url:"",progress:0}):H.value[R.value];return-1==R.value?H.value.push(t):(t.progress=0,t.preview=e,t.url=""),t.uid}(e.path);if(B.test)return K(t,new UTSJSONObject({url:e.path,progress:100})),M("success",e.path,t),null;$(e,{onProgressUpdate:e=>{var a=e.progress;K(t,new UTSJSONObject({progress:a})),M("progress",a)}}).then((e=>{K(t,new UTSJSONObject({url:e,progress:100})),M("success",e,t)})).catch(((e=null)=>{M("error",e),L(t)}))}))},fail(e){console.error(e),M("error",e.errMsg)}}))}return l(a((()=>B.modelValue)),(e=>{if(D().join(",")!=(Array.isArray(e)?e.join(","):e)){const t=Array.isArray(e)?e:[e];H.value=t.filter((e=>""!=e)).map((e=>({uid:b(),preview:e,url:e,progress:100})))}}),{immediate:!0}),(t=null,a=null)=>{const s=j,l=k(r("cl-icon"),A),c=k(r("cl-progress"),F),p=d,U=k(r("cl-text"),z);return n(),u(p,new UTSJSONObject({class:o(["cl-upload-list",[new UTSJSONObject({}),I.value.className]])}),{default:i((()=>{var t;return[(n(!0),m(h,null,_(H.value,((e,t)=>{var a;return n(),u(p,{key:e.uid,class:o(["cl-upload",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":v(S),"is-disabled":E.value}),null===(a=I.value.item)||void 0===a?null:a.className]]),style:g(q.value),onClick:(e=null)=>Q(t)},{default:i((()=>{var t;return[y(s,{class:o(["cl-upload__image",[new UTSJSONObject({}),new UTSJSONObject({"is-uploading":e.progress<100}),null===(t=I.value.image)||void 0===t?null:t.className]]),src:e.preview,mode:"aspectFill"},null,8,["class","src"]),E.value?O("",!0):(n(),u(l,new UTSJSONObject({key:0,name:"close-line",color:"white",pt:new UTSJSONObject({className:"cl-upload__close"}),onClick:f(((t=null)=>L(e.uid)),["stop"])}),null,8,["onClick"])),e.progress<100?(n(),u(p,new UTSJSONObject({key:1,class:"cl-upload__progress"}),new UTSJSONObject({default:i((()=>[y(c,new UTSJSONObject({value:e.progress,"show-text":!1}),null,8,["value"])])),_:2}),1024)):O("",!0)]})),_:2},1032,["class","style","onClick"])})),128)),W.value?(n(),u(p,{key:0,class:o(["cl-upload is-add",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":v(S),"is-disabled":E.value}),null===(t=I.value.add)||void 0===t?null:t.className]]),style:g(q.value),onClick:a[0]||(a[0]=(e=null)=>Q(-1))},{default:i((()=>{var t,a;return[y(l,{name:e.icon,pt:{className:v(w)([[v(S),"-important-text-white","-important-text-surface-400"],null===(t=I.value.icon)||void 0===t?null:t.className])},size:50},null,8,["name","pt"]),y(U,{pt:{className:v(w)([[v(S),"-important-text-white","-important-text-surface-500"],"-important-text-xs mt-1 text-center",null===(a=I.value.text)||void 0===a?null:a.className])}},{default:i((()=>[N(T(e.text),1)])),_:1},8,["pt"])]})),_:1},8,["class","style"])):O("",!0)]})),_:1},8,["class"])}}})),[["__scopeId","data-v-be9be922"]]);export{M as _};
