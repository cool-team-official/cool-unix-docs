import{d as e,a0 as t,h as l,aO as a,aw as n,r as s,a1 as i,U as o,o as r,c as u,w as c,i as p,V as d,aJ as h,_,e as f,n as m,P as S,G as g,X as b,aK as T,a7 as y,a as v,u as w,t as U,f as O,g as N,an as j}from"./index-B_3GhiAr.js";import{g as x}from"./device.CgktOcKD.js";import{c as k}from"./file.3opINcTe.js";import{o as J,r as $,d as W,b as C}from"./cl-page.uvue_vue_type_script_setup_true_lang.BiE4Gfav.js";import{_ as M}from"./cl-list-item.DcwSdRKI.js";import{_ as P}from"./cl-switch.rmxmWJsv.js";import{_ as V}from"./cl-list.BU2at37k.js";import"./cl-collapse.CtNRggjy.js";import"./form.C1qv6o9s.js";import"./index.U6ITPUe7.js";class B extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{x:{type:Number,optional:!1},y:{type:Number,optional:!1},time:{type:Number,optional:!1}}}}}constructor(e,t=B.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.x=this.__props__.x,this.y=this.__props__.y,this.time=this.__props__.time,delete this.__props__}}class R extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{left:{type:Number,optional:!1},top:{type:Number,optional:!1}}}}}constructor(e,t=R.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.left=this.__props__.left,this.top=this.__props__.top,delete this.__props__}}class D extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0}}}}}constructor(e,t=D.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.className=this.__props__.className,delete this.__props__}}const q=e(Object.assign({name:"cl-sign"},{__name:"cl-sign",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},width:{type:Number,default:300},height:{type:Number,default:200},strokeColor:{type:String,default:"#000000"},strokeWidth:{type:Number,default:3},backgroundColor:{type:String,default:"#ffffff"},enableBrush:{type:Boolean,default:!0},minStrokeWidth:{type:Number,default:1},maxStrokeWidth:{type:Number,default:6},velocitySensitivity:{type:Number,default:.7}},emits:["change","clear"],setup(e,y){var v=y.expose,w=y.emit;const U=e,O=w,N=t().proxy,j=x(),J=l((()=>d(U.pt))),$=a(null);let W=null;const C="cl-sign__".concat(n()),M=s(!1);let P=null,V=s(3);const R=[];function D(e){const t=e.touches[0],l=e.target.getBoundingClientRect();return new B({x:t.clientX-l.left,y:t.clientY-l.top,time:Date.now()})}function q(e){return g(this,void 0,void 0,(function*(){e.preventDefault(),M.value=!0,P=D(e),V.value=U.enableBrush?U.maxStrokeWidth:U.strokeWidth,R.length=0}))}function X(e){if(e.preventDefault(),!M.value||null==P||null==W)return null;const t=D(e),l=function(e){if(null==P||!U.enableBrush)return U.strokeWidth;const t=Math.sqrt(Math.pow(e.x-P.x,2)+Math.pow(e.y-P.y,2)),l=e.time-P.time;if(l<=0)return V.value;const a=t/l;R.push(a),R.length>5&&UTS.arrayShift(R);const n=R.reduce(((e,t)=>e+t),0)/R.length,s=Math.min(n*U.velocitySensitivity,1),i=U.maxStrokeWidth-U.minStrokeWidth,o=U.maxStrokeWidth-s*i;return V.value+.3*(o-V.value)}(t);V.value=l,W.beginPath(),W.moveTo(P.x*j,P.y*j),W.lineTo(t.x*j,t.y*j),W.strokeStyle=U.strokeColor,W.lineWidth=l*j,W.lineCap="round",W.lineJoin="round",W.stroke(),P=t,O("change")}function A(e){e.preventDefault(),M.value=!1,P=null}function G(){if(null==W)return null;W.clearRect(0,0,U.width*j,U.height*j),W.fillStyle=U.backgroundColor,W.fillRect(0,0,U.width*j,U.height*j),O("clear")}function H(){h({id:C,component:N,success:e=>{W=e.getContext("2d"),W.canvas.width=U.width*j,W.canvas.height=U.height*j,W.textBaseline="middle",W.textAlign="center",W.miterLimit=10,G()}})}return i((()=>{H(),o(l((()=>[U.width,U.height])),(()=>{b((()=>{H()}))}))})),v(new UTSJSONObject({clear:G,toPng:function(){return k($.value)}})),(t=null,l=null)=>{const a=T,n=_;return r(),u(n,new UTSJSONObject({class:p(["cl-sign",[new UTSJSONObject({}),J.value.className]])}),new UTSJSONObject({default:c((()=>[f(a,new UTSJSONObject({class:"cl-sign__canvas",ref_key:"canvasRef",ref:$,id:C,style:m({height:"".concat(e.height,"px"),width:"".concat(e.width,"px")}),onTouchstart:q,onTouchmove:S(X,["stop","prevent"]),onTouchend:A}),null,8,["style"])])),_:1}),8,["class"])}}})),X=e({__name:"sign",setup(e){const t=s(200),l=s(0),a=s(!1),n=s(!0),i=s(null);function o(){i.value.clear()}function p(){i.value.toPng().then((e=>{j({urls:[e]})}))}function d(){t.value=a.value?y().windowHeight-200:200}return J((()=>{l.value=y().windowWidth})),(e=null,s=null)=>{const h=$(v("cl-sign"),q),m=$(v("cl-button"),W),S=$(v("cl-list-item"),M),g=$(v("cl-switch"),P),b=$(v("cl-list"),V),T=_,y=$(v("cl-page"),C);return r(),u(y,null,new UTSJSONObject({default:c((()=>[f(h,new UTSJSONObject({ref_key:"signRef",ref:i,height:t.value,width:l.value,"enable-brush":n.value}),null,8,["height","width","enable-brush"]),f(T,new UTSJSONObject({class:"p-3"}),{default:c((()=>[f(b,null,{default:c((()=>[f(S,new UTSJSONObject({label:w(U)("操作")}),{default:c((()=>[f(m,new UTSJSONObject({type:"info",onClick:o}),{default:c((()=>[O(N(w(U)("清空")),1)])),_:1}),f(m,new UTSJSONObject({onClick:p}),{default:c((()=>[O(N(w(U)("预览")),1)])),_:1})])),_:1},8,["label"]),f(S,new UTSJSONObject({label:w(U)("设置高度")}),{default:c((()=>[f(g,new UTSJSONObject({modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=(e=null)=>a.value=e),onChange:d}),null,8,["modelValue"])])),_:1},8,["label"]),f(S,new UTSJSONObject({label:w(U)("毛笔效果")}),{default:c((()=>[f(g,new UTSJSONObject({modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=(e=null)=>n.value=e)}),null,8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1})])),_:1}))}}});export{X as default};
