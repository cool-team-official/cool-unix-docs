import{d as e,t,c as a,z as s,T as l,r,o as n,a as u,w as i,n as o,W as c,a2 as p,_ as d,j as m,k as _,u as S,e as v,X as g,b as y,O as f,q as O,F as h,x as w,f as T,g as N,D as b,as as U,aq as j,G as x,Q as J}from"./index-CaoFoJS7.js";import{r as k,_ as A,a as z,c as C}from"./cl-page.uvue_vue_type_script_setup_true_lang.BVJ1wxp1.js";import{_ as F}from"./cl-progress.Bkm0qfF2.js";import{a as B}from"./index.Bjaf2oXy.js";import{u as V}from"./form.B8y9r7Ff.js";class $ extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},item:{type:"Unknown",optional:!0},add:{type:"Unknown",optional:!0},image:{type:"Unknown",optional:!0},icon:{type:"Unknown",optional:!0},text:{type:"Unknown",optional:!0}}}}}constructor(e,t=$.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.className=this.__props__.className,this.item=this.__props__.item,this.add=this.__props__.add,this.image=this.__props__.image,this.icon=this.__props__.icon,this.text=this.__props__.text,delete this.__props__}}const M=C(e(Object.assign({name:"cl-upload"},{__name:"cl-upload",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:[Array,String],default:()=>[]},icon:{type:String,default:"camera-fill"},text:{type:String,default:()=>t("上传/拍摄")},sizeType:{type:[String,Array],default:()=>["original","compressed"]},sourceType:{type:Array,default:()=>["album","camera"]},height:{type:[Number,String],default:150},width:{type:[Number,String],default:150},multiple:{type:Boolean,default:!1},limit:{type:Number,default:9},disabled:{type:Boolean,default:!1},test:{type:Boolean,default:!1}},emits:["update:modelValue","change","exceed","success","error","progress"],setup(e,t){var C=t.emit;const $=e,M=C,q=V().disabled,I=a((()=>q.value||$.disabled)),P=a((()=>c($.pt))),D=s([]),E=s(0),G=a((()=>{const e=D.value.length;return I.value?0==e:e<($.multiple?$.limit:1)})),Q=a((()=>new UTSJSONObject({height:p($.height),width:p($.width)})));function W(){return D.value.filter((e=>""!=e.url&&100==e.progress)).map((e=>e.url))}function X(){const e=function(){const e=W();return $.multiple?e:e[0]}();M("update:modelValue",e),M("change",e)}function H(e,t=null){const a=UTS.arrayFind(D.value,(t=>t.uid==e));null!=a&&(J(t,((e=null,t)=>{a[t]=e})),100==a.progress&&""!=a.url&&X())}function K(e){D.value.splice(D.value.findIndex((t=>t.uid==e)),1),X()}function L(e){if(I.value)return null;E.value=e;const t=-1==E.value?$.limit-D.value.length:1;if(t<=0)return M("exceed",D.value),null;b(new UTSJSONObject({count:t,sizeType:$.sizeType,sourceType:$.sourceType,success(e){Array.isArray(e.tempFiles)&&e.tempFiles.forEach((e=>{const t=function(e){const t=-1==E.value?x({uid:U(),preview:e,url:"",progress:0}):D.value[E.value];return-1==E.value?D.value.push(t):(t.progress=0,t.preview=e,t.url=""),t.uid}(e.path);if($.test)return H(t,new UTSJSONObject({url:e.path,progress:100})),M("success",e.path,t),null;B(e,{onProgressUpdate:e=>{var a=e.progress;H(t,new UTSJSONObject({progress:a})),M("progress",a)}}).then((e=>{H(t,new UTSJSONObject({url:e,progress:100})),M("success",e,t)})).catch(((e=null)=>{M("error",e),K(t)}))}))},fail(e){console.error(e),M("error",e.errMsg)}}))}return l(a((()=>$.modelValue)),(e=>{if(W().join(",")!=(Array.isArray(e)?e.join(","):e)){const t=Array.isArray(e)?e:[e];D.value=t.filter((e=>""!=e)).map((e=>({uid:U(),preview:e,url:e,progress:100})))}}),{immediate:!0}),(t=null,a=null)=>{const s=j,l=k(r("cl-icon"),A),c=k(r("cl-progress"),F),p=d,b=k(r("cl-text"),z);return n(),u(p,new UTSJSONObject({class:o(["cl-upload-list",[new UTSJSONObject({}),P.value.className]])}),{default:i((()=>{var t;return[(n(!0),m(h,null,_(D.value,((e,t)=>{var a;return n(),u(p,{key:e.uid,class:o(["cl-upload",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":S(v),"is-disabled":I.value}),null===(a=P.value.item)||void 0===a?null:a.className]]),style:g(Q.value),onClick:(e=null)=>L(t)},{default:i((()=>{var t;return[y(s,{class:o(["cl-upload__image",[new UTSJSONObject({}),new UTSJSONObject({"is-uploading":e.progress<100}),null===(t=P.value.image)||void 0===t?null:t.className]]),src:e.preview,mode:"aspectFill"},null,8,["class","src"]),I.value?O("",!0):(n(),u(l,new UTSJSONObject({key:0,name:"close-line",color:"white",pt:new UTSJSONObject({className:"cl-upload__close"}),onClick:f(((t=null)=>K(e.uid)),["stop"])}),null,8,["onClick"])),e.progress<100?(n(),u(p,new UTSJSONObject({key:1,class:"cl-upload__progress"}),new UTSJSONObject({default:i((()=>[y(c,new UTSJSONObject({value:e.progress,"show-text":!1}),null,8,["value"])])),_:2}),1024)):O("",!0)]})),_:2},1032,["class","style","onClick"])})),128)),G.value?(n(),u(p,{key:0,class:o(["cl-upload",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":S(v),"is-disabled":I.value}),null===(t=P.value.add)||void 0===t?null:t.className]]),style:g(Q.value),onClick:a[0]||(a[0]=(e=null)=>L(-1))},{default:i((()=>{var t,a;return[y(l,{name:e.icon,pt:{className:S(w)([[S(v),"-important-text-white","-important-text-surface-400"],null===(t=P.value.icon)||void 0===t?null:t.className])},size:50},null,8,["name","pt"]),y(b,{pt:{className:S(w)([[S(v),"-important-text-white","-important-text-surface-500"],"-important-text-xs mt-1 text-center",null===(a=P.value.text)||void 0===a?null:a.className])}},{default:i((()=>[T(N(e.text),1)])),_:1},8,["pt"])]})),_:1},8,["class","style"])):O("",!0)]})),_:1},8,["class"])}}})),[["__scopeId","data-v-4eb52e69"]]);export{M as _};
