import{r as e,_ as l,c as t,m as a}from"./cl-page.uvue_vue_type_script_setup_true_lang.CluByn4i.js";import{d as r,h as n,X as s,a4 as u,aH as o,a as i,o as c,c as d,w as p,i as m,Y as v,_ as f,e as S,n as b,f as O,g as w,x as g,N as T,u as _,A as y,av as N,a3 as U,r as j,H as h,a0 as J,a5 as x,am as A,a7 as M,aI as k,t as E,$ as P,aJ as $}from"./index-CQm_J2yh.js";import{u as q}from"./form.DjIMDBgs.js";UTS.UTSType;const B=t(r(Object.assign({name:"cl-form-item"},{__name:"cl-form-item",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},label:{type:String,default:""},prop:{type:String,default:""},rules:{type:Array,default:()=>[]},labelPosition:{type:String,default:null},labelWidth:{type:String,default:null},showAsterisk:{type:Boolean,default:null},showMessage:{type:Boolean,default:null},required:{type:Boolean,default:!1}},setup(t,a){var r=a.expose;const U=t,j=q(),h=j.formRef,J=j.getError,x=j.getValue,A=j.validateField,M=j.addField,k=j.removeField,E=j.setRule,P=n((()=>v(U.pt))),$=n((()=>J(U.prop))),B=n((()=>""!=$.value)),F=n((()=>{var e,l,t;return null!==(t=null!==(e=U.labelPosition)&&void 0!==e?e:null===(l=h.value)||void 0===l?null:l.labelPosition)&&void 0!==t?t:"left"})),R=n((()=>{var e,l,t;return null!==(t=null!==(e=U.labelWidth)&&void 0!==e?e:null===(l=h.value)||void 0===l?null:l.labelWidth)&&void 0!==t?t:"120rpx"})),W=n((()=>{var e,l,t;return!!U.required&&(null===(t=null!==(e=U.showAsterisk)&&void 0!==e?e:null===(l=h.value)||void 0===l?null:l.showAsterisk)||void 0===t||t)})),V=n((()=>{var e,l,t;return!!U.required&&(null===(t=null!==(e=U.showMessage)&&void 0!==e?e:null===(l=h.value)||void 0===l?null:l.showMessage)||void 0===t||t)}));return s(n((()=>U.required)),(e=>{e?M(U.prop,U.rules):k(U.prop)}),{immediate:!0}),u((()=>{s(n((()=>{const e=x(U.prop);return null==e?"":e})),((e=null,l=null)=>{U.required&&(N(e,l)||A(U.prop))}),{deep:!0}),s(n((()=>U.rules)),(e=>{E(U.prop,e)}),{deep:!0})})),o((()=>{k(U.prop)})),r(new UTSJSONObject({prop:U.prop})),(a=null,r=null)=>{const n=e(i("cl-text"),l),s=f;return c(),d(s,new UTSJSONObject({class:m(["cl-form-item",[new UTSJSONObject({}),new UTSJSONObject({"cl-form-item--error":B.value}),P.value.className]]),id:"cl-form-item-".concat(t.prop)}),{default:p((()=>{var e;return[S(s,{class:m(["cl-form-item__inner",[new UTSJSONObject({}),"is-".concat(F.value),null===(e=P.value.inner)||void 0===e?null:e.className]])},{default:p((()=>{var e,l;return[""!=t.label?(c(),d(s,{key:0,class:m(["cl-form-item__label",[new UTSJSONObject({}),"is-".concat(F.value),null===(e=P.value.label)||void 0===e?null:e.className]]),style:b({width:"top"!=F.value?R.value:"auto"})},new UTSJSONObject({default:p((()=>[S(n,null,{default:p((()=>[O(w(t.label),1)])),_:1}),W.value?(c(),d(n,new UTSJSONObject({key:0,color:"error",pt:new UTSJSONObject({className:"ml-1"})}),new UTSJSONObject({default:p((()=>[O(" * ")])),_:1}))):g("",!0)])),_:1}),8,["class","style"])):g("",!0),S(s,{class:m(["cl-form-item__content",[new UTSJSONObject({}),null===(l=P.value.content)||void 0===l?null:l.className]])},{default:p((()=>[T(a.$slots,"default",new UTSJSONObject({}),void 0,!0)])),_:3},8,["class"])]})),_:3},8,["class"]),B.value&&V.value?(c(),d(s,new UTSJSONObject({key:0,class:"cl-form-item__error"}),{default:p((()=>[T(a.$slots,"error",new UTSJSONObject({error:$.value}),(()=>{var e;return[S(n,{color:"error",pt:{className:_(y)(["mt-2 -important-text-sm",null===(e=P.value.error)||void 0===e?null:e.className])}},{default:p((()=>[O(w($.value),1)])),_:1},8,["pt"])]}),!0)])),_:3})):g("",!0)]})),_:3},8,["class","id"])}}})),[["__scopeId","data-v-0a3daede"]]);class F extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0}}}}}constructor(e,l=F.get$UTSMetadata$(),t=!1){super(),this.__props__=UTS.UTSType.initProps(e,l,t),this.className=this.__props__.className,delete this.__props__}}const R=t(r(Object.assign({name:"cl-form"},{__name:"cl-form",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:Object,default:()=>new UTSJSONObject({})},rules:{type:Object,default:()=>new Map},labelPosition:{type:String,default:"top"},labelWidth:{type:String,default:"140rpx"},showAsterisk:{type:Boolean,default:!0},showMessage:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},scrollToError:{type:Boolean,default:!0}},setup(e,l){var t=l.expose;const r=e,u=U().proxy,o=a(),i=n((()=>v(r.pt))),S=j(new UTSJSONObject({})),b=j(new Map),O=j(new Set([])),w=n((()=>r.labelPosition)),g=n((()=>r.labelWidth)),_=n((()=>r.showAsterisk)),y=n((()=>r.showMessage)),N=n((()=>r.disabled)),q=j(!1);function B(e,l){if(q.value)return null;""!=e&&b.value.set(e,l)}function F(e){""!=e&&b.value.delete(e)}function R(e){var l;return""!=e&&null!==(l=b.value.get(e))&&void 0!==l?l:""}function W(){return h(this,void 0,void 0,(function*(){return new Promise((e=>{const l=[],t=new Map;function a(){var a;t.forEach(((e,t)=>{l.push({field:t,message:R(t)})})),r.scrollToError&&l.length>0&&o.scrollTo((null!==(a=UTS.mapGet(t,l[0].field))&&void 0!==a?a:0)+o.getScrollTop()),e(l)}if(0==b.value.size)return a(),null;J((()=>{let e=u;x().in(e).selectAll(".cl-form-item--error").boundingClientRect(((e=null)=>{e.map((e=>{var l,a;t.set((null!==(l=e.id)&&void 0!==l?l:"").replace("cl-form-item-",""),null!==(a=e.top)&&void 0!==a?a:0)})),a()})).exec()}))}))}))}function V(){b.value.clear()}function I(e){return""!=e?A(S.value,e,null):null}function G(e){var l;return null!==(l=UTS.mapGet(r.rules,e))&&void 0!==l?l:[]}function H(e,l){""==e||M(l)||r.rules.set(e,l)}function z(e){""!=e&&r.rules.delete(e)}function C(e=null,l){var t,a,r,n,s,u,o;if(1==l.required&&(null==e||""==e&&k(e)||Array.isArray(e)&&0==e.length))return null!==(t=l.message)&&void 0!==t?t:E("此字段为必填项");if((null==e||""==e&&k(e))&&1!=l.required)return null;if(null!=l.min)if("number"==typeof e){if(e<l.min)return null!==(a=l.message)&&void 0!==a?a:P("最小值为{min}",new UTSJSONObject({min:l.min}))}else{if((Array.isArray(e)?e.length:"".concat(e).length)<l.min)return null!==(r=l.message)&&void 0!==r?r:P("最少需要{min}个字符",new UTSJSONObject({min:l.min}))}if(null!=l.max)if("number"==typeof e){if(e>l.max)return null!==(n=l.message)&&void 0!==n?n:P("最大值为{max}",new UTSJSONObject({max:l.max}))}else{if((Array.isArray(e)?e.length:"".concat(e).length)>l.max)return null!==(s=l.message)&&void 0!==s?s:P("最多允许{max}个字符",new UTSJSONObject({max:l.max}))}if(null!=l.pattern&&!l.pattern.test("".concat(e)))return null!==(u=l.message)&&void 0!==u?u:E("格式不正确");if(null!=l.validator){const t=l.validator(e);if(1!=t)return"string"==typeof t?t:null!==(o=l.message)&&void 0!==o?o:E("验证失败")}return null}function X(e){let l=null;if(""!=e){const t=I(e),a=G(e);M(a)||UTS.arrayFind(a,(e=>{const a=C(t,e);return null!=a&&(l=a,!0)})),F(e)}return null!=l&&B(e,l),l}return s(n((()=>$(r.modelValue))),(e=>{S.value=e}),{immediate:!0,deep:!0}),t(new UTSJSONObject({labelPosition:w,labelWidth:g,showAsterisk:_,showMessage:y,disabled:N,data:S,errors:b,fields:O,addField:function(e,l){""!=e&&(O.value.add(e),H(e,l))},removeField:function(e){""!=e&&(O.value.delete(e),z(e),F(e))},getValue:I,setError:B,getError:R,getErrors:W,removeError:F,clearErrors:V,getRule:G,setRule:H,removeRule:z,validateRule:C,clearValidate:function(){q.value=!0,J((()=>{V(),q.value=!1}))},validateField:X,validate:function(e){return h(this,void 0,void 0,(function*(){O.value.forEach((e=>{X(e)}));const l=yield W();e(0==l.length,l)}))}})),(e=null,l=null)=>{const t=f;return c(),d(t,new UTSJSONObject({class:m(["cl-form",[new UTSJSONObject({}),"cl-form--label-".concat(w.value),new UTSJSONObject({"cl-form--disabled":N.value}),i.value.className]])}),new UTSJSONObject({default:p((()=>[T(e.$slots,"default",new UTSJSONObject({}),void 0,!0)])),_:3}),8,["class"])}}})),[["__scopeId","data-v-8d7b7bbe"]]);export{B as _,R as a};
