import{c as e,r as l,_ as t,b as a}from"./cl-page.uvue_vue_type_script_setup_true_lang.Dujw6vu5.js";import{d as n,a3 as u,h as s,r as o,X as r,o as c,c as i,w as d,i as b,Y as p,_ as S,l as v,m as O,n as m,N as f,F as g,H as _,aB as h,a5 as w,T,a as j,e as U,u as N,f as J,g as x,t as y,p as V,A as P}from"./index-CNagV5B9.js";import{v as $}from"./index.U6ITPUe7.js";import{_ as M}from"./cl-list-item.D9Fwhzfd.js";import{_ as k}from"./cl-list.DqrUvrrm.js";import{_ as I}from"./cl-image.ChbEKLdo.js";import{D as A}from"./item.BgF8i6G3.js";import"./cl-collapse.S3OdLei1.js";import"./item.uvue_vue_type_style_index_0_scoped_b08ace3b_lang.LX4ndQdB.js";class B extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{top:{type:Number,optional:!1},left:{type:Number,optional:!1},width:{type:Number,optional:!1},height:{type:Number,optional:!1}}}}}constructor(e,l=B.get$UTSMetadata$(),t=!1){super(),this.__props__=UTS.UTSType.initProps(e,l,t),this.top=this.__props__.top,this.left=this.__props__.left,this.width=this.__props__.width,this.height=this.__props__.height,delete this.__props__}}class D extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{x:{type:Number,optional:!1},y:{type:Number,optional:!1}}}}}constructor(e,l=D.get$UTSMetadata$(),t=!1){super(),this.__props__=UTS.UTSType.initProps(e,l,t),this.x=this.__props__.x,this.y=this.__props__.y,delete this.__props__}}class L extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},ghost:{type:"Unknown",optional:!0}}}}}constructor(e,l=L.get$UTSMetadata$(),t=!1){super(),this.__props__=UTS.UTSType.initProps(e,l,t),this.className=this.__props__.className,this.ghost=this.__props__.ghost,delete this.__props__}}const X=e(n(Object.assign({name:"cl-draggable"},{__name:"cl-draggable",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},columns:{type:Number,default:1},longPress:{type:Boolean,default:!0}},emits:["update:modelValue","change","start","end"],setup(e,l){var t=l.emit;const a=e,n=t,j=u().proxy,U=s((()=>p(a.pt))),N=o([]),J=o(!1),x=o(-1),y=o(-1),V=o(0),P=o(0),M=o(0),k=o(0),I=o(new UTSJSONObject({})),A=o([]),B=o(!1),L=o(0),X=o(0),Y=o(!1);function z(e){if(0==A.value.length)return x.value;if(a.columns>1){const e=A.value[x.value];return function(e,l){if(0==A.value.length)return x.value;let t=x.value,a=1/0;for(let n=0;n<A.value.length;n++){const u=A.value[n],s=u.left+u.width/2,o=u.top+u.height/2,r=Math.sqrt(Math.pow(e-s,2)+Math.pow(l-o,2));r<a&&(a=r,t=n)}return t}(e.left+e.width/2+k.value,e.top+e.height/2+M.value)}return function(e){let l=x.value,t=1/0;for(let a=0;a<A.value.length;a++){const n=A.value[a],u=n.top+n.height/2,s=Math.abs(e-u);s<t&&(t=s,l=a)}return l}(e)}function C(e){if(!J.value||B.value||!Y.value)return new D({x:0,y:0});const l=x.value,t=y.value;return e==l||l==t?new D({x:0,y:0}):a.columns>1?function(e,l,t){const n=a.columns,u=Math.floor(e/n),s=e%n;let o=e;l<t?e>l&&e<=t&&(o=e-1):l>t&&e>=t&&e<l&&(o=e+1);const r=Math.floor(o/n),c=o%n,i=X.value,d=L.value;return new D({x:(c-s)*i,y:(r-u)*d})}(e,l,t):function(e,l,t){if(l<t){if(e>l&&e<=t)return new D({x:0,y:-L.value})}else if(l>t&&e>=t&&e<l)return new D({x:0,y:L.value});return new D({x:0,y:0})}(e,l,t)}function F(e){const l=new UTSJSONObject({}),t=x.value==e;if(a.columns>1){const e=100/a.columns;l["flex-basis"]="".concat(e,"%"),l.width="".concat(e,"%"),l["box-sizing"]="border-box"}if(B.value)return l;if(J.value)if(t)l.transform="translate(".concat(k.value,"px, ").concat(M.value,"px)"),l["z-index"]="100";else{const t=C(e);l.transform="translate(".concat(t.x,"px, ").concat(t.y,"px)")}return l}function R(e,l,t){return _(this,void 0,void 0,(function*(){if("longpress"==t&&!a.longPress)return Promise.resolve(null);if("touch"==t&&a.longPress)return Promise.resolve(null);if(a.disabled)return Promise.resolve(null);if(function(e){return!T(N.value[e].disabled)&&N.value[e].disabled}(l))return Promise.resolve(null);if(l<0||l>=N.value.length)return Promise.resolve(null);const u=e.touches[0];J.value=!0,x.value=l,y.value=l,P.value=u.clientX,V.value=u.clientY,k.value=0,M.value=0,I.value=N.value[l],yield function(){return _(this,void 0,void 0,(function*(){return new Promise((e=>{w().in(j).select(".cl-draggable").boundingClientRect().exec((l=>{var t;const n=l[0];X.value=(null!==(t=n.width)&&void 0!==t?t:0)/a.columns,w().in(j).selectAll(".cl-draggable__item").boundingClientRect().exec((l=>{var t,a,n;const u=l[0],s=[];for(let e=0;e<u.length;e++){const l=u[e];0==e&&(L.value=null!==(t=l.height)&&void 0!==t?t:0),s.push({top:null!==(a=l.top)&&void 0!==a?a:0,left:null!==(n=l.left)&&void 0!==n?n:0,width:X.value,height:L.value})}A.value=s,e()}))}))}))}))}(),n("start",l),$(1),e.stopPropagation(),e.preventDefault()}))}function q(e){if(!J.value)return null;const l=e.touches[0];if(k.value=l.clientX-P.value,M.value=l.clientY-V.value,Y.value||function(){if(0==A.value.length)return!1;const e=x.value,l=A.value[e],t=l.left+l.width/2+k.value,n=l.top+l.height/2+M.value;if(a.columns>1)for(let a=0;a<A.value.length;a++){if(a==e)continue;const l=A.value[a];if(t>=l.left&&t<=l.left+l.width&&n>=l.top&&n<=l.top+l.height)return!0}else{if(e>0){const l=A.value[e-1];if(n<=l.top+l.height/2)return!0}if(e<A.value.length-1){const l=A.value[e+1];if(n>=l.top+l.height/2)return!0}}return!1}()&&(Y.value=!0),Y.value){const e=A.value[x.value],l=e.left+e.width/2+k.value,t=e.top+e.height/2+M.value,n=z(a.columns>1?l:t);n!=y.value&&(y.value=n)}e.preventDefault()}function H(){if(!J.value)return null;const e=x.value,l=y.value;if(e!=l&&l>=0){const t=[...N.value],a=t.splice(e,1)[0];t.splice(l,0,a),N.value=t,n("update:modelValue",N.value),n("change",N.value)}B.value=!0,J.value=!1,J.value=!1,B.value=!1,x.value=-1,y.value=-1,k.value=0,M.value=0,I.value=new UTSJSONObject({}),A.value=[],L.value=0,X.value=0,Y.value=!1,n("end",l>=0?l:e)}function K(e,l){return e.uid}return r(s((()=>a.modelValue)),(e=>{N.value=e.map((e=>{var l;return Object.assign({uid:null!==(l=e.uid)&&void 0!==l?l:h()},e)}))}),{immediate:!0}),(l=null,t=null)=>{const n=S;return c(),i(n,new UTSJSONObject({class:b(["cl-draggable",[new UTSJSONObject({"cl-draggable--columns":a.columns>1}),U.value.className]])}),new UTSJSONObject({default:d((()=>[(c(!0),v(g,null,O(N.value,((t,a)=>(c(),i(n,new UTSJSONObject({key:K(t),class:b(["cl-draggable__item",[new UTSJSONObject({}),new UTSJSONObject({"cl-draggable__item--disabled":e.disabled,"cl-draggable__item--dragging":J.value&&x.value==a,"cl-draggable__item--animating":J.value&&x.value!=a})]]),style:m(F(a)),onTouchstart:(e=null)=>{R(e,a,"touch")},onLongpress:(e=null)=>{R(e,a,"longpress")},onTouchmove:q,onTouchend:H}),new UTSJSONObject({default:d((()=>[f(l.$slots,"item",new UTSJSONObject({item:t,index:a,dragging:J.value,dragIndex:x.value,insertIndex:y.value}),void 0,!0)])),_:2}),1032,["class","style","onTouchstart","onLongpress"])))),128))])),_:3}),8,["class"])}}})),[["__scopeId","data-v-13ac175c"]]),Y=n({__name:"draggable",setup(e){const n=o([new UTSJSONObject({label:"君不见黄河之水天上来"}),new UTSJSONObject({label:"奔流到海不复回",disabled:!0}),new UTSJSONObject({label:"君不见高堂明镜悲白发"}),new UTSJSONObject({label:"朝如青丝暮成雪"}),new UTSJSONObject({label:"人生得意须尽欢"})]),u=o([new UTSJSONObject({label:"国破山河在"}),new UTSJSONObject({label:"城春草木深"}),new UTSJSONObject({label:"感时花溅泪"})]),s=o([new UTSJSONObject({label:"白日依山尽"}),new UTSJSONObject({label:"黄河入海流"}),new UTSJSONObject({label:"欲穷千里目"}),new UTSJSONObject({label:"更上一层楼"}),new UTSJSONObject({label:"一览众山小"})]),r=o([new UTSJSONObject({label:"项目1"}),new UTSJSONObject({label:"项目2"}),new UTSJSONObject({label:"项目3"}),new UTSJSONObject({label:"项目4"}),new UTSJSONObject({label:"项目5"}),new UTSJSONObject({label:"项目6"}),new UTSJSONObject({label:"项目7"}),new UTSJSONObject({label:"项目8",disabled:!0}),new UTSJSONObject({label:"项目9"}),new UTSJSONObject({label:"项目10"}),new UTSJSONObject({label:"项目11"}),new UTSJSONObject({label:"项目12"})]),p=o([new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/1.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/2.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/3.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/4.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/5.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/6.jpg"}),new UTSJSONObject({url:"https://unix.cool-js.com/images/demo/7.jpg"})]);return(e=null,o=null)=>{const v=l(j("cl-text"),t),O=S,m=l(j("cl-draggable"),X),f=l(j("cl-list-item"),M),g=l(j("cl-list"),k),_=l(j("cl-image"),I),h=l(j("cl-page"),a);return c(),i(h,null,new UTSJSONObject({default:d((()=>[U(O,new UTSJSONObject({class:"p-3"}),{default:d((()=>[U(N(A),null,{default:d((()=>[U(v,new UTSJSONObject({color:"info"}),{default:d((()=>[J(x(N(y)("长按项即可拖动排序")),1)])),_:1})])),_:1}),U(N(A),new UTSJSONObject({label:N(y)("单列排序")}),{default:d((()=>[U(m,new UTSJSONObject({modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=(e=null)=>n.value=e)}),{item:d((e=>{var l=e.item;e.index;return[U(O,new UTSJSONObject({class:b(["flex flex-row items-center p-3 bg-surface-100 rounded-lg mb-2",new UTSJSONObject({"dark-colon--important-bg-surface-700":N(V),"opacity-50":l.disabled})])}),{default:d((()=>[U(v,null,{default:d((()=>[J(x(l.label),1)])),_:2},1024)])),_:2},1032,["class"])]})),_:1},8,["modelValue"])])),_:1},8,["label"]),U(N(A),new UTSJSONObject({label:N(y)("不需要长按")}),{default:d((()=>[U(m,new UTSJSONObject({modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=(e=null)=>u.value=e),"long-press":!1}),{item:d((e=>{var l=e.item;return[U(O,new UTSJSONObject({class:b(["flex flex-row items-center p-3 bg-surface-100 rounded-lg mb-2",new UTSJSONObject({"dark-colon--important-bg-surface-700":N(V)})])}),{default:d((()=>[U(v,null,{default:d((()=>[J(x(l.label),1)])),_:2},1024)])),_:2},1032,["class"])]})),_:1},8,["modelValue"])])),_:1},8,["label"]),U(N(A),new UTSJSONObject({label:N(y)("结合列表使用")}),{default:d((()=>[U(g,new UTSJSONObject({border:""}),{default:d((()=>[U(m,new UTSJSONObject({modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=(e=null)=>s.value=e)}),{item:d((e=>{var l=e.item,t=e.index,a=e.dragging,n=e.dragIndex;return[U(f,new UTSJSONObject({icon:"chat-thread-line",label:l.label,arrow:"",pt:new UTSJSONObject({inner:new UTSJSONObject({className:N(P)([[a&&n==t,N(V)?"-important-bg-surface-700":"-important-bg-surface-100"]])})})}),null,8,["label","pt"])]})),_:1},8,["modelValue"])])),_:1})])),_:1},8,["label"]),U(N(A),new UTSJSONObject({label:N(y)("多列排序")}),{default:d((()=>[U(m,new UTSJSONObject({modelValue:r.value,"onUpdate:modelValue":o[3]||(o[3]=(e=null)=>r.value=e),columns:4}),{item:d((e=>{var l=e.item;e.index;return[U(O,new UTSJSONObject({class:b(["flex flex-row items-center justify-center p-3 bg-surface-100 rounded-lg m-1",new UTSJSONObject({"dark-colon--important-bg-surface-700":N(V),"opacity-50":l.disabled})])}),{default:d((()=>[U(v,null,{default:d((()=>[J(x(l.label),1)])),_:2},1024)])),_:2},1032,["class"])]})),_:1},8,["modelValue"])])),_:1},8,["label"]),U(N(A),new UTSJSONObject({label:N(y)("结合图片使用")}),{default:d((()=>[U(m,new UTSJSONObject({modelValue:p.value,"onUpdate:modelValue":o[4]||(o[4]=(e=null)=>p.value=e),columns:4}),{item:d((e=>{var l=e.item;e.index;return[U(O,new UTSJSONObject({class:"p--bracket-start-2px-bracket-end-"}),{default:d((()=>[U(_,new UTSJSONObject({src:l.url,mode:"widthFix",pt:new UTSJSONObject({className:"-important-w-full"}),preview:""}),null,8,["src"])])),_:2},1024)]})),_:1},8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1}))}}});export{Y as default};
