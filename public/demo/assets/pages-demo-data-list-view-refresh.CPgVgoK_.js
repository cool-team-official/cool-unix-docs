import{_ as e}from"./cl-loadmore.CNdVOmrv.js";import{r as t,G as s,aE as i,h as a,K as l,d as o,a as n,o as r,c,w as u,_ as h,e as p,f as g,g as m,i as d,u as S,p as O,t as j,v as _}from"./index-Dg8V4FTF.js";import{r as w,_ as b,o as v,u as f,b as T}from"./cl-page.uvue_vue_type_script_setup_true_lang.DRUWCFX0.js";import{a as U,_ as N}from"./cl-list-view.B7-6Xevh.js";import{_ as J}from"./cl-image.DHd0FA3Z.js";class x{constructor(e){this.page=1,this.size=20,this.total=0,this.list=t([]),this.loading=t(!1),this.refreshing=t(!1),this.finished=t(!1),this.params={},this.cb=null,this.refresh=e=>s(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{this.params=i(this.params,e);const a=Object.assign({page:this.page,size:this.size},this.params);this.loading.value=!0,this.cb(a).then((e=>{const s=l(e),i=s.list,o=s.pagination;this.page=o.page,this.size=o.size,this.total=o.total,this.finished.value=this.list.value.length>=this.total,1==a.page?this.list.value=[...i]:this.list.value.push(...i),t(e)})).catch((e=>{s(e)})).finally((()=>{this.loading.value=!1}))}))})),this.loadMore=()=>{this.loading.value||this.finished.value||this.refresh({page:this.page+1})},this.listView=a((()=>U(this.list.value))),this.cb=e}done(){this.loading.value=!1}clear(){this.list.value=[],this.finished.value=!1,this.refreshing.value=!1,this.loading.value=!1}}class y extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{id:{type:Number,optional:!1},title:{type:String,optional:!1},image:{type:String,optional:!1}}}}}constructor(e,t=y.get$UTSMetadata$(),s=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,s),this.id=this.__props__.id,this.title=this.__props__.title,this.image=this.__props__.image,delete this.__props__}}const z=o(Object.assign({name:"goods-item"},{__name:"goods-item",props:{value:{type:Object,default:()=>new UTSJSONObject({})}},setup(e){const t=e,s=a((()=>l(t.value)));return(e=null,t=null)=>{const i=w(n("cl-image"),J),a=w(n("cl-text"),b),l=h;return r(),c(l,new UTSJSONObject({class:"p-3 pb-0"}),{default:u((()=>[p(l,new UTSJSONObject({class:d(["w-full p-3 bg-white rounded-xl",new UTSJSONObject({"dark-colon-bg-surface-800":S(O)})])}),{default:u((()=>{var e;return[p(i,{src:null===(e=s.value)||void 0===e?null:e.image,mode:"aspectFill",width:"100%",height:"280rpx"},null,8,["src"]),p(a,new UTSJSONObject({pt:new UTSJSONObject({className:"mt-2"})}),{default:u((()=>{var e;return[g(m(null===(e=s.value)||void 0===e?null:e.title),1)]})),_:1})]})),_:1},8,["class"])])),_:1})}}})),k=o({__name:"list-view-refresh",setup(i){const a=f(),l=t(null);let o=0;const g=new x((e=>new Promise((t=>{setTimeout((()=>{t(new UTSJSONObject({list:[new UTSJSONObject({id:o++,title:"春日樱花盛开时节，粉色花瓣如诗如画般飘洒",image:"https://unix.cool-js.com/images/demo/1.jpg"}),new UTSJSONObject({id:o++,title:"夕阳西下的海滩边，金色阳光温柔地洒在波光粼粼的海面上，构成令人心旷神怡的日落美景",image:"https://unix.cool-js.com/images/demo/2.jpg"}),new UTSJSONObject({id:o++,title:"寒冬腊月时分，洁白雪花纷纷扬扬地覆盖着整个世界，感受冬日的宁静与美好",image:"https://unix.cool-js.com/images/demo/3.jpg"}),new UTSJSONObject({id:o++,title:"都市夜景霓虹闪烁，五彩斑斓光芒照亮城市营造梦幻般景象",image:"https://unix.cool-js.com/images/demo/5.jpg"}),new UTSJSONObject({id:o++,title:"云雾缭绕的山间风光如诗如画让人心旷神怡，微风轻抚树梢带来阵阵清香，鸟儿在林间自由歌唱",image:"https://unix.cool-js.com/images/demo/6.jpg"}),new UTSJSONObject({id:o++,title:"古老建筑与现代摩天大楼交相辉映，传统与现代完美融合创造独特城市景观",image:"https://unix.cool-js.com/images/demo/7.jpg"}),new UTSJSONObject({id:o++,title:"广袤田野绿意盎然风光无限，金黄麦浪在微风中轻柔摇曳，农家炊烟袅袅升起",image:"https://unix.cool-js.com/images/demo/8.jpg"}),new UTSJSONObject({id:o++,title:"璀璨星空下银河横跨天际，繁星闪烁神秘光芒营造浪漫夜空美景",image:"https://unix.cool-js.com/images/demo/9.jpg"}),new UTSJSONObject({id:o++,title:"雄伟瀑布从高耸悬崖飞流直下激起千层浪花，彩虹在水雾中若隐若现如梦如幻",image:"https://unix.cool-js.com/images/demo/10.jpg"})],pagination:new UTSJSONObject({page:e.page,size:e.size,total:100})})),a.hideLoading()}),1e3)})))),m=g.refresh,d=g.list,O=g.listView,b=g.loading,U=g.loadMore;function J(){return s(this,void 0,void 0,(function*(){yield m(new UTSJSONObject({page:1})),l.value.stopRefresh()}))}return v((()=>{a.showLoading(j("加载中")),m(new UTSJSONObject({}))})),(t=null,s=null)=>{const i=w(n("cl-loadmore"),e),a=h,o=w(n("cl-list-view"),N),g=w(n("cl-page"),T);return r(),c(g,null,new UTSJSONObject({default:u((()=>[p(o,new UTSJSONObject({ref_key:"listViewRef",ref:l,data:S(O),virtual:!1,pt:new UTSJSONObject({refresher:new UTSJSONObject({className:"pt-3"})}),"refresher-enabled":!0,onPull:J,onBottom:S(U)}),{item:u((e=>{var t=e.value;return[p(S(z),new UTSJSONObject({value:t}),null,8,["value"])]})),bottom:u((()=>[p(a,new UTSJSONObject({class:"py-3"}),{default:u((()=>[S(d).length>0?(r(),c(i,new UTSJSONObject({key:0,loading:S(b)}),null,8,["loading"])):_("",!0)])),_:1})])),_:1},8,["data","onBottom"])])),_:1}))}}});export{k as default};
