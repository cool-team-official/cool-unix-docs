import{d as e,t,h as a,r as s,V as l,a as r,o as n,c as u,w as i,i as o,Y as c,a6 as p,_ as d,l as m,m as _,u as S,q as v,n as g,e as y,Q as f,x as O,F as h,A as w,f as N,g as T,G as b,aA as U,ax as j,I as x,S as J}from"./index-OmDYQuYg.js";import{r as k,a as A,_ as C,c as F}from"./cl-page.uvue_vue_type_script_setup_true_lang.0nEhSiOF.js";import{_ as V}from"./cl-progress.C2Hgl9Rg.js";import{u as z}from"./form.TmXsJQGQ.js";import{a as B}from"./index.CWr5uSeu.js";class $ extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{className:{type:String,optional:!0},item:{type:"Unknown",optional:!0},add:{type:"Unknown",optional:!0},image:{type:"Unknown",optional:!0},icon:{type:"Unknown",optional:!0},text:{type:"Unknown",optional:!0}}}}}constructor(e,t=$.get$UTSMetadata$(),a=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,a),this.className=this.__props__.className,this.item=this.__props__.item,this.add=this.__props__.add,this.image=this.__props__.image,this.icon=this.__props__.icon,this.text=this.__props__.text,delete this.__props__}}const I=F(e(Object.assign({name:"cl-upload"},{__name:"cl-upload",props:{pt:{type:Object,default:()=>new UTSJSONObject({})},modelValue:{type:[Array,String],default:()=>[]},icon:{type:String,default:"camera-fill"},text:{type:String,default:()=>t("上传 / 拍摄")},sizeType:{type:[String,Array],default:()=>["original","compressed"]},sourceType:{type:Array,default:()=>["album","camera"]},height:{type:[Number,String],default:150},width:{type:[Number,String],default:150},multiple:{type:Boolean,default:!1},limit:{type:Number,default:9},disabled:{type:Boolean,default:!1},test:{type:Boolean,default:!1}},emits:["update:modelValue","change","exceed","success","error","progress"],setup(e,t){var F=t.emit;const $=e,I=F,M=z().disabled,P=a((()=>M.value||$.disabled)),q=a((()=>c($.pt))),E=s([]),G=s(0),Q=a((()=>{const e=E.value.length;return P.value?0==e:e<($.multiple?$.limit:1)})),Y=a((()=>new UTSJSONObject({height:p($.height),width:p($.width)})));function D(){return E.value.filter((e=>""!=e.url&&100==e.progress)).map((e=>e.url))}function H(){const e=function(){const e=D();return $.multiple?e:e[0]}();I("update:modelValue",e),I("change",e)}function K(e,t=null){const a=UTS.arrayFind(E.value,(t=>t.uid==e));null!=a&&(J(t,((e=null,t)=>{a[t]=e})),100==a.progress&&""!=a.url&&H())}function L(e){E.value.splice(E.value.findIndex((t=>t.uid==e)),1),H()}function R(e){if(P.value)return null;G.value=e;const t=-1==G.value?$.limit-E.value.length:1;if(t<=0)return I("exceed",E.value),null;b(new UTSJSONObject({count:t,sizeType:$.sizeType,sourceType:$.sourceType,success(e){Array.isArray(e.tempFiles)&&e.tempFiles.forEach((e=>{const t=function(e){const t=-1==G.value?x({uid:U(),preview:e,url:"",progress:0}):E.value[G.value];return-1==G.value?E.value.push(t):(t.progress=0,t.preview=e,t.url=""),t.uid}(e.path);if($.test)return K(t,new UTSJSONObject({url:e.path,progress:100})),I("success",e.path,t),null;B(e,{onProgressUpdate:e=>{var a=e.progress;K(t,new UTSJSONObject({progress:a})),I("progress",a)}}).then((e=>{K(t,new UTSJSONObject({url:e,progress:100})),I("success",e,t)})).catch(((e=null)=>{I("error",e),L(t)}))}))},fail(e){console.error(e),I("error",e.errMsg)}}))}return l(a((()=>$.modelValue)),(e=>{if(D().join(",")!=(Array.isArray(e)?e.join(","):e)){const t=Array.isArray(e)?e:[e];E.value=t.filter((e=>""!=e)).map((e=>({uid:U(),preview:e,url:e,progress:100})))}}),{immediate:!0}),(t=null,a=null)=>{const s=j,l=k(r("cl-icon"),A),c=k(r("cl-progress"),V),p=d,b=k(r("cl-text"),C);return n(),u(p,new UTSJSONObject({class:o(["cl-upload-list",[new UTSJSONObject({}),q.value.className]])}),{default:i((()=>{var t;return[(n(!0),m(h,null,_(E.value,((e,t)=>{var a;return n(),u(p,{key:e.uid,class:o(["cl-upload",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":S(v),"is-disabled":P.value}),null===(a=q.value.item)||void 0===a?null:a.className]]),style:g(Y.value),onClick:(e=null)=>R(t)},{default:i((()=>{var t;return[y(s,{class:o(["cl-upload__image",[new UTSJSONObject({}),new UTSJSONObject({"is-uploading":e.progress<100}),null===(t=q.value.image)||void 0===t?null:t.className]]),src:e.preview,mode:"aspectFill"},null,8,["class","src"]),P.value?O("",!0):(n(),u(l,new UTSJSONObject({key:0,name:"close-line",color:"white",pt:new UTSJSONObject({className:"cl-upload__close"}),onClick:f(((t=null)=>L(e.uid)),["stop"])}),null,8,["onClick"])),e.progress<100?(n(),u(p,new UTSJSONObject({key:1,class:"cl-upload__progress"}),new UTSJSONObject({default:i((()=>[y(c,new UTSJSONObject({value:e.progress,"show-text":!1}),null,8,["value"])])),_:2}),1024)):O("",!0)]})),_:2},1032,["class","style","onClick"])})),128)),Q.value?(n(),u(p,{key:0,class:o(["cl-upload is-add",[new UTSJSONObject({}),new UTSJSONObject({"is-dark":S(v),"is-disabled":P.value}),null===(t=q.value.add)||void 0===t?null:t.className]]),style:g(Y.value),onClick:a[0]||(a[0]=(e=null)=>R(-1))},{default:i((()=>{var t,a;return[y(l,{name:e.icon,pt:{className:S(w)([[S(v),"-important-text-white","-important-text-surface-400"],null===(t=q.value.icon)||void 0===t?null:t.className])},size:50},null,8,["name","pt"]),y(b,{pt:{className:S(w)([[S(v),"-important-text-white","-important-text-surface-500"],"-important-text-xs mt-1 text-center",null===(a=q.value.text)||void 0===a?null:a.className])}},{default:i((()=>[N(T(e.text),1)])),_:1},8,["pt"])]})),_:1},8,["class","style"])):O("",!0)]})),_:1},8,["class"])}}})),[["__scopeId","data-v-be9be922"]]);export{I as _};
